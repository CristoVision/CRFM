(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[990],{573:function(e,t,r){Promise.resolve().then(r.bind(r,2110))},2110:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return o}});var a=r(7437),s=r(6013),i=r(9135),n=r(571);function d(e){let{achievements:t,userAchievements:r,collectionPct:d}=e,l=new Map(r.map(e=>[e.achievement_id,e]));return(0,a.jsx)("div",{className:"du-grid two",children:t.map(e=>{let t=l.get(e.id),r=!!((null==t?void 0:t.date_earned)||(null==t?void 0:t.unlocked_at));return(0,a.jsxs)(s.Z,{title:e.name,badge:(0,a.jsx)(i.A,{children:r?"Completed":"Locked"}),children:[(0,a.jsx)("p",{children:e.description}),(0,a.jsxs)("div",{className:"du-chip-row",children:[e.reward_cc?(0,a.jsxs)(i.A,{children:["Reward: ",e.reward_cc," CC"]}):null,e.reward_item?(0,a.jsxs)(i.A,{children:["Item: ",e.reward_item]}):null,(0,a.jsxs)(i.A,{children:["Criteria: ","string"==typeof e.criteria_json?e.criteria_json:"see JSON"]})]}),(0,a.jsxs)("div",{className:"du-chip-row",style:{marginTop:8},children:[(0,a.jsxs)(i.A,{children:["Status: ",r?"Completed":"Not yet"]}),(null==t?void 0:t.date_earned)?(0,a.jsxs)(i.A,{children:["Earned: ",t.date_earned]}):null,(null==t?void 0:t.unlocked_at)?(0,a.jsxs)(i.A,{children:["Unlocked: ",t.unlocked_at]}):null]}),(0,a.jsx)(n.E,{value:r?100:d})]},e.id)})})}var l=r(371);function o(){let e=(0,l.G)(),t=0===e.creatures.length?0:Math.round(e.playerCreatures.length/e.creatures.length*100);return(0,a.jsxs)("div",{className:"du-stack",children:[(0,a.jsx)(s.Z,{title:"Achievements",badge:(0,a.jsx)(i.A,{children:e.achievements.length}),children:(0,a.jsx)("p",{className:"du-meta",children:"Track collection %, milestones, and region completion achievements."})}),(0,a.jsx)(d,{achievements:e.achievements,userAchievements:e.userAchievements,collectionPct:t})]})}},6013:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var a=r(7437);function s(e){let{children:t,title:r,badge:s,footer:i,className:n}=e;return(0,a.jsxs)("div",{className:["du-card",n].filter(Boolean).join(" "),children:[(r||s)&&(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[r?(0,a.jsx)("h3",{style:{margin:0},children:r}):(0,a.jsx)("span",{}),s]}),t,i?(0,a.jsx)("div",{style:{marginTop:10},children:i}):null]})}},9135:function(e,t,r){"use strict";r.d(t,{A:function(){return s}});var a=r(7437);function s(e){let{children:t,className:r,style:s,variant:i}=e;return(0,a.jsx)("span",{className:["du-tag","ghost"===i?"du-tag--ghost":null,r].filter(Boolean).join(" "),style:s,children:t})}},571:function(e,t,r){"use strict";r.d(t,{E:function(){return s}});var a=r(7437);function s(e){let{value:t}=e;return(0,a.jsx)("div",{className:"du-progress",children:(0,a.jsx)("span",{style:{width:"".concat(Math.min(Math.max(t,0),100),"%")}})})}},857:function(e,t,r){"use strict";r.d(t,{H:function(){return d},a:function(){return l}});var a=r(7437),s=r(2265),i=r(1180);let n=(0,s.createContext)({userId:null,status:"loading",signOut:async()=>{}});function d(e){let{children:t}=e,r=(0,i.O)(),[d,l]=(0,s.useState)(null),[o,u]=(0,s.useState)(r?"loading":"signed_out"),[c,_]=(0,s.useState)(void 0);(0,s.useEffect)(()=>{if(!r){u("signed_out");return}let e=!1;(async()=>{var t;let{data:a,error:s}=await r.auth.getSession();if(!e){if(s){try{await r.auth.signOut()}catch(e){}u("signed_out"),_(s.message),l(null)}else(null===(t=a.session)||void 0===t?void 0:t.user)?(l(a.session.user.id),u("ready")):u("signed_out")}})();let{data:t}=r.auth.onAuthStateChange((e,t)=>{(null==t?void 0:t.user)?(l(t.user.id),u("ready")):(l(null),u("signed_out"))});return()=>{e=!0,null==t||t.subscription.unsubscribe()}},[r]);let m=async()=>{r&&(await r.auth.signOut(),l(null),u("signed_out"))};return(0,a.jsx)(n.Provider,{value:{userId:d,status:o,error:c,signOut:m},children:t})}function l(){return(0,s.useContext)(n)}},371:function(e,t,r){"use strict";r.d(t,{G:function(){return o},U:function(){return l}});var a=r(7437),s=r(2265),i=r(1180),n=r(857);let d=(0,s.createContext)({regions:[],creatures:[],creatureStages:[],playerCreatures:[],regionCreatures:[],cityCreatures:[],missions:[],missionProgress:[],achievements:[],userAchievements:[],bonds:[],battles:[],profile:null,trainerStats:[],playerStats:[],xpThresholds:[],factions:[],cities:[],status:"idle",isLive:!1,reload:async()=>{}});function l(e){let{children:t}=e,r=(0,i.O)(),{userId:l,status:o}=(0,n.a)(),[u,c]=(0,s.useState)("idle"),[_,m]=(0,s.useState)(void 0),[f,p]=(0,s.useState)([]),[h,g]=(0,s.useState)([]),[v,y]=(0,s.useState)([]),[x,j]=(0,s.useState)([]),[S,w]=(0,s.useState)([]),[b,k]=(0,s.useState)([]),[C,A]=(0,s.useState)([]),[N,q]=(0,s.useState)([]),[O,E]=(0,s.useState)([]),[T,P]=(0,s.useState)([]),[M,I]=(0,s.useState)([]),[B,U]=(0,s.useState)([]),[Z,D]=(0,s.useState)([]),[G,J]=(0,s.useState)(null),[L,R]=(0,s.useState)(!1),[F,H]=(0,s.useState)([]),[X,z]=(0,s.useState)([]),[K,Q]=(0,s.useState)([]),[V,W]=(0,s.useState)([]),Y=async()=>{if(!r||!l){c("idle"),R(!1);return}c("loading"),m(void 0);let e=[],[t,a,s,i,n,d,o,u,_,f,h,v,x,S,b,C,N,O]=await Promise.all([r.from("profiles").select("*").eq("id",l).maybeSingle(),r.from("creatures").select("id, name, base_type, region, image_url"),r.from("creature_stages").select("id, creature_id, stage_name, stage_order, stage_stats, image_url, variant_type, xp_required"),r.from("player_creatures").select("user_id, creature_id, current_stage_id, nickname, variant_type, date_caught, custom_stats, current_xp, level, in_party, party_slot, is_domesticated, stats").eq("user_id",l),r.from("regions").select("id, name, color, island, municipalities, map_polygon"),r.from("region_creatures").select("region_id, creature_id, spawn_rate"),r.from("cities").select("id, name, region_id"),r.from("city_creatures").select("city_id, creature_id, spawn_rate"),r.from("story_missions").select("id, title, description, region_id, order_in_story, unlock_requirements, reward_cc, reward_item, mission_difficulty, is_battle, trainer_id"),r.from("player_mission_progress").select("user_id, mission_id, is_completed, completed_at, completion_date, rewards").eq("user_id",l),r.from("achievements").select("id, name, description, icon_url, criteria_json, reward_cc, reward_item"),r.from("user_achievements").select("id, user_id, achievement_id, achievement_name, description, date_earned, unlocked_at, notified_followers, track_id").eq("user_id",l),r.from("player_faction_bonds").select("user_id, faction, bond_amount").eq("user_id",l),r.from("battles").select("player1_id, player2_id, winner_id, battle_log, started_at, ended_at").or("player1_id.eq.".concat(l,",player2_id.eq.").concat(l)),r.from("player_trainer_stats").select("user_id, trainer_id, wins, losses, familiarity, last_battle_at").eq("user_id",l),r.from("player_stats").select("user_id, stat_key, stat_value").eq("user_id",l),r.from("creature_stage_xp_thresholds").select("id, creature_id, stage_id, xp_required, created_at, updated_at"),r.from("factions").select("id, name, description, color_hex, icon_url, slug, motto, alignment, lore_json")]),T=(t,r)=>{if(!r)return;let a="string"==typeof(null==r?void 0:r.message)?r.message:String(r);e.push("".concat(t,": ").concat(a))};T("profiles",t.error),T("creatures",a.error),T("creature_stages",s.error),T("player_creatures",i.error),T("regions",n.error),T("region_creatures",d.error),T("cities",o.error),T("city_creatures",u.error),T("story_missions",_.error),T("player_mission_progress",f.error),T("achievements",h.error),T("user_achievements",v.error),T("player_faction_bonds",x.error),T("battles",S.error),T("player_trainer_stats",b.error),T("player_stats",C.error),T("creature_stage_xp_thresholds",N.error),T("factions",O.error),t.data&&J(t.data),a.data&&y(a.data),s.data&&j(s.data.map(e=>{var t;return{...e,stage_stats:"string"==typeof e.stage_stats?JSON.parse(e.stage_stats):null!==(t=e.stage_stats)&&void 0!==t?t:{hp:0,atk:0,def:0,speed:0,faith:0}}})),i.data&&w(i.data),n.data&&p(n.data),d.data&&k(d.data),o.data&&g(o.data),u.data&&A(u.data),_.data&&q(_.data),f.data&&E(f.data),h.data&&P(h.data),v.data&&I(v.data),x.data&&U(x.data),S.data&&D(S.data),b.data&&H(b.data),C.data&&z(C.data),N.data&&Q(N.data),O.data&&W(O.data),R(!0),e.length?(c("error"),m(e.join(" | "))):c("ready")};(0,s.useEffect)(()=>{"ready"===o&&Y()},[o,l]);let $=(0,s.useMemo)(()=>({regions:f,creatures:v,creatureStages:x,playerCreatures:S,regionCreatures:b,cityCreatures:C,missions:N,missionProgress:O,achievements:T,userAchievements:M,bonds:B,battles:Z,profile:G,trainerStats:F,playerStats:X,xpThresholds:K,factions:V,cities:h,status:u,error:_,isLive:L,reload:Y}),[f,v,x,S,b,N,O,T,M,B,Z,G,F,X,K,V,u,_,L]);return(0,a.jsx)(d.Provider,{value:$,children:t})}function o(){return(0,s.useContext)(d)}},1180:function(e,t,r){"use strict";r.d(t,{O:function(){return i}});var a=r(3234);let s=null;function i(){if(s)return s;let e="https://npdklestjuejrotjtqwt.supabase.co",t="sb_publishable_9xEllkhUFl85xTTXtDDT5g_ei508t0r";return e&&t?s=(0,a.eI)(e,t,{auth:{persistSession:!0,autoRefreshToken:!0}}):null}}},function(e){e.O(0,[234,971,23,744],function(){return e(e.s=573)}),_N_E=e.O()}]);