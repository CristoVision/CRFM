(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[349],{5411:function(e,t,a){Promise.resolve().then(a.bind(a,638))},638:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return v}});var r=a(7437),s=a(371),n=a(2265),i=a(6013),c=a(9135),l=a(571),o=a(4660);let d=e=>!!e&&/^[0-9a-fA-F-]{32,}$/.test(e),u=e=>(e||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9]+/g," ").trim(),p=[{id:"golden",name:"Oro",frame:"linear-gradient(180deg, #3a301d 0%, #221a12 100%)",panel:"linear-gradient(180deg, #d8b46c 0%, #8a6a33 100%)",accent:"#e8c27c",text:"#2a1c0b",glow:"0 10px 28px rgba(226, 178, 92, 0.36)"},{id:"forest",name:"Bosque",frame:"linear-gradient(180deg, #233023 0%, #101a12 100%)",panel:"linear-gradient(180deg, #8cc08c 0%, #486a48 100%)",accent:"#b7e4a5",text:"#0d160d",glow:"0 10px 28px rgba(132, 204, 143, 0.32)"}];function g(e){var t,a,s,p,g,h,m,_,v,j,f,b,x,y,S,k;let{creature:w,playerCreature:N,stage:C,growth:A,accent:q,theme:E}=e,P="https://npdklestjuejrotjtqwt.supabase.co",[T,O]=(0,n.useState)(!1),[M,z]=(0,n.useState)(0),B=(null==C?void 0:C.stage_stats)||(null==w?void 0:w.stats)||{},D=null!==(a=null!==(t=null==B?void 0:B.faith)&&void 0!==t?t:null==B?void 0:B.faith_points)&&void 0!==a?a:0,F=null!==(p=null!==(s=null==B?void 0:B.hp)&&void 0!==s?s:null==B?void 0:B.health)&&void 0!==p?p:0,U=null!==(h=null!==(g=null==B?void 0:B.atk)&&void 0!==g?g:null==B?void 0:B.attack)&&void 0!==h?h:0,Z=null!==(_=null!==(m=null==B?void 0:B.def)&&void 0!==m?m:null==B?void 0:B.defense)&&void 0!==_?_:0,J=null!==(j=null!==(v=null==B?void 0:B.speed)&&void 0!==v?v:null==B?void 0:B.spd)&&void 0!==j?j:0,L=P?"".concat(P,"/storage/v1/object/public/creatures/UnknownCreature.png"):void 0,W=(0,n.useMemo)(()=>(function(e,t,a){let r=[],s=e=>{e&&(e.startsWith("http")||e.startsWith("data:")?r.push(e):a&&r.push("".concat(a,"/storage/v1/object/public/").concat(e.replace(/^\//,""))))};if(s(null==e?void 0:e.image_url),s(null==t?void 0:t.image_url),a&&(null==e?void 0:e.name)){let t=u(e.name),s=t.replace(/ /g,""),n=t.toLowerCase().replace(/ /g,"-");s&&r.push("".concat(a,"/storage/v1/object/public/creatures/").concat(s,".png")),n&&r.push("".concat(a,"/storage/v1/object/public/creatures/").concat(n,".png")),s&&r.push("".concat(a,"/storage/v1/object/public/creatures/").concat(s,".jpg")),n&&r.push("".concat(a,"/storage/v1/object/public/creatures/").concat(n,".jpg")),s&&r.push("".concat(a,"/storage/v1/object/public/creatures/").concat(s,".webp")),n&&r.push("".concat(a,"/storage/v1/object/public/creatures/").concat(n,".webp")),s&&r.push("".concat(a,"/storage/v1/object/public/creatures/").concat(s,"S.png")),s&&r.push("".concat(a,"/storage/v1/object/public/creatures/").concat(s,"S.jpg")),s&&r.push("".concat(a,"/storage/v1/object/public/creatures/").concat(s,"S.webp")),r.push("".concat(a,"/storage/v1/object/public/creatures/CotorraChick.png")),r.push("".concat(a,"/storage/v1/object/public/creatures/CoquiTad.png")),r.push("".concat(a,"/storage/v1/object/public/creatures/JibaroPup.png")),r.push("".concat(a,"/storage/v1/object/public/creatures/JibaroPupS.png"))}return Array.from(new Set(r.filter(e=>/[./]/.test(e))))})(w,C,P),[w,C,P]),I=T?void 0:W[M],R=null!==(f=null==C?void 0:C.stage_order)&&void 0!==f?f:0,X=A.find(e=>e.stage_order===R+1),G=null!==(b=null==X?void 0:X.xp_required)&&void 0!==b?b:20,H=Math.min(Math.round(N.current_xp/G*100),100),$=w?(0,o.l)(w.name,w.name_locales):void 0,K=N.nickname||($&&!d($)?$:null==C?void 0:C.stage_name)||"Criatura",V=(null==w?void 0:w.base_type)&&!d(w.base_type)?w.base_type:"Tipo";return(0,r.jsx)(i.Z,{badge:(0,r.jsxs)(c.A,{children:["XP ",N.current_xp]}),children:(0,r.jsxs)("div",{className:"du-skin-card",style:{background:E.frame,boxShadow:E.glow,color:E.text},children:[(0,r.jsxs)("div",{className:"du-skin-header",children:[(0,r.jsx)("div",{className:"du-skin-tag",children:V}),(0,r.jsx)("div",{className:"du-skin-name",children:K})]}),(0,r.jsxs)("div",{className:"du-skin-img",style:{background:E.panel},children:[I&&!T?(0,r.jsx)("img",{src:I,alt:$||(null==w?void 0:w.name)||"Creature",loading:"lazy",onError:()=>{M<W.length-1?z(e=>e+1):O(!0)}}):L&&!T?(0,r.jsx)("img",{src:L,alt:"Unknown creature",loading:"lazy",onError:()=>O(!0)}):(0,r.jsx)("div",{className:"du-creature-placeholder"}),(0,r.jsx)("div",{className:"du-skin-region",children:null!==(y=null!==(x=null==w?void 0:w.region)&&void 0!==x?x:N.region)&&void 0!==y?y:"Regi\xf3n —"}),K?(0,r.jsx)("div",{className:"du-skin-watermark",children:K}):null]}),(0,r.jsxs)("div",{className:"du-skin-stats",children:[(0,r.jsxs)("div",{className:"du-skin-stat",style:{background:E.panel},children:[(0,r.jsx)("span",{children:"HP"}),(0,r.jsx)("strong",{children:F})]}),(0,r.jsxs)("div",{className:"du-skin-stat",style:{background:E.panel},children:[(0,r.jsx)("span",{children:"ATK"}),(0,r.jsx)("strong",{children:U})]}),(0,r.jsxs)("div",{className:"du-skin-stat",style:{background:E.panel},children:[(0,r.jsx)("span",{children:"DEF"}),(0,r.jsx)("strong",{children:Z})]}),(0,r.jsxs)("div",{className:"du-skin-stat",style:{background:E.panel},children:[(0,r.jsx)("span",{children:"SPD"}),(0,r.jsx)("strong",{children:J})]})]}),(0,r.jsxs)("div",{className:"du-skin-meta",children:[(0,r.jsxs)(c.A,{children:["Variante: ",N.variant_type]}),(0,r.jsxs)(c.A,{children:["Etapa: ",null!==(S=null==C?void 0:C.stage_name)&&void 0!==S?S:"—"]}),N.level?(0,r.jsxs)(c.A,{children:["Nivel ",N.level]}):null,(0,r.jsxs)(c.A,{children:["Bond ",D]})]}),(0,r.jsxs)("div",{className:"du-skin-progress",children:[(0,r.jsx)(l.E,{value:H}),(0,r.jsxs)("div",{className:"du-meta",children:["Etapa ",null!==(k=null==C?void 0:C.stage_order)&&void 0!==k?k:1," → ",X?X.stage_name:"final"," \xb7 requiere ",G," XP"]})]}),(0,r.jsxs)("div",{className:"du-skin-growth",children:[A.map(e=>{var t,a;return(0,r.jsxs)(c.A,{className:e.id===(null==C?void 0:C.id)?"du-chip-active":void 0,children:[e.stage_order,". ",e.stage_name," \xb7 Bond ",null!==(a=null===(t=e.stage_stats)||void 0===t?void 0:t.faith)&&void 0!==a?a:"—"]},e.id)}),0===A.length&&(0,r.jsx)("span",{className:"du-meta",children:"Sin etapas registradas."})]})]})},N.creature_id)}function h(e){var t;let{creatures:a,playerCreatures:s,stages:i,accent:l}=e,[o,d]=(0,n.useState)("golden"),u=null!==(t=p.find(e=>e.id===o))&&void 0!==t?t:p[0],h=i.reduce((e,t)=>(e[t.id]=t,e),{});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"du-chip-row",style:{marginBottom:6},children:[(0,r.jsx)(c.A,{children:"Skin"}),p.map(e=>(0,r.jsx)("button",{className:"du-theme-btn".concat(e.id===u.id?" active":""),style:{borderColor:e.accent},onClick:()=>d(e.id),children:e.name},e.id))]}),(0,r.jsxs)("div",{className:"du-grid two",children:[s.map(e=>{let t=a.find(t=>t.id===e.creature_id),s=h[e.current_stage_id],n=i.filter(t=>t.creature_id===e.creature_id).sort((e,t)=>e.stage_order-t.stage_order);return(0,r.jsx)(g,{creature:t,playerCreature:e,stage:s,growth:n,accent:l,theme:u},e.creature_id)}),0===s.length&&(0,r.jsx)("div",{className:"du-meta",children:"No tienes criaturas domesticadas."})]})]})}let m=e=>!!e&&/^[0-9a-fA-F-]{32,}$/.test(e);function _(e){let{creatures:t,playerCreatures:a}=e,s="https://npdklestjuejrotjtqwt.supabase.co",l=(0,n.useMemo)(()=>a.reduce((e,t)=>e.set(t.creature_id,t),new Map),[a]),d=(0,n.useMemo)(()=>new Set(a.map(e=>e.creature_id)),[a]),[u,p]=(0,n.useState)({}),g=s?"".concat(s,"/storage/v1/object/public/creatures/UnknownCreature.png"):void 0;return(0,r.jsxs)("div",{className:"du-grid four",children:[t.map(e=>{var t;let a=d.has(e.id),n=function(e,t){var a;let r=[];if((a=e.image_url)&&(a.startsWith("http")||a.startsWith("data:")?r.push(a):t&&r.push("".concat(t,"/storage/v1/object/public/").concat(a.replace(/^\//,"")))),t&&e.name){let a=e.name.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9]+/g," ").trim(),s=a.replace(/ /g,""),n=a.toLowerCase().replace(/ /g,"-");s&&r.push("".concat(t,"/storage/v1/object/public/creatures/").concat(s,".png")),n&&r.push("".concat(t,"/storage/v1/object/public/creatures/").concat(n,".png")),s&&r.push("".concat(t,"/storage/v1/object/public/creatures/").concat(s,".jpg")),n&&r.push("".concat(t,"/storage/v1/object/public/creatures/").concat(n,".jpg")),s&&r.push("".concat(t,"/storage/v1/object/public/creatures/").concat(s,".webp")),n&&r.push("".concat(t,"/storage/v1/object/public/creatures/").concat(n,".webp")),s&&r.push("".concat(t,"/storage/v1/object/public/creatures/").concat(s,"S.png")),s&&r.push("".concat(t,"/storage/v1/object/public/creatures/").concat(s,"S.jpg")),s&&r.push("".concat(t,"/storage/v1/object/public/creatures/").concat(s,"S.webp"))}return["CoquiTad.png","CotorraChick.png","JibaroPup.png","JibaroPupS.png"].forEach(e=>{r.push("".concat(t,"/storage/v1/object/public/creatures/").concat(e))}),Array.from(new Set(r.filter(e=>/[./]/.test(e))))}(e,s),h=a&&!u[e.id]?n[0]:void 0,_=a&&(h||g)&&!u[e.id],v=l.get(e.id),j=(0,o.l)(e.name,e.name_locales),f=a?(null==v?void 0:v.nickname)||(j&&!m(j)?j:"Criatura"):"???",b=a?e.base_type:"No visto";return(0,r.jsx)(i.Z,{title:f,badge:(0,r.jsx)(c.A,{children:b}),children:(0,r.jsxs)("div",{className:"du-dex",children:[(0,r.jsx)("div",{className:"du-dex-img".concat(a?"":" locked"),children:_?(0,r.jsx)("img",{src:null!=h?h:g,alt:j||e.name,loading:"lazy",onError:()=>p(t=>({...t,[e.id]:!0}))}):g?(0,r.jsx)("img",{src:g,alt:"Unknown creature",loading:"lazy",onError:()=>p(t=>({...t,["unknown-".concat(e.id)]:!0}))}):(0,r.jsx)("div",{className:"du-creature-placeholder"})}),(0,r.jsxs)("div",{className:"du-dex-body",children:[(0,r.jsx)("div",{className:"du-meta",children:a?null!==(t=e.region)&&void 0!==t?t:"Regi\xf3n —":"A\xfan no encontrada"}),a?(0,r.jsx)(c.A,{children:"Unlocked"}):(0,r.jsx)(c.A,{variant:"ghost",children:"Por descubrir"})]})]})},e.id)}),0===t.length&&(0,r.jsx)("div",{className:"du-meta",children:"No hay criaturas cargadas."})]})}function v(){let e=(0,s.G)(),t=e.creatures,a=e.playerCreatures,n=e.creatureStages;return(0,r.jsxs)("div",{className:"du-stack",children:[(0,r.jsx)(i.Z,{title:"Creatures",badge:(0,r.jsxs)(c.A,{children:[a.length," domesticated"]}),children:(0,r.jsxs)("div",{className:"du-chip-row",children:[(0,r.jsxs)(c.A,{children:["Total species: ",t.length]}),(0,r.jsxs)(c.A,{children:["Stages loaded: ",n.length]})]})}),(0,r.jsx)(h,{creatures:t,playerCreatures:a,stages:n,accent:"#f0c15d"}),(0,r.jsx)(i.Z,{title:"Dex",badge:(0,r.jsxs)(c.A,{children:[t.length," especies"]}),children:(0,r.jsx)("p",{className:"du-meta",children:"Las criaturas no domesticadas se muestran ocultas hasta encontrarlas."})}),(0,r.jsx)(_,{creatures:t,playerCreatures:a})]})}},6013:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});var r=a(7437);function s(e){let{children:t,title:a,badge:s,footer:n,className:i}=e;return(0,r.jsxs)("div",{className:["du-card",i].filter(Boolean).join(" "),children:[(a||s)&&(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[a?(0,r.jsx)("h3",{style:{margin:0},children:a}):(0,r.jsx)("span",{}),s]}),t,n?(0,r.jsx)("div",{style:{marginTop:10},children:n}):null]})}},9135:function(e,t,a){"use strict";a.d(t,{A:function(){return s}});var r=a(7437);function s(e){let{children:t,className:a,style:s,variant:n}=e;return(0,r.jsx)("span",{className:["du-tag","ghost"===n?"du-tag--ghost":null,a].filter(Boolean).join(" "),style:s,children:t})}},571:function(e,t,a){"use strict";a.d(t,{E:function(){return s}});var r=a(7437);function s(e){let{value:t}=e;return(0,r.jsx)("div",{className:"du-progress",children:(0,r.jsx)("span",{style:{width:"".concat(Math.min(Math.max(t,0),100),"%")}})})}},857:function(e,t,a){"use strict";a.d(t,{H:function(){return c},a:function(){return l}});var r=a(7437),s=a(2265),n=a(1180);let i=(0,s.createContext)({userId:null,status:"loading",signOut:async()=>{}});function c(e){let{children:t}=e,a=(0,n.O)(),[c,l]=(0,s.useState)(null),[o,d]=(0,s.useState)(a?"loading":"signed_out"),[u,p]=(0,s.useState)(void 0);(0,s.useEffect)(()=>{if(!a){d("signed_out");return}let e=!1;(async()=>{var t;let{data:r,error:s}=await a.auth.getSession();if(!e){if(s){try{await a.auth.signOut()}catch(e){}d("signed_out"),p(s.message),l(null)}else(null===(t=r.session)||void 0===t?void 0:t.user)?(l(r.session.user.id),d("ready")):d("signed_out")}})();let{data:t}=a.auth.onAuthStateChange((e,t)=>{(null==t?void 0:t.user)?(l(t.user.id),d("ready")):(l(null),d("signed_out"))});return()=>{e=!0,null==t||t.subscription.unsubscribe()}},[a]);let g=async()=>{a&&(await a.auth.signOut(),l(null),d("signed_out"))};return(0,r.jsx)(i.Provider,{value:{userId:c,status:o,error:u,signOut:g},children:t})}function l(){return(0,s.useContext)(i)}},371:function(e,t,a){"use strict";a.d(t,{G:function(){return o},U:function(){return l}});var r=a(7437),s=a(2265),n=a(1180),i=a(857);let c=(0,s.createContext)({regions:[],creatures:[],creatureStages:[],playerCreatures:[],regionCreatures:[],cityCreatures:[],missions:[],missionProgress:[],achievements:[],userAchievements:[],bonds:[],battles:[],profile:null,trainerStats:[],playerStats:[],xpThresholds:[],factions:[],cities:[],status:"idle",isLive:!1,reload:async()=>{}});function l(e){let{children:t}=e,a=(0,n.O)(),{userId:l,status:o}=(0,i.a)(),[d,u]=(0,s.useState)("idle"),[p,g]=(0,s.useState)(void 0),[h,m]=(0,s.useState)([]),[_,v]=(0,s.useState)([]),[j,f]=(0,s.useState)([]),[b,x]=(0,s.useState)([]),[y,S]=(0,s.useState)([]),[k,w]=(0,s.useState)([]),[N,C]=(0,s.useState)([]),[A,q]=(0,s.useState)([]),[E,P]=(0,s.useState)([]),[T,O]=(0,s.useState)([]),[M,z]=(0,s.useState)([]),[B,D]=(0,s.useState)([]),[F,U]=(0,s.useState)([]),[Z,J]=(0,s.useState)(null),[L,W]=(0,s.useState)(!1),[I,R]=(0,s.useState)([]),[X,G]=(0,s.useState)([]),[H,$]=(0,s.useState)([]),[K,V]=(0,s.useState)([]),Q=async()=>{if(!a||!l){u("idle"),W(!1);return}u("loading"),g(void 0);let e=[],[t,r,s,n,i,c,o,d,p,h,_,j,b,y,k,N,A,E]=await Promise.all([a.from("profiles").select("*").eq("id",l).maybeSingle(),a.from("creatures").select("id, name, name_locales, base_type, region, image_url, is_starter, rarity, sexes"),a.from("creature_stages").select("id, creature_id, stage_name, stage_order, stage_stats, image_url, variant_type, xp_required"),a.from("player_creatures").select("user_id, creature_id, current_stage_id, nickname, variant_type, date_caught, custom_stats, current_xp, level, in_party, party_slot, is_domesticated, stats, sex").eq("user_id",l),a.from("regions").select("id, name, color, island, municipalities, map_polygon"),a.from("region_creatures").select("region_id, creature_id, spawn_rate"),a.from("cities").select("id, name, region_id"),a.from("city_creatures").select("city_id, creature_id, spawn_rate"),a.from("story_missions").select("id, title, description, region_id, order_in_story, unlock_requirements, reward_cc, reward_item, mission_difficulty, is_battle, trainer_id"),a.from("player_mission_progress").select("user_id, mission_id, is_completed, completed_at, completion_date, rewards").eq("user_id",l),a.from("achievements").select("id, name, description, icon_url, criteria_json, reward_cc, reward_item"),a.from("user_achievements").select("id, user_id, achievement_id, achievement_name, description, date_earned, unlocked_at, notified_followers, track_id").eq("user_id",l),a.from("player_faction_bonds").select("user_id, faction, bond_amount").eq("user_id",l),a.from("battles").select("player1_id, player2_id, winner_id, battle_log, started_at, ended_at").or("player1_id.eq.".concat(l,",player2_id.eq.").concat(l)),a.from("player_trainer_stats").select("user_id, trainer_id, wins, losses, familiarity, last_battle_at").eq("user_id",l),a.from("player_stats").select("user_id, stat_key, stat_value").eq("user_id",l),a.from("creature_stage_xp_thresholds").select("id, creature_id, stage_id, xp_required, created_at, updated_at"),a.from("factions").select("id, name, description, color_hex, icon_url, slug, motto, alignment, lore_json")]),T=(t,a)=>{if(!a)return;let r="string"==typeof(null==a?void 0:a.message)?a.message:String(a);e.push("".concat(t,": ").concat(r))};T("profiles",t.error),T("creatures",r.error),T("creature_stages",s.error),T("player_creatures",n.error),T("regions",i.error),T("region_creatures",c.error),T("cities",o.error),T("city_creatures",d.error),T("story_missions",p.error),T("player_mission_progress",h.error),T("achievements",_.error),T("user_achievements",j.error),T("player_faction_bonds",b.error),T("battles",y.error),T("player_trainer_stats",k.error),T("player_stats",N.error),T("creature_stage_xp_thresholds",A.error),T("factions",E.error),t.data&&J(t.data),r.data&&f(r.data),s.data&&x(s.data.map(e=>{var t;return{...e,stage_stats:"string"==typeof e.stage_stats?JSON.parse(e.stage_stats):null!==(t=e.stage_stats)&&void 0!==t?t:{hp:0,atk:0,def:0,speed:0,faith:0}}})),n.data&&S(n.data),i.data&&m(i.data),c.data&&w(c.data),o.data&&v(o.data),d.data&&C(d.data),p.data&&q(p.data),h.data&&P(h.data),_.data&&O(_.data),j.data&&z(j.data),b.data&&D(b.data),y.data&&U(y.data),k.data&&R(k.data),N.data&&G(N.data),A.data&&$(A.data),E.data&&V(E.data),W(!0),e.length?(u("error"),g(e.join(" | "))):u("ready")};(0,s.useEffect)(()=>{"ready"===o&&Q()},[o,l]);let Y=(0,s.useMemo)(()=>({regions:h,creatures:j,creatureStages:b,playerCreatures:y,regionCreatures:k,cityCreatures:N,missions:A,missionProgress:E,achievements:T,userAchievements:M,bonds:B,battles:F,profile:Z,trainerStats:I,playerStats:X,xpThresholds:H,factions:K,cities:_,status:d,error:p,isLive:L,reload:Q}),[h,j,b,y,k,A,E,T,M,B,F,Z,I,X,H,K,d,p,L]);return(0,r.jsx)(c.Provider,{value:Y,children:t})}function o(){return(0,s.useContext)(c)}},4660:function(e,t,a){"use strict";a.d(t,{l:function(){return s}});let r=()=>{let e=window.localStorage.getItem("crfm_language");return"en"===e||"es"===e?e:(window.navigator.language||"").toLowerCase().startsWith("en")?"en":"es"},s=(e,t)=>t&&(t[r()]||t.es||t.en)||e},1180:function(e,t,a){"use strict";a.d(t,{O:function(){return n}});var r=a(3234);let s=null;function n(){if(s)return s;let e="https://npdklestjuejrotjtqwt.supabase.co",t="sb_publishable_9xEllkhUFl85xTTXtDDT5g_ei508t0r";return e&&t?s=(0,r.eI)(e,t,{auth:{persistSession:!0,autoRefreshToken:!0}}):null}}},function(e){e.O(0,[234,971,23,744],function(){return e(e.s=5411)}),_N_E=e.O()}]);