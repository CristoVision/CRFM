(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[857],{8678:function(e,a,t){Promise.resolve().then(t.bind(t,6337))},6337:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return S}});var n=t(7437),r=t(2265),i=t(495),l=t(6013),d=t(9135),s=t(931),o=t(371);function c(e){let{logs:a}=e;return(0,n.jsx)(l.Z,{title:"Recent battles",children:(0,n.jsxs)("div",{className:"du-list",children:[a.map((e,a)=>(0,n.jsxs)("div",{className:"du-card",style:{padding:10},children:[(0,n.jsxs)("div",{className:"du-chip-row",children:[(0,n.jsxs)(d.A,{children:["player1_id: ",e.player1_id]}),(0,n.jsxs)(d.A,{children:["player2_id: ",e.player2_id]})]}),(0,n.jsxs)("div",{className:"du-chip-row",children:[(0,n.jsxs)(d.A,{children:["Winner: ",e.winner_id]}),e.started_at?(0,n.jsxs)(d.A,{children:["Start: ",e.started_at]}):null,e.ended_at?(0,n.jsxs)(d.A,{children:["End: ",e.ended_at]}):null]}),(0,n.jsx)("div",{className:"du-meta",children:"string"==typeof e.battle_log?e.battle_log:JSON.stringify(e.battle_log)})]},a)),0===a.length&&(0,n.jsx)("p",{className:"du-meta",children:"No battles yet."})]})})}var u=t(1180);let h={fuego:{strong:["planta","hielo"],weak:["agua","tierra"]},agua:{strong:["fuego","tierra"],weak:["planta","electrico"]},planta:{strong:["agua","tierra"],weak:["fuego","hielo"]},electrico:{strong:["agua","aire"],weak:["tierra"]},tierra:{strong:["electrico","fuego"],weak:["agua","planta"]},aire:{strong:["planta"],weak:["electrico","hielo"]},hielo:{strong:["planta","aire"],weak:["fuego"]},luz:{strong:["sombra"],weak:["sombra"]},sombra:{strong:["luz"],weak:["luz"]}},m=[{id:"quick",label:"Corte Veloz",kind:"attack",power:8,accuracy:98,priority:1,description:"Golpe rapido que asegura la iniciativa."},{id:"heavy",label:"Golpe Titan",kind:"attack",power:12,accuracy:88,priority:0,description:"Ataque fuerte con alto impacto."},{id:"guard",label:"Guardia Santa",kind:"guard",power:0,accuracy:100,priority:0,description:"Reduce el siguiente dano y recupera HP."},{id:"focus",label:"Focus de Fe",kind:"focus",power:0,accuracy:100,priority:0,description:"Carga Bond y aumenta precision."},{id:"bond",label:"Ruptura de Bond",kind:"attack",power:14,accuracy:92,bondCost:40,priority:0,description:"Descarga Bond para un golpe devastador."}],p=(e,a,t)=>Math.max(1,Math.round(e*t/10-.28*a)),v=e=>(e||"").normalize("NFD").replace(/[^\w\s-]/g,"").toLowerCase().trim(),g=(e,a)=>{let t=v(e),n=v(a);if(!t||!n)return 1;let r=h[t];return r?r.strong.includes(n)?1.2:r.weak.includes(n)?.85:1:1},b=e=>!!e&&(e.startsWith("http")||e.startsWith("data:")),f=e=>(e||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9]+/g," ").trim(),x=["CotorraChick.png","CoquiTad.png","JibaroPup.png","JibaroPupS.png"];function j(e,a,t){let n=e?a.creatures.find(a=>a.id===e):void 0,r=[],i=e=>{e&&(b(e)?r.push(e):t&&r.push("".concat(t,"/storage/v1/object/public/").concat(e.replace(/^\//,""))))};if(i(null==n?void 0:n.image_url),t&&(null==n?void 0:n.name)){let e=f(n.name),a=e.replace(/ /g,""),t=e.toLowerCase().replace(/ /g,"-");x.forEach(e=>i("creatures/".concat(e))),["creatures/".concat(a,".png"),"creatures/".concat(t,".png"),"creatures/".concat(a,".jpg"),"creatures/".concat(t,".jpg"),"creatures/".concat(a,".webp"),"creatures/".concat(t,".webp"),"creatures/".concat(a,"S.png"),"creatures/".concat(a,"S.jpg"),"creatures/".concat(a,"S.webp")].forEach(i)}return r}function N(e,a,t){var n,r,i,l,d,s,o,c,u,h,m,p,v,g,b,f,x,j;if(!e)return{name:t.name,hp:null!==(n=t.hp)&&void 0!==n?n:20,atk:null!==(r=t.atk)&&void 0!==r?r:6,def:null!==(i=t.def)&&void 0!==i?i:3,spd:null!==(l=t.spd)&&void 0!==l?l:5,bond:null!==(d=t.bond)&&void 0!==d?d:0,baseType:t.baseType};let N=a.playerCreatures.find(a=>a.creature_id===e),_=a.creatures.find(a=>a.id===e),y=N&&N.current_stage_id?a.creatureStages.find(e=>e.id===N.current_stage_id):a.creatureStages.filter(a=>a.creature_id===e).sort((e,a)=>{var t,n;return(null!==(t=e.stage_order)&&void 0!==t?t:0)-(null!==(n=a.stage_order)&&void 0!==n?n:0)})[0],C=(null==y?void 0:y.stage_stats)||(null==N?void 0:N.stats)||{};return{id:e,stageId:null==y?void 0:y.id,name:(null==N?void 0:N.nickname)||(null==_?void 0:_.name)||t.name,hp:null!==(c=null!==(o=null!==(s=C.hp)&&void 0!==s?s:C.health)&&void 0!==o?o:t.hp)&&void 0!==c?c:20,atk:null!==(m=null!==(h=null!==(u=C.atk)&&void 0!==u?u:C.attack)&&void 0!==h?h:t.atk)&&void 0!==m?m:6,def:null!==(g=null!==(v=null!==(p=C.def)&&void 0!==p?p:C.defense)&&void 0!==v?v:t.def)&&void 0!==g?g:3,spd:null!==(x=null!==(f=null!==(b=C.speed)&&void 0!==b?b:C.spd)&&void 0!==f?f:t.spd)&&void 0!==x?x:5,bond:null!==(j=C.faith)&&void 0!==j?j:0,baseType:null==_?void 0:_.base_type}}let _=(e,a)=>{var t,n;return{...e,maxHp:e.hp,hp:null!=a?a:e.hp,bondAffinity:null!==(t=e.bond)&&void 0!==t?t:0,bondCharge:Math.min(100,(null!==(n=e.bond)&&void 0!==n?n:0)*4),guardTurns:0,focusTurns:0}},y=e=>{if(e.hp<=.35*e.maxHp)return m.find(e=>"guard"===e.id);if(e.bondCharge>=40)return m.find(e=>"bond"===e.id);let a=Math.random();return a<.45?m.find(e=>"quick"===e.id):a<.75?m.find(e=>"heavy"===e.id):m.find(e=>"focus"===e.id)},C=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return Math.max(a,Math.min(t,e))};function w(){var e,a,t,h,v,b,f;let{battle:x,startBattle:w,reset:k,addLog:T,awardStageAndXp:M,recordBattle:S}=(0,s.A)(),E=(0,o.G)(),A=(0,u.O)(),{profile:z,bonds:P,battles:D,trainerStats:H}=E,R=D[0],B="https://npdklestjuejrotjtqwt.supabase.co",q=B?"".concat(B,"/storage/v1/object/public/creatures/UnknownCreature.png"):void 0,[I,Z]=(0,r.useState)(null===(e=E.regions[0])||void 0===e?void 0:e.id),[F,G]=(0,r.useState)("trainer"),[L,O]=(0,r.useState)("idle"),[U,V]=(0,r.useState)(""),[J,W]=(0,r.useState)(1),[X,K]=(0,r.useState)(0),[Q,$]=(0,r.useState)({}),[Y,ee]=(0,r.useState)(null),[ea,et]=(0,r.useState)(null),[en,er]=(0,r.useState)(void 0),[ei,el]=(0,r.useState)("idle"),ed=E.playerCreatures.slice(0,6),es=null===(a=ed[X])||void 0===a?void 0:a.creature_id,eo=(0,r.useMemo)(()=>{var e,a;let t=null!=I?I:null===(e=E.regions[0])||void 0===e?void 0:e.id;if(!t)return;let n=(E.regionCreatures||[]).filter(e=>e.region_id===t);if(!n.length)return;let r=n.reduce((e,a)=>{var t;return e+(null!==(t=a.spawn_rate)&&void 0!==t?t:1)},0);if(r<=0)return n[0].creature_id;let i=Math.random()*r;for(let e of n)if((i-=null!==(a=e.spawn_rate)&&void 0!==a?a:1)<=0)return e.creature_id;return n[n.length-1].creature_id},[I,E.regionCreatures,E.regions]),ec=j(es,E,B),eu=j(en,E,B),eh=()=>N(es,E,{name:"Sin criatura",hp:22,atk:6,def:3,spd:5,bond:0}),em=(e,a)=>N(e,E,{name:"wild"===a?"Criatura salvaje":"Entrenador NPC",hp:20,atk:6,def:3,spd:4,bond:0,baseType:"wild"===a?"Salvaje":"Trainer"});(0,r.useEffect)(()=>{"idle"===x.mode&&(O("idle"),el("idle"),V(""),ee(null),et(null),$({}),er(void 0))},[x.mode]);let ep=e=>{var a,t;let n=null!=e?e:F;if(G(n),!ed.length)return;let r="wild"===n?eo:null===(a=E.creatures.find(e=>e.id!==es))||void 0===a?void 0:a.id;er(r);let i=eh(),l=em(r,n),d={};ed.forEach(e=>{d[e.creature_id]=N(e.creature_id,E,{name:""}).hp}),$(d),ee(_(i,null!==(t=d[null!=es?es:""])&&void 0!==t?t:i.hp)),et(_(l)),O("action"),el("idle"),W(1),V("wild"===n?"\xa1Aparece ".concat(l.name,"!"):"Desafio contra ".concat(l.name)),w(n)},ev=e=>{T(e)},eg=(e,a,t)=>{var n,r;let i=[];if("guard"===t.kind){e.guardTurns=1;let a=Math.min(e.maxHp-e.hp,4);return e.hp+=a,e.bondCharge=C(e.bondCharge+10),i.push("".concat(e.name," se protege y recupera ").concat(a," HP.")),i}if("focus"===t.kind)return e.focusTurns=2,e.bondCharge=C(e.bondCharge+22),i.push("".concat(e.name," concentra su fe. Bond +22.")),i;if(t.bondCost&&e.bondCharge<t.bondCost)return i.push("".concat(e.name," intento ").concat(t.label," pero no tiene Bond.")),i;if(100*Math.random()>(null!==(n=t.accuracy)&&void 0!==n?n:100)+(e.focusTurns>0?6:0))return i.push("".concat(e.name," fallo ").concat(t.label,".")),i;let l=p(e.atk,a.def,null!==(r=t.power)&&void 0!==r?r:10),d=g(e.baseType,a.baseType),s=Math.max(1,Math.round((l+("bond"===t.id?Math.round(.6*e.bondAffinity):0))*(.9+.2*Math.random())*d));return a.guardTurns>0&&(s=Math.max(1,Math.round(.6*s)),a.guardTurns=0,i.push("".concat(a.name," bloqueo parte del impacto."))),a.hp=Math.max(0,a.hp-s),e.bondCharge=C(e.bondCharge+12),t.bondCost&&(e.bondCharge=C(e.bondCharge-t.bondCost)),i.push("".concat(e.name," uso ").concat(t.label," (").concat(s," dmg). ").concat(d>1.05?"\xa1Super eficaz!":d<.95?"No muy eficaz.":"").trim()),i},eb=(e,a)=>{e.focusTurns>0&&(e.focusTurns-=1),a.focusTurns>0&&(a.focusTurns-=1)},ef=e=>{if(!Y||!ea)return;let a={...Y},t={...ea},n=y(t),r=[{who:"player",move:e,actor:a,target:t},{who:"enemy",move:n,actor:t,target:a}].sort((e,a)=>{var t,n;let r=null!==(t=e.move.priority)&&void 0!==t?t:0,i=null!==(n=a.move.priority)&&void 0!==n?n:0;return r!==i?i-r:e.actor.spd!==a.actor.spd?a.actor.spd-e.actor.spd:"player"===e.who?-1:1}),i=[];for(let e of r){if(a.hp<=0||t.hp<=0)break;i.push(...eg(e.actor,e.target,e.move))}if(eb(a,t),i.forEach(ev),ee(a),et(t),es&&$(e=>({...e,[es]:a.hp})),t.hp<=0){var l;ev("Victoria: enemigo derrotado."),el("victory"),O("outcome"),V("\xa1Victoria!"),es&&M({creatureId:es,xpGain:12}),S({winner_id:null!==(l=null==z?void 0:z.id)&&void 0!==l?l:"npc",battle_log:x.log.join(" | ")});return}if(a.hp<=0){ev("Derrota: tu criatura cayo."),el("defeat"),O("outcome"),V("Derrota."),S({winner_id:"npc",battle_log:x.log.join(" | ")});return}let d=J+1;W(d),O("action"),V("Turno ".concat(d,": \xbfque hara ").concat(a.name,"?"))},ex=e=>{var a,t;if(e===X||!Y||!ea)return;let n=null===(a=ed[e])||void 0===a?void 0:a.creature_id;if(!n)return;let r=null!==(t=Q[n])&&void 0!==t?t:N(n,E,{name:""}).hp;if(r<=0)return;let i=_(N(n,E,{name:""}),r);K(e),ee(i);let l={...ea},d=y(l);eg(l,i,d).forEach(ev),ee(i),et(l),$(e=>({...e,[n]:i.hp})),i.hp<=0?(el("defeat"),O("outcome"),V("Derrota.")):(O("action"),V("Cambio listo. \xbfQue hara ".concat(i.name,"?")))},ej=async()=>{var e,a,t;if("wild"!==F||!A||!(null==z?void 0:z.id)||!(null==ea?void 0:ea.id)||!ea)return;let n=ea.hp,r=ea.maxHp,i=E.regionCreatures.find(e=>{var a;return e.creature_id===ea.id&&e.region_id===(null!=I?I:null===(a=E.regions[0])||void 0===a?void 0:a.id)}),l=25+50*Math.max(0,(r-n)/r)+Math.min(20,2*(null!==(e=null==i?void 0:i.spawn_rate)&&void 0!==e?e:1));if(l>90&&(l=90),!(100*Math.random()<=l)){ev("Domesticar fallo (".concat(Math.round(l),"% chance).")),V("El enemigo se resiste."),ef(m.find(e=>"guard"===e.id));return}let d=E.creatureStages.filter(e=>e.creature_id===ea.id).sort((e,a)=>{var t,n;return(null!==(t=e.stage_order)&&void 0!==t?t:0)-(null!==(n=a.stage_order)&&void 0!==n?n:0)})[0];await A.from("player_creatures").insert({user_id:z.id,creature_id:ea.id,current_stage_id:null!==(a=null==d?void 0:d.id)&&void 0!==a?a:null,current_xp:0,nickname:ea.name,is_domesticated:!0,domesticated_at:new Date().toISOString(),level:null!==(t=null==d?void 0:d.stage_order)&&void 0!==t?t:1}),ev("Domesticaste a ".concat(ea.name,".")),el("capture"),O("outcome"),V("Domesticar exitoso."),S({winner_id:z.id,battle_log:[...x.log,"Domesticar ".concat(ea.name)].join(" | ")}),E.reload()},eN=m.filter(e=>"attack"===e.kind||"guard"===e.id);return(0,n.jsxs)("div",{className:"du-grid two",children:[(0,n.jsx)(l.Z,{title:"Arena",badge:(0,n.jsx)(d.A,{children:"idle"===x.mode?"Idle":"Modo: ".concat(x.mode)}),children:(0,n.jsxs)("div",{className:"du-arena-shell",children:[(0,n.jsxs)("div",{className:"du-mode-tabs",children:[(0,n.jsx)("button",{className:"du-mode-chip".concat("wild"===F?" active":""),onClick:()=>{ep("wild")},children:"Encuentro"}),(0,n.jsx)("button",{className:"du-mode-chip".concat("trainer"===F?" active":""),onClick:()=>{ep("trainer")},children:"Entrenador"}),(0,n.jsx)("button",{className:"du-mode-chip".concat("pvp"===F?" active":""),onClick:()=>{ep("pvp")},children:"PvP"}),"wild"===F&&(0,n.jsx)("select",{className:"du-select",value:null!=I?I:"",onChange:e=>Z(e.target.value),children:E.regions.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))})]}),ed.length?null:(0,n.jsx)("div",{className:"du-callout",children:"Necesitas domesticar al menos una criatura para iniciar combates."}),"idle"===L?(0,n.jsx)("div",{className:"du-callout",children:"Selecciona un modo para iniciar la batalla."}):null,Y&&ea?(0,n.jsxs)("div",{className:"du-battle-stage",children:[(0,n.jsxs)("div",{className:"du-battle-hud enemy",children:[(0,n.jsx)("div",{className:"du-battle-name",children:ea.name}),(0,n.jsx)("div",{className:"du-battle-type",children:null!==(t=ea.baseType)&&void 0!==t?t:"Tipo"}),(0,n.jsx)("div",{className:"du-hp-bar",children:(0,n.jsx)("span",{style:{width:"".concat(ea.hp/ea.maxHp*100,"%")}})}),(0,n.jsxs)("div",{className:"du-hp-meta",children:["HP ",ea.hp,"/",ea.maxHp]}),(0,n.jsx)("div",{className:"du-battle-portrait",children:(0,n.jsx)("img",{src:null!==(h=eu[0])&&void 0!==h?h:q,alt:ea.name,className:"du-card-img",onError:e=>{let a=e.currentTarget;a.src!==q&&q&&(a.src=q)}})})]}),(0,n.jsxs)("div",{className:"du-battle-hud player",children:[(0,n.jsx)("div",{className:"du-battle-name",children:Y.name}),(0,n.jsx)("div",{className:"du-battle-type",children:null!==(v=Y.baseType)&&void 0!==v?v:"Tipo"}),(0,n.jsx)("div",{className:"du-hp-bar",children:(0,n.jsx)("span",{style:{width:"".concat(Y.hp/Y.maxHp*100,"%")}})}),(0,n.jsxs)("div",{className:"du-hp-meta",children:["HP ",Y.hp,"/",Y.maxHp]}),(0,n.jsxs)("div",{className:"du-bond-row",children:[(0,n.jsx)("span",{children:"Bond"}),(0,n.jsx)("div",{className:"du-bond-bar",children:(0,n.jsx)("span",{style:{width:"".concat(Y.bondCharge,"%")}})}),(0,n.jsx)("span",{children:Y.bondCharge})]}),(0,n.jsx)("div",{className:"du-battle-portrait",children:(0,n.jsx)("img",{src:null!==(b=ec[0])&&void 0!==b?b:q,alt:Y.name,className:"du-card-img",onError:e=>{let a=e.currentTarget;a.src!==q&&q&&(a.src=q)}})})]})]}):null,(0,n.jsx)("div",{className:"du-battle-textbox",children:(0,n.jsx)("div",{className:"du-meta",children:U||"Preparando combate..."})}),"action"===L&&Y&&ea?(0,n.jsxs)("div",{className:"du-battle-menu",children:[(0,n.jsx)(i.z,{onClick:()=>O("move"),className:"du-action-btn",children:"Atacar"}),(0,n.jsx)(i.z,{variant:"ghost",onClick:()=>O("switch"),className:"du-action-btn",children:"Cambiar"}),(0,n.jsx)(i.z,{variant:"ghost",onClick:()=>ef(m.find(e=>"focus"===e.id)),className:"du-action-btn",children:"Bond"}),"wild"===F?(0,n.jsx)(i.z,{variant:"ghost",onClick:()=>{if("wild"===F&&Y&&ea){if(100*Math.random()<=C(40+(Y.spd-ea.spd)*5,10,80)){ev("Escapaste del combate."),el("run"),O("outcome"),V("Escapaste sin perder honor.");return}ev("No pudiste escapar."),ef(m.find(e=>"guard"===e.id))}},className:"du-action-btn",children:"Escapar"}):(0,n.jsx)(i.z,{variant:"ghost",onClick:()=>ef(m.find(e=>"guard"===e.id)),className:"du-action-btn",children:"Defender"})]}):null,"move"===L&&Y?(0,n.jsxs)("div",{className:"du-battle-menu du-move-menu",children:[eN.map(e=>(0,n.jsxs)("button",{className:"du-move-btn".concat(e.bondCost&&Y.bondCharge<e.bondCost?" disabled":""),onClick:()=>{e.bondCost&&Y.bondCharge<e.bondCost||ef(e)},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:e.label}),(0,n.jsx)("span",{className:"du-meta",children:e.description})]}),e.bondCost?(0,n.jsxs)("span",{className:"du-move-cost",children:["Bond ",e.bondCost]}):null]},e.id)),"wild"===F?(0,n.jsx)("button",{className:"du-move-btn",onClick:ej,children:(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Domesticar"}),(0,n.jsx)("span",{className:"du-meta",children:"Intenta capturar si esta debilitado."})]})}):null,(0,n.jsx)(i.z,{variant:"ghost",onClick:()=>O("action"),className:"du-action-btn",children:"Regresar"})]}):null,"switch"===L&&ed.length>1?(0,n.jsxs)("div",{className:"du-battle-menu du-switch-menu",children:[ed.map((e,a)=>{var t;let r=null!==(t=Q[e.creature_id])&&void 0!==t?t:N(e.creature_id,E,{name:""}).hp;return(0,n.jsx)("button",{className:"du-move-btn".concat(a===X?" active":"").concat(r<=0?" disabled":""),onClick:()=>ex(a),children:(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:e.nickname||e.creature_id.slice(0,6)}),(0,n.jsxs)("span",{className:"du-meta",children:["HP ",r]})]})},e.creature_id)}),(0,n.jsx)(i.z,{variant:"ghost",onClick:()=>O("action"),className:"du-action-btn",children:"Regresar"})]}):null,"outcome"===L?(0,n.jsxs)("div",{className:"du-callout",children:["victory"===ei&&"Victoria: ganas XP y reputacion.","defeat"===ei&&"Derrota: reagrupa tu equipo.","run"===ei&&"Escapaste del combate.","capture"===ei&&"Criatura domestica a\xf1adida.",(0,n.jsxs)("div",{className:"du-chip-row",style:{marginTop:10},children:[(0,n.jsx)(i.z,{onClick:()=>{k(),ep()},variant:"ghost",children:"Nueva batalla"}),(0,n.jsx)(i.z,{onClick:()=>window.location.assign("/map"),variant:"ghost",children:"Ir al mapa"})]})]}):null]})}),(0,n.jsxs)(l.Z,{title:"Rewards",badge:(0,n.jsxs)(d.A,{children:["Wallet: ",null!==(f=null==z?void 0:z.wallet_balances)&&void 0!==f?f:0," CC"]}),children:[(0,n.jsx)("p",{children:"Cross Coins de profiles.wallet_balances \xb7 Bonds de player_faction_bonds."}),(0,n.jsx)("div",{className:"du-chip-row",children:P.map(e=>(0,n.jsxs)(d.A,{children:[e.faction,": ",e.bond_amount," Bonds"]},e.faction))}),(0,n.jsx)("div",{className:"du-divider"}),R?(0,n.jsxs)("div",{className:"du-meta",children:["Ultima batalla: ",R.winner_id," gano \xb7 ",R.battle_log]}):(0,n.jsx)("div",{className:"du-meta",children:"No battles yet"}),(0,n.jsx)("div",{className:"du-divider"}),(0,n.jsxs)("div",{className:"du-meta",children:["Trainer stats tracked: ",H.length]})]}),(0,n.jsx)(c,{logs:D.slice(0,5)})]})}function k(){let e=(0,o.G)(),{tutorial:a,setStarterChoice:t,startTutorial:c,completeTutorial:u,skipTutorial:h,addLog:m,battle:p,reset:v,awardXp:g,recordBattle:b}=(0,s.A)(),[f,x]=(0,r.useState)([]),[j,N]=(0,r.useState)("idle"),_=0===e.playerCreatures.length,y="completed"!==a.status,C=(0,r.useMemo)(()=>e.creatures.slice(0,3),[e.creatures]),w=e=>{t(e),c()};return y?(0,n.jsxs)(l.Z,{title:"Tutorial de batalla",badge:(0,n.jsx)(d.A,{children:"in_progress"===a.status?"En progreso":_?"Elige starter":"Recomendado"}),footer:(0,n.jsxs)("div",{className:"du-chip-row",children:[(0,n.jsx)(i.z,{variant:"ghost",onClick:h,children:"Omitir"}),"in_progress"===a.status?(0,n.jsx)(i.z,{onClick:()=>{var t,n,r,i,l;let d=a.starterChoice||(null===(t=e.playerCreatures[0])||void 0===t?void 0:t.creature_id);if(!d)return;let s=function(e,a){let t=[],n=e.hp,r=a.hp,i=e.spd>=a.spd,l=(e,a)=>Math.max(1,Math.round(e-.4*a));for(;n>0&&r>0&&t.length<12;){if(i){let n=l(e.atk,a.def);r-=n,t.push("".concat(e.name," ataca (").concat(n," dmg). Enemigo HP ").concat(Math.max(r,0),"/").concat(a.hp))}else{let r=l(a.atk,e.def);n-=r,t.push("".concat(a.name," ataca (").concat(r," dmg). Tu HP ").concat(Math.max(n,0),"/").concat(e.hp))}i=!i}return{log:t,winner:n>0?"player":"enemy"}}(function(e,a,t){var n,r,i,l,d,s,o,c;let u=t.playerCreatures.find(a=>a.creature_id===e),h=t.creatures.find(a=>a.id===e),m=u?t.creatureStages.find(e=>e.id===u.current_stage_id):void 0,p=(null==m?void 0:m.stage_stats)||(null==u?void 0:u.stats)||{};return{name:(null==u?void 0:u.nickname)||(null==h?void 0:h.name)||a,hp:null!==(r=null!==(n=p.hp)&&void 0!==n?n:p.health)&&void 0!==r?r:20,atk:null!==(l=null!==(i=p.atk)&&void 0!==i?i:p.attack)&&void 0!==l?l:5,def:null!==(s=null!==(d=p.def)&&void 0!==d?d:p.defense)&&void 0!==s?s:3,spd:null!==(c=null!==(o=p.speed)&&void 0!==o?o:p.spd)&&void 0!==c?c:5}}(d,"Starter",e),{name:"Entrenador de pr\xe1ctica",hp:18,atk:6,def:3,spd:4});x(s.log),s.log.forEach(m),N("player"===s.winner?"player":"enemy"),u(),"player"===s.winner&&(g(d,(null!==(i=null===(n=e.playerCreatures.find(e=>e.creature_id===d))||void 0===n?void 0:n.current_xp)&&void 0!==i?i:0)+10),b({winner_id:null!==(l=null===(r=e.profile)||void 0===r?void 0:r.id)&&void 0!==l?l:"npc",battle_log:s.log.join(" | ")}))},children:"Jugar tutorial"}):_?null:(0,n.jsx)(i.z,{onClick:c,children:"Iniciar tutorial"}),(0,n.jsx)(i.z,{variant:"ghost",onClick:v,children:"Reset batalla"})]}),children:[_&&"in_progress"!==a.status?(0,n.jsx)("div",{className:"du-grid three",children:C.map(e=>(0,n.jsx)(l.Z,{title:e.name,badge:(0,n.jsx)(d.A,{children:e.base_type}),footer:(0,n.jsx)(i.z,{onClick:()=>w(e.id),className:"du-btn-full",children:"Elegir"}),children:(0,n.jsxs)("div",{className:"du-meta",children:["Regi\xf3n: ",e.region]})},e.id))}):(0,n.jsxs)("div",{className:"du-list",children:[(0,n.jsx)("div",{className:"du-meta",children:"1) Ataca y vence al sparring para ganar XP."}),(0,n.jsx)("div",{className:"du-meta",children:"2) Puedes saltar este tutorial en cualquier momento."}),(0,n.jsx)("div",{className:"du-meta",children:"3) Recompensa: XP y desbloquear combates completos."})]}),f.length>0&&(0,n.jsxs)("div",{className:"du-list",style:{marginTop:10},children:[f.map((e,a)=>(0,n.jsx)("div",{className:"du-meta",children:e},a)),"idle"!==j&&(0,n.jsx)(d.A,{children:"player"===j?"Victoria":"Derrota"})]}),p.log.length>0&&(0,n.jsxs)("div",{className:"du-list",style:{marginTop:10},children:[(0,n.jsx)("div",{className:"du-meta",children:"Log de batalla"}),p.log.map((e,a)=>(0,n.jsx)("div",{className:"du-meta",children:e},a))]})]}):null}var T=t(857),M=t(357);function S(){let e=(0,o.G)(),{status:a}=(0,T.a)(),t=M.env.NEXT_PUBLIC_CRFM_URL,r=t?t.replace(/\/$/,""):"";return(0,n.jsxs)("div",{className:"du-stack",children:[(0,n.jsx)(l.Z,{title:"Battle",badge:(0,n.jsx)(d.A,{children:"Turn-based"}),children:(0,n.jsx)("p",{className:"du-meta",children:"Use your domesticated creatures and stage stats for HP/ATK/DEF/speed/faith. Rewards: wallet_balances + faction bonds."})}),"ready"!==a?(0,n.jsxs)(l.Z,{title:"Sesion requerida",badge:(0,n.jsx)(d.A,{children:"CRFM"}),children:[(0,n.jsx)("p",{className:"du-meta",children:"Inicia sesion en CRFM para activar batallas y progreso."}),(0,n.jsx)("a",{className:"du-button",href:"".concat(r,"/?auth=login"),rel:"noreferrer",children:"Ir a CRFM"})]}):null,(0,n.jsx)(w,{}),(0,n.jsx)(l.Z,{title:"Battles count",badge:(0,n.jsx)(d.A,{children:e.battles.length}),children:(0,n.jsx)("p",{className:"du-meta",children:"Latest battles are listed in the log below."})}),(0,n.jsx)(k,{})]})}},6013:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});var n=t(7437);function r(e){let{children:a,title:t,badge:r,footer:i,className:l}=e;return(0,n.jsxs)("div",{className:["du-card",l].filter(Boolean).join(" "),children:[(t||r)&&(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[t?(0,n.jsx)("h3",{style:{margin:0},children:t}):(0,n.jsx)("span",{}),r]}),a,i?(0,n.jsx)("div",{style:{marginTop:10},children:i}):null]})}}},function(e){e.O(0,[234,366,971,23,744],function(){return e(e.s=8678)}),_N_E=e.O()}]);