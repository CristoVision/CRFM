(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[857],{8678:function(e,a,t){Promise.resolve().then(t.bind(t,6337))},6337:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return A}});var n=t(7437),r=t(2265),l=t(495),i=t(6013),s=t(9135),d=t(931),o=t(371);function c(e){let{logs:a}=e;return(0,n.jsx)(i.Z,{title:"Recent battles",children:(0,n.jsxs)("div",{className:"du-list",children:[a.map((e,a)=>(0,n.jsxs)("div",{className:"du-card",style:{padding:10},children:[(0,n.jsxs)("div",{className:"du-chip-row",children:[(0,n.jsxs)(s.A,{children:["player1_id: ",e.player1_id]}),(0,n.jsxs)(s.A,{children:["player2_id: ",e.player2_id]})]}),(0,n.jsxs)("div",{className:"du-chip-row",children:[(0,n.jsxs)(s.A,{children:["Winner: ",e.winner_id]}),e.started_at?(0,n.jsxs)(s.A,{children:["Start: ",e.started_at]}):null,e.ended_at?(0,n.jsxs)(s.A,{children:["End: ",e.ended_at]}):null]}),(0,n.jsx)("div",{className:"du-meta",children:"string"==typeof e.battle_log?e.battle_log:JSON.stringify(e.battle_log)})]},a)),0===a.length&&(0,n.jsx)("p",{className:"du-meta",children:"No battles yet."})]})})}var u=t(1180);let h={fuego:{strong:["planta","hielo"],weak:["agua","tierra"]},agua:{strong:["fuego","tierra"],weak:["planta","electrico"]},planta:{strong:["agua","tierra"],weak:["fuego","hielo"]},electrico:{strong:["agua","aire"],weak:["tierra"]},tierra:{strong:["electrico","fuego"],weak:["agua","planta"]},aire:{strong:["planta"],weak:["electrico","hielo"]},hielo:{strong:["planta","aire"],weak:["fuego"]},luz:{strong:["sombra"],weak:["sombra"]},sombra:{strong:["luz"],weak:["luz"]}},m=[{id:"quick",label:"Corte Veloz",kind:"attack",power:8,accuracy:98,priority:1,description:"Golpe rapido que asegura la iniciativa."},{id:"heavy",label:"Golpe Titan",kind:"attack",power:12,accuracy:88,priority:0,description:"Ataque fuerte con alto impacto."},{id:"guard",label:"Guardia Santa",kind:"guard",power:0,accuracy:100,priority:0,description:"Reduce el siguiente dano y recupera HP."},{id:"focus",label:"Focus de Fe",kind:"focus",power:0,accuracy:100,priority:0,description:"Carga Bond y aumenta precision."},{id:"bond",label:"Ruptura de Bond",kind:"attack",power:14,accuracy:92,bondCost:40,priority:0,description:"Descarga Bond para un golpe devastador."}],p=(e,a,t)=>Math.max(1,Math.round(e*t/10-.28*a)),v=e=>(e||"").normalize("NFD").replace(/[^\w\s-]/g,"").toLowerCase().trim(),g=(e,a)=>{let t=v(e),n=v(a);if(!t||!n)return 1;let r=h[t];return r?r.strong.includes(n)?1.2:r.weak.includes(n)?.85:1:1},x=e=>!!e&&(e.startsWith("http")||e.startsWith("data:")),f=e=>(e||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9]+/g," ").trim(),b=["CotorraChick.png","CoquiTad.png","JibaroPup.png","JibaroPupS.png"],j=e=>"male"===e?"♂":"female"===e?"♀":"";function _(e,a,t,n,r){let l=e?n.creatures.find(a=>a.id===e):void 0,i=a?n.creatureStages.find(e=>e.id===a):n.creatureStages.find(a=>a.creature_id===e),s=[],d=e=>{e&&(x(e)?s.push(e):r&&s.push("".concat(r,"/storage/v1/object/public/").concat(e.replace(/^\//,""))))};if("male"===t&&d((null==i?void 0:i.image_url_male)||void 0),"female"===t&&d((null==i?void 0:i.image_url_female)||void 0),d(null==i?void 0:i.image_url),d(null==l?void 0:l.image_url),r&&(null==l?void 0:l.name)){let e=f(l.name),a=e.replace(/ /g,""),t=e.toLowerCase().replace(/ /g,"-");b.forEach(e=>d("creatures/".concat(e))),["creatures/".concat(a,".png"),"creatures/".concat(t,".png"),"creatures/".concat(a,".jpg"),"creatures/".concat(t,".jpg"),"creatures/".concat(a,".webp"),"creatures/".concat(t,".webp"),"creatures/".concat(a,"S.png"),"creatures/".concat(a,"S.jpg"),"creatures/".concat(a,"S.webp")].forEach(d)}return s}function N(e,a,t){var n,r,l,i,s,d,o,c,u,h,m,p,v,g,x,f,b,j,_,N;if(!e)return{name:t.name,hp:null!==(n=t.hp)&&void 0!==n?n:20,atk:null!==(r=t.atk)&&void 0!==r?r:6,def:null!==(l=t.def)&&void 0!==l?l:3,spd:null!==(i=t.spd)&&void 0!==i?i:5,bond:null!==(s=t.bond)&&void 0!==s?s:0,baseType:t.baseType};let y=a.playerCreatures.find(a=>a.creature_id===e),C=a.creatures.find(a=>a.id===e),w=y&&y.current_stage_id?a.creatureStages.find(e=>e.id===y.current_stage_id):a.creatureStages.filter(a=>a.creature_id===e).sort((e,a)=>{var t,n;return(null!==(t=e.stage_order)&&void 0!==t?t:0)-(null!==(n=a.stage_order)&&void 0!==n?n:0)})[0],k=(null==w?void 0:w.stage_stats)||(null==y?void 0:y.stats)||{};return{id:e,stageId:null==w?void 0:w.id,name:(null==y?void 0:y.nickname)||(null==C?void 0:C.name)||t.name,hp:null!==(c=null!==(o=null!==(d=k.hp)&&void 0!==d?d:k.health)&&void 0!==o?o:t.hp)&&void 0!==c?c:20,atk:null!==(m=null!==(h=null!==(u=k.atk)&&void 0!==u?u:k.attack)&&void 0!==h?h:t.atk)&&void 0!==m?m:6,def:null!==(g=null!==(v=null!==(p=k.def)&&void 0!==p?p:k.defense)&&void 0!==v?v:t.def)&&void 0!==g?g:3,spd:null!==(b=null!==(f=null!==(x=k.speed)&&void 0!==x?x:k.spd)&&void 0!==f?f:t.spd)&&void 0!==b?b:5,bond:null!==(j=k.faith)&&void 0!==j?j:0,baseType:null==C?void 0:C.base_type,sex:null!==(N=null!==(_=null==y?void 0:y.sex)&&void 0!==_?_:t.sex)&&void 0!==N?N:null}}let y=(e,a)=>{var t,n;return{...e,maxHp:e.hp,hp:null!=a?a:e.hp,bondAffinity:null!==(t=e.bond)&&void 0!==t?t:0,bondCharge:Math.min(100,(null!==(n=e.bond)&&void 0!==n?n:0)*4),guardTurns:0,focusTurns:0}},C=e=>{if(e.hp<=.35*e.maxHp)return m.find(e=>"guard"===e.id);if(e.bondCharge>=40)return m.find(e=>"bond"===e.id);let a=Math.random();return a<.45?m.find(e=>"quick"===e.id):a<.75?m.find(e=>"heavy"===e.id):m.find(e=>"focus"===e.id)},w=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return Math.max(a,Math.min(t,e))};function k(){var e,a,t,h,v,x,f,b,k,T;let{battle:S,startBattle:M,reset:E,addLog:A,awardStageAndXp:z,recordBattle:P}=(0,d.A)(),D=(0,o.G)(),H=(0,u.O)(),{profile:R,bonds:B,battles:I,trainerStats:q}=D,Z=I[0],F="https://npdklestjuejrotjtqwt.supabase.co",G=F?"".concat(F,"/storage/v1/object/public/creatures/UnknownCreature.png"):void 0,[L,O]=(0,r.useState)(null===(e=D.regions[0])||void 0===e?void 0:e.id),[U,V]=(0,r.useState)("trainer"),[W,J]=(0,r.useState)("idle"),[X,K]=(0,r.useState)(""),[Q,$]=(0,r.useState)(1),[Y,ee]=(0,r.useState)(0),[ea,et]=(0,r.useState)({}),[en,er]=(0,r.useState)(null),[el,ei]=(0,r.useState)(null),[es,ed]=(0,r.useState)(void 0),[eo,ec]=(0,r.useState)(null),[eu,eh]=(0,r.useState)("idle"),em=D.playerCreatures.slice(0,6),ep=null===(a=em[Y])||void 0===a?void 0:a.creature_id,ev=(0,r.useMemo)(()=>{var e,a;let t=null!=L?L:null===(e=D.regions[0])||void 0===e?void 0:e.id;if(!t)return;let n=(D.regionCreatures||[]).filter(e=>e.region_id===t);if(!n.length)return;let r=n.reduce((e,a)=>{var t;return e+(null!==(t=a.spawn_rate)&&void 0!==t?t:1)},0);if(r<=0)return n[0].creature_id;let l=Math.random()*r;for(let e of n)if((l-=null!==(a=e.spawn_rate)&&void 0!==a?a:1)<=0)return e.creature_id;return n[n.length-1].creature_id},[L,D.regionCreatures,D.regions]),eg=_(ep,null==en?void 0:en.stageId,null==en?void 0:en.sex,D,F),ex=_(es,null==el?void 0:el.stageId,null!==(t=null==el?void 0:el.sex)&&void 0!==t?t:eo,D,F),ef=()=>N(ep,D,{name:"Sin criatura",hp:22,atk:6,def:3,spd:5,bond:0}),eb=(e,a,t)=>N(e,D,{name:"wild"===a?"Criatura salvaje":"Entrenador NPC",hp:20,atk:6,def:3,spd:4,bond:0,sex:null!=t?t:null,baseType:"wild"===a?"Salvaje":"Trainer"});(0,r.useEffect)(()=>{"idle"===S.mode&&(J("idle"),eh("idle"),K(""),er(null),ei(null),et({}),ed(void 0),ec(null))},[S.mode]);let ej=e=>{var a,t;let n=null!=e?e:U;if(V(n),!em.length)return;let r="wild"===n?ev:null===(a=D.creatures.find(e=>e.id!==ep))||void 0===a?void 0:a.id;ed(r);let l=D.creatures.find(e=>e.id===r),i=(null==l?void 0:l.sexes)&&l.sexes.length?l.sexes:["male","female"],s=i[Math.floor(Math.random()*i.length)];ec(s);let d=ef(),o=eb(r,n,s),c={};em.forEach(e=>{c[e.creature_id]=N(e.creature_id,D,{name:""}).hp}),et(c),er(y(d,null!==(t=c[null!=ep?ep:""])&&void 0!==t?t:d.hp)),ei(y(o)),J("action"),eh("idle"),$(1),K("wild"===n?"\xa1Aparece ".concat(o.name,"!"):"Desafio contra ".concat(o.name)),M(n)},e_=e=>{A(e)},eN=(e,a,t)=>{var n,r;let l=[];if("guard"===t.kind){e.guardTurns=1;let a=Math.min(e.maxHp-e.hp,4);return e.hp+=a,e.bondCharge=w(e.bondCharge+10),l.push("".concat(e.name," se protege y recupera ").concat(a," HP.")),l}if("focus"===t.kind)return e.focusTurns=2,e.bondCharge=w(e.bondCharge+22),l.push("".concat(e.name," concentra su fe. Bond +22.")),l;if(t.bondCost&&e.bondCharge<t.bondCost)return l.push("".concat(e.name," intento ").concat(t.label," pero no tiene Bond.")),l;if(100*Math.random()>(null!==(n=t.accuracy)&&void 0!==n?n:100)+(e.focusTurns>0?6:0))return l.push("".concat(e.name," fallo ").concat(t.label,".")),l;let i=p(e.atk,a.def,null!==(r=t.power)&&void 0!==r?r:10),s=g(e.baseType,a.baseType),d=Math.max(1,Math.round((i+("bond"===t.id?Math.round(.6*e.bondAffinity):0))*(.9+.2*Math.random())*s));return a.guardTurns>0&&(d=Math.max(1,Math.round(.6*d)),a.guardTurns=0,l.push("".concat(a.name," bloqueo parte del impacto."))),a.hp=Math.max(0,a.hp-d),e.bondCharge=w(e.bondCharge+12),t.bondCost&&(e.bondCharge=w(e.bondCharge-t.bondCost)),l.push("".concat(e.name," uso ").concat(t.label," (").concat(d," dmg). ").concat(s>1.05?"\xa1Super eficaz!":s<.95?"No muy eficaz.":"").trim()),l},ey=(e,a)=>{e.focusTurns>0&&(e.focusTurns-=1),a.focusTurns>0&&(a.focusTurns-=1)},eC=e=>{if(!en||!el)return;let a={...en},t={...el},n=C(t),r=[{who:"player",move:e,actor:a,target:t},{who:"enemy",move:n,actor:t,target:a}].sort((e,a)=>{var t,n;let r=null!==(t=e.move.priority)&&void 0!==t?t:0,l=null!==(n=a.move.priority)&&void 0!==n?n:0;return r!==l?l-r:e.actor.spd!==a.actor.spd?a.actor.spd-e.actor.spd:"player"===e.who?-1:1}),l=[];for(let e of r){if(a.hp<=0||t.hp<=0)break;l.push(...eN(e.actor,e.target,e.move))}if(ey(a,t),l.forEach(e_),er(a),ei(t),ep&&et(e=>({...e,[ep]:a.hp})),t.hp<=0){var i;e_("Victoria: enemigo derrotado."),eh("victory"),J("outcome"),K("\xa1Victoria!"),ep&&z({creatureId:ep,xpGain:12}),P({winner_id:null!==(i=null==R?void 0:R.id)&&void 0!==i?i:"npc",battle_log:S.log.join(" | ")});return}if(a.hp<=0){e_("Derrota: tu criatura cayo."),eh("defeat"),J("outcome"),K("Derrota."),P({winner_id:"npc",battle_log:S.log.join(" | ")});return}let s=Q+1;$(s),J("action"),K("Turno ".concat(s,": \xbfque hara ").concat(a.name,"?"))},ew=e=>{var a,t;if(e===Y||!en||!el)return;let n=null===(a=em[e])||void 0===a?void 0:a.creature_id;if(!n)return;let r=null!==(t=ea[n])&&void 0!==t?t:N(n,D,{name:""}).hp;if(r<=0)return;let l=y(N(n,D,{name:""}),r);ee(e),er(l);let i={...el},s=C(i);eN(i,l,s).forEach(e_),er(l),ei(i),et(e=>({...e,[n]:l.hp})),l.hp<=0?(eh("defeat"),J("outcome"),K("Derrota.")):(J("action"),K("Cambio listo. \xbfQue hara ".concat(l.name,"?")))},ek=async()=>{var e,a,t,n;if("wild"!==U||!H||!(null==R?void 0:R.id)||!(null==el?void 0:el.id)||!el)return;let r=el.hp,l=el.maxHp,i=D.regionCreatures.find(e=>{var a;return e.creature_id===el.id&&e.region_id===(null!=L?L:null===(a=D.regions[0])||void 0===a?void 0:a.id)}),s=25+50*Math.max(0,(l-r)/l)+Math.min(20,2*(null!==(e=null==i?void 0:i.spawn_rate)&&void 0!==e?e:1));if(s>90&&(s=90),!(100*Math.random()<=s)){e_("Domesticar fallo (".concat(Math.round(s),"% chance).")),K("El enemigo se resiste."),eC(m.find(e=>"guard"===e.id));return}let d=D.creatureStages.filter(e=>e.creature_id===el.id).sort((e,a)=>{var t,n;return(null!==(t=e.stage_order)&&void 0!==t?t:0)-(null!==(n=a.stage_order)&&void 0!==n?n:0)})[0];await H.from("player_creatures").insert({user_id:R.id,creature_id:el.id,current_stage_id:null!==(a=null==d?void 0:d.id)&&void 0!==a?a:null,current_xp:0,nickname:el.name,is_domesticated:!0,domesticated_at:new Date().toISOString(),level:null!==(t=null==d?void 0:d.stage_order)&&void 0!==t?t:1,sex:null!==(n=el.sex)&&void 0!==n?n:null}),e_("Domesticaste a ".concat(el.name,".")),eh("capture"),J("outcome"),K("Domesticar exitoso."),P({winner_id:R.id,battle_log:[...S.log,"Domesticar ".concat(el.name)].join(" | ")}),D.reload()},eT=m.filter(e=>"attack"===e.kind||"guard"===e.id);return(0,n.jsxs)("div",{className:"du-grid two",children:[(0,n.jsx)(i.Z,{title:"Arena",badge:(0,n.jsx)(s.A,{children:"idle"===S.mode?"Idle":"Modo: ".concat(S.mode)}),children:(0,n.jsxs)("div",{className:"du-arena-shell",children:[(0,n.jsxs)("div",{className:"du-mode-tabs",children:[(0,n.jsx)("button",{className:"du-mode-chip".concat("wild"===U?" active":""),onClick:()=>{ej("wild")},children:"Encuentro"}),(0,n.jsx)("button",{className:"du-mode-chip".concat("trainer"===U?" active":""),onClick:()=>{ej("trainer")},children:"Entrenador"}),(0,n.jsx)("button",{className:"du-mode-chip".concat("pvp"===U?" active":""),onClick:()=>{ej("pvp")},children:"PvP"}),"wild"===U&&(0,n.jsx)("select",{className:"du-select",value:null!=L?L:"",onChange:e=>O(e.target.value),children:D.regions.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))})]}),em.length?null:(0,n.jsx)("div",{className:"du-callout",children:"Necesitas domesticar al menos una criatura para iniciar combates."}),"idle"===W?(0,n.jsx)("div",{className:"du-callout",children:"Selecciona un modo para iniciar la batalla."}):null,en&&el?(0,n.jsxs)("div",{className:"du-battle-stage",children:[(0,n.jsxs)("div",{className:"du-battle-hud enemy",children:[(0,n.jsxs)("div",{className:"du-battle-name",children:[el.name,j(null!==(h=el.sex)&&void 0!==h?h:eo)?(0,n.jsx)("span",{className:"du-sex-chip",children:j(null!==(v=el.sex)&&void 0!==v?v:eo)}):null]}),(0,n.jsx)("div",{className:"du-battle-type",children:null!==(x=el.baseType)&&void 0!==x?x:"Tipo"}),(0,n.jsx)("div",{className:"du-hp-bar",children:(0,n.jsx)("span",{style:{width:"".concat(el.hp/el.maxHp*100,"%")}})}),(0,n.jsxs)("div",{className:"du-hp-meta",children:["HP ",el.hp,"/",el.maxHp]}),(0,n.jsx)("div",{className:"du-battle-portrait",children:(0,n.jsx)("img",{src:null!==(f=ex[0])&&void 0!==f?f:G,alt:el.name,className:"du-card-img",onError:e=>{let a=e.currentTarget;a.src!==G&&G&&(a.src=G)}})})]}),(0,n.jsxs)("div",{className:"du-battle-hud player",children:[(0,n.jsxs)("div",{className:"du-battle-name",children:[en.name,j(en.sex)?(0,n.jsx)("span",{className:"du-sex-chip",children:j(en.sex)}):null]}),(0,n.jsx)("div",{className:"du-battle-type",children:null!==(b=en.baseType)&&void 0!==b?b:"Tipo"}),(0,n.jsx)("div",{className:"du-hp-bar",children:(0,n.jsx)("span",{style:{width:"".concat(en.hp/en.maxHp*100,"%")}})}),(0,n.jsxs)("div",{className:"du-hp-meta",children:["HP ",en.hp,"/",en.maxHp]}),(0,n.jsxs)("div",{className:"du-bond-row",children:[(0,n.jsx)("span",{children:"Bond"}),(0,n.jsx)("div",{className:"du-bond-bar",children:(0,n.jsx)("span",{style:{width:"".concat(en.bondCharge,"%")}})}),(0,n.jsx)("span",{children:en.bondCharge})]}),(0,n.jsx)("div",{className:"du-battle-portrait",children:(0,n.jsx)("img",{src:null!==(k=eg[0])&&void 0!==k?k:G,alt:en.name,className:"du-card-img",onError:e=>{let a=e.currentTarget;a.src!==G&&G&&(a.src=G)}})})]})]}):null,(0,n.jsx)("div",{className:"du-battle-textbox",children:(0,n.jsx)("div",{className:"du-meta",children:X||"Preparando combate..."})}),"action"===W&&en&&el?(0,n.jsxs)("div",{className:"du-battle-menu",children:[(0,n.jsx)(l.z,{onClick:()=>J("move"),className:"du-action-btn",children:"Atacar"}),(0,n.jsx)(l.z,{variant:"ghost",onClick:()=>J("switch"),className:"du-action-btn",children:"Cambiar"}),(0,n.jsx)(l.z,{variant:"ghost",onClick:()=>eC(m.find(e=>"focus"===e.id)),className:"du-action-btn",children:"Bond"}),"wild"===U?(0,n.jsx)(l.z,{variant:"ghost",onClick:()=>{if("wild"===U&&en&&el){if(100*Math.random()<=w(40+(en.spd-el.spd)*5,10,80)){e_("Escapaste del combate."),eh("run"),J("outcome"),K("Escapaste sin perder honor.");return}e_("No pudiste escapar."),eC(m.find(e=>"guard"===e.id))}},className:"du-action-btn",children:"Escapar"}):(0,n.jsx)(l.z,{variant:"ghost",onClick:()=>eC(m.find(e=>"guard"===e.id)),className:"du-action-btn",children:"Defender"})]}):null,"move"===W&&en?(0,n.jsxs)("div",{className:"du-battle-menu du-move-menu",children:[eT.map(e=>(0,n.jsxs)("button",{className:"du-move-btn".concat(e.bondCost&&en.bondCharge<e.bondCost?" disabled":""),onClick:()=>{e.bondCost&&en.bondCharge<e.bondCost||eC(e)},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:e.label}),(0,n.jsx)("span",{className:"du-meta",children:e.description})]}),e.bondCost?(0,n.jsxs)("span",{className:"du-move-cost",children:["Bond ",e.bondCost]}):null]},e.id)),"wild"===U?(0,n.jsx)("button",{className:"du-move-btn",onClick:ek,children:(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Domesticar"}),(0,n.jsx)("span",{className:"du-meta",children:"Intenta capturar si esta debilitado."})]})}):null,(0,n.jsx)(l.z,{variant:"ghost",onClick:()=>J("action"),className:"du-action-btn",children:"Regresar"})]}):null,"switch"===W&&em.length>1?(0,n.jsxs)("div",{className:"du-battle-menu du-switch-menu",children:[em.map((e,a)=>{var t;let r=null!==(t=ea[e.creature_id])&&void 0!==t?t:N(e.creature_id,D,{name:""}).hp;return(0,n.jsx)("button",{className:"du-move-btn".concat(a===Y?" active":"").concat(r<=0?" disabled":""),onClick:()=>ew(a),children:(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:e.nickname||e.creature_id.slice(0,6)}),(0,n.jsxs)("span",{className:"du-meta",children:["HP ",r]})]})},e.creature_id)}),(0,n.jsx)(l.z,{variant:"ghost",onClick:()=>J("action"),className:"du-action-btn",children:"Regresar"})]}):null,"outcome"===W?(0,n.jsxs)("div",{className:"du-callout",children:["victory"===eu&&"Victoria: ganas XP y reputacion.","defeat"===eu&&"Derrota: reagrupa tu equipo.","run"===eu&&"Escapaste del combate.","capture"===eu&&"Criatura domestica a\xf1adida.",(0,n.jsxs)("div",{className:"du-chip-row",style:{marginTop:10},children:[(0,n.jsx)(l.z,{onClick:()=>{E(),ej()},variant:"ghost",children:"Nueva batalla"}),(0,n.jsx)(l.z,{onClick:()=>window.location.assign("/map"),variant:"ghost",children:"Ir al mapa"})]})]}):null]})}),(0,n.jsxs)(i.Z,{title:"Rewards",badge:(0,n.jsxs)(s.A,{children:["Wallet: ",null!==(T=null==R?void 0:R.wallet_balances)&&void 0!==T?T:0," CC"]}),children:[(0,n.jsx)("p",{children:"Cross Coins de profiles.wallet_balances \xb7 Bonds de player_faction_bonds."}),(0,n.jsx)("div",{className:"du-chip-row",children:B.map(e=>(0,n.jsxs)(s.A,{children:[e.faction,": ",e.bond_amount," Bonds"]},e.faction))}),(0,n.jsx)("div",{className:"du-divider"}),Z?(0,n.jsxs)("div",{className:"du-meta",children:["Ultima batalla: ",Z.winner_id," gano \xb7 ",Z.battle_log]}):(0,n.jsx)("div",{className:"du-meta",children:"No battles yet"}),(0,n.jsx)("div",{className:"du-divider"}),(0,n.jsxs)("div",{className:"du-meta",children:["Trainer stats tracked: ",q.length]})]}),(0,n.jsx)(c,{logs:I.slice(0,5)})]})}var T=t(4660);function S(){let e=(0,o.G)(),{tutorial:a,setStarterChoice:t,startTutorial:c,completeTutorial:u,skipTutorial:h,addLog:m,battle:p,reset:v,awardXp:g,recordBattle:x}=(0,d.A)(),[f,b]=(0,r.useState)([]),[j,_]=(0,r.useState)("idle"),N=0===e.playerCreatures.length,y="completed"!==a.status,C=(0,r.useMemo)(()=>{let a=e.creatures.filter(e=>e.is_starter);return[...a.length?a:e.creatures].sort(()=>.5-Math.random()).slice(0,3)},[e.creatures]),w=e=>{t(e),c()};return y?(0,n.jsxs)(i.Z,{title:"Tutorial de batalla",badge:(0,n.jsx)(s.A,{children:"in_progress"===a.status?"En progreso":N?"Elige starter":"Recomendado"}),footer:(0,n.jsxs)("div",{className:"du-chip-row",children:[(0,n.jsx)(l.z,{variant:"ghost",onClick:h,children:"Omitir"}),"in_progress"===a.status?(0,n.jsx)(l.z,{onClick:()=>{var t,n,r,l,i;let s=a.starterChoice||(null===(t=e.playerCreatures[0])||void 0===t?void 0:t.creature_id);if(!s)return;let d=function(e,a){let t=[],n=e.hp,r=a.hp,l=e.spd>=a.spd,i=(e,a)=>Math.max(1,Math.round(e-.4*a));for(;n>0&&r>0&&t.length<12;){if(l){let n=i(e.atk,a.def);r-=n,t.push("".concat(e.name," ataca (").concat(n," dmg). Enemigo HP ").concat(Math.max(r,0),"/").concat(a.hp))}else{let r=i(a.atk,e.def);n-=r,t.push("".concat(a.name," ataca (").concat(r," dmg). Tu HP ").concat(Math.max(n,0),"/").concat(e.hp))}l=!l}return{log:t,winner:n>0?"player":"enemy"}}(function(e,a,t){var n,r,l,i,s,d,o,c;let u=t.playerCreatures.find(a=>a.creature_id===e),h=t.creatures.find(a=>a.id===e),m=u?t.creatureStages.find(e=>e.id===u.current_stage_id):void 0,p=(null==m?void 0:m.stage_stats)||(null==u?void 0:u.stats)||{};return{name:(null==u?void 0:u.nickname)||(null==h?void 0:h.name)||a,hp:null!==(r=null!==(n=p.hp)&&void 0!==n?n:p.health)&&void 0!==r?r:20,atk:null!==(i=null!==(l=p.atk)&&void 0!==l?l:p.attack)&&void 0!==i?i:5,def:null!==(d=null!==(s=p.def)&&void 0!==s?s:p.defense)&&void 0!==d?d:3,spd:null!==(c=null!==(o=p.speed)&&void 0!==o?o:p.spd)&&void 0!==c?c:5}}(s,"Starter",e),{name:"Entrenador de pr\xe1ctica",hp:18,atk:6,def:3,spd:4});b(d.log),d.log.forEach(m),_("player"===d.winner?"player":"enemy"),u(),"player"===d.winner&&(g(s,(null!==(l=null===(n=e.playerCreatures.find(e=>e.creature_id===s))||void 0===n?void 0:n.current_xp)&&void 0!==l?l:0)+10),x({winner_id:null!==(i=null===(r=e.profile)||void 0===r?void 0:r.id)&&void 0!==i?i:"npc",battle_log:d.log.join(" | ")}))},children:"Jugar tutorial"}):N?null:(0,n.jsx)(l.z,{onClick:c,children:"Iniciar tutorial"}),(0,n.jsx)(l.z,{variant:"ghost",onClick:v,children:"Reset batalla"})]}),children:[N&&"in_progress"!==a.status?(0,n.jsx)("div",{className:"du-grid three",children:C.map(e=>(0,n.jsx)(i.Z,{title:(0,T.l)(e.name,e.name_locales),badge:(0,n.jsx)(s.A,{children:e.base_type}),footer:(0,n.jsx)(l.z,{onClick:()=>w(e.id),className:"du-btn-full",children:"Elegir"}),children:(0,n.jsxs)("div",{className:"du-meta",children:["Region: ",e.region]})},e.id))}):(0,n.jsxs)("div",{className:"du-list",children:[(0,n.jsx)("div",{className:"du-meta",children:"1) Ataca y vence al sparring para ganar XP."}),(0,n.jsx)("div",{className:"du-meta",children:"2) Puedes saltar este tutorial en cualquier momento."}),(0,n.jsx)("div",{className:"du-meta",children:"3) Recompensa: XP y desbloquear combates completos."})]}),f.length>0&&(0,n.jsxs)("div",{className:"du-list",style:{marginTop:10},children:[f.map((e,a)=>(0,n.jsx)("div",{className:"du-meta",children:e},a)),"idle"!==j&&(0,n.jsx)(s.A,{children:"player"===j?"Victoria":"Derrota"})]}),p.log.length>0&&(0,n.jsxs)("div",{className:"du-list",style:{marginTop:10},children:[(0,n.jsx)("div",{className:"du-meta",children:"Log de batalla"}),p.log.map((e,a)=>(0,n.jsx)("div",{className:"du-meta",children:e},a))]})]}):null}var M=t(857),E=t(357);function A(){let e=(0,o.G)(),{status:a}=(0,M.a)(),t=E.env.NEXT_PUBLIC_CRFM_URL,r=t?t.replace(/\/$/,""):"";return(0,n.jsxs)("div",{className:"du-stack",children:[(0,n.jsx)(i.Z,{title:"Battle",badge:(0,n.jsx)(s.A,{children:"Turn-based"}),children:(0,n.jsx)("p",{className:"du-meta",children:"Use your domesticated creatures and stage stats for HP/ATK/DEF/speed/faith. Rewards: wallet_balances + faction bonds."})}),"ready"!==a?(0,n.jsxs)(i.Z,{title:"Sesion requerida",badge:(0,n.jsx)(s.A,{children:"CRFM"}),children:[(0,n.jsx)("p",{className:"du-meta",children:"Inicia sesion en CRFM para activar batallas y progreso."}),(0,n.jsx)("a",{className:"du-button",href:"".concat(r,"/?auth=login"),rel:"noreferrer",children:"Ir a CRFM"})]}):null,(0,n.jsx)(k,{}),(0,n.jsx)(i.Z,{title:"Battles count",badge:(0,n.jsx)(s.A,{children:e.battles.length}),children:(0,n.jsx)("p",{className:"du-meta",children:"Latest battles are listed in the log below."})}),(0,n.jsx)(S,{})]})}},6013:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});var n=t(7437);function r(e){let{children:a,title:t,badge:r,footer:l,className:i}=e;return(0,n.jsxs)("div",{className:["du-card",i].filter(Boolean).join(" "),children:[(t||r)&&(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[t?(0,n.jsx)("h3",{style:{margin:0},children:t}):(0,n.jsx)("span",{}),r]}),a,l?(0,n.jsx)("div",{style:{marginTop:10},children:l}):null]})}},4660:function(e,a,t){"use strict";t.d(a,{l:function(){return r}});let n=()=>{let e=window.localStorage.getItem("crfm_language");return"en"===e||"es"===e?e:(window.navigator.language||"").toLowerCase().startsWith("en")?"en":"es"},r=(e,a)=>a&&(a[n()]||a.es||a.en)||e}},function(e){e.O(0,[234,366,971,23,744],function(){return e(e.s=8678)}),_N_E=e.O()}]);