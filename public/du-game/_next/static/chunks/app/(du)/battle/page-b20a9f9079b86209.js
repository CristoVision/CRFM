(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[857],{8678:function(e,a,t){Promise.resolve().then(t.bind(t,6337))},6337:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return A}});var n=t(7437),r=t(2265),l=t(495),i=t(6013),s=t(9135),d=t(931),c=t(371);function o(e){let{logs:a}=e;return(0,n.jsx)(i.Z,{title:"Recent battles",children:(0,n.jsxs)("div",{className:"du-list",children:[a.map((e,a)=>(0,n.jsxs)("div",{className:"du-card",style:{padding:10},children:[(0,n.jsxs)("div",{className:"du-chip-row",children:[(0,n.jsxs)(s.A,{children:["player1_id: ",e.player1_id]}),(0,n.jsxs)(s.A,{children:["player2_id: ",e.player2_id]})]}),(0,n.jsxs)("div",{className:"du-chip-row",children:[(0,n.jsxs)(s.A,{children:["Winner: ",e.winner_id]}),e.started_at?(0,n.jsxs)(s.A,{children:["Start: ",e.started_at]}):null,e.ended_at?(0,n.jsxs)(s.A,{children:["End: ",e.ended_at]}):null]}),(0,n.jsx)("div",{className:"du-meta",children:"string"==typeof e.battle_log?e.battle_log:JSON.stringify(e.battle_log)})]},a)),0===a.length&&(0,n.jsx)("p",{className:"du-meta",children:"No battles yet."})]})})}var u=t(1180);let h={fuego:{strong:["planta","hielo"],weak:["agua","tierra"]},agua:{strong:["fuego","tierra"],weak:["planta","electrico"]},planta:{strong:["agua","tierra"],weak:["fuego","hielo"]},electrico:{strong:["agua","aire"],weak:["tierra"]},tierra:{strong:["electrico","fuego"],weak:["agua","planta"]},aire:{strong:["planta"],weak:["electrico","hielo"]},hielo:{strong:["planta","aire"],weak:["fuego"]},luz:{strong:["sombra"],weak:["sombra"]},sombra:{strong:["luz"],weak:["luz"]}},m=[{id:"quick",label:"Corte Veloz",kind:"attack",power:8,accuracy:98,priority:1,description:"Golpe rapido que asegura la iniciativa."},{id:"heavy",label:"Golpe Titan",kind:"attack",power:12,accuracy:88,priority:0,description:"Ataque fuerte con alto impacto."},{id:"guard",label:"Guardia Santa",kind:"guard",power:0,accuracy:100,priority:0,description:"Reduce el siguiente dano y recupera HP."},{id:"focus",label:"Focus de Fe",kind:"focus",power:0,accuracy:100,priority:0,description:"Carga Bond y aumenta precision."},{id:"bond",label:"Ruptura de Bond",kind:"attack",power:14,accuracy:92,bondCost:40,priority:0,description:"Descarga Bond para un golpe devastador."}],p=(e,a,t)=>Math.max(1,Math.round(e*t/10-.28*a)),v=e=>(e||"").normalize("NFD").replace(/[^\w\s-]/g,"").toLowerCase().trim(),g=(e,a)=>{let t=v(e),n=v(a);if(!t||!n)return 1;let r=h[t];return r?r.strong.includes(n)?1.2:r.weak.includes(n)?.85:1:1},x=e=>!!e&&(e.startsWith("http")||e.startsWith("data:")),f=e=>(e||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9]+/g," ").trim(),j=["CotorraChick.png","CoquiTad.png","JibaroPup.png","JibaroPupS.png"],b=e=>"male"===e?"♂":"female"===e?"♀":"";function N(e,a,t,n,r){let l=e?n.creatures.find(a=>a.id===e):void 0,i=a?n.creatureStages.find(e=>e.id===a):n.creatureStages.find(a=>a.creature_id===e),s=[],d=e=>{e&&(x(e)?s.push(e):r&&s.push("".concat(r,"/storage/v1/object/public/").concat(e.replace(/^\//,""))))};if("male"===t&&d((null==i?void 0:i.image_url_male)||void 0),"female"===t&&d((null==i?void 0:i.image_url_female)||void 0),d(null==i?void 0:i.image_url),d(null==l?void 0:l.image_url),r&&(null==l?void 0:l.name)){let e=f(l.name),a=e.replace(/ /g,""),t=e.toLowerCase().replace(/ /g,"-");j.forEach(e=>d("creatures/".concat(e))),["creatures/".concat(a,".png"),"creatures/".concat(t,".png"),"creatures/".concat(a,".jpg"),"creatures/".concat(t,".jpg"),"creatures/".concat(a,".webp"),"creatures/".concat(t,".webp"),"creatures/".concat(a,"S.png"),"creatures/".concat(a,"S.jpg"),"creatures/".concat(a,"S.webp")].forEach(d)}return s}function _(e,a,t){var n,r,l,i,s,d,c,o,u,h,m,p,v,g,x,f,j,b,N,_;if(!e)return{name:t.name,hp:null!==(n=t.hp)&&void 0!==n?n:20,atk:null!==(r=t.atk)&&void 0!==r?r:6,def:null!==(l=t.def)&&void 0!==l?l:3,spd:null!==(i=t.spd)&&void 0!==i?i:5,bond:null!==(s=t.bond)&&void 0!==s?s:0,baseType:t.baseType};let w=a.playerCreatures.find(a=>a.creature_id===e),C=a.creatures.find(a=>a.id===e),y=w&&w.current_stage_id?a.creatureStages.find(e=>e.id===w.current_stage_id):a.creatureStages.filter(a=>a.creature_id===e).sort((e,a)=>{var t,n;return(null!==(t=e.stage_order)&&void 0!==t?t:0)-(null!==(n=a.stage_order)&&void 0!==n?n:0)})[0],k=(null==y?void 0:y.stage_stats)||(null==w?void 0:w.stats)||{};return{id:e,stageId:null==y?void 0:y.id,name:(null==w?void 0:w.nickname)||(null==C?void 0:C.name)||t.name,hp:null!==(o=null!==(c=null!==(d=k.hp)&&void 0!==d?d:k.health)&&void 0!==c?c:t.hp)&&void 0!==o?o:20,atk:null!==(m=null!==(h=null!==(u=k.atk)&&void 0!==u?u:k.attack)&&void 0!==h?h:t.atk)&&void 0!==m?m:6,def:null!==(g=null!==(v=null!==(p=k.def)&&void 0!==p?p:k.defense)&&void 0!==v?v:t.def)&&void 0!==g?g:3,spd:null!==(j=null!==(f=null!==(x=k.speed)&&void 0!==x?x:k.spd)&&void 0!==f?f:t.spd)&&void 0!==j?j:5,bond:null!==(b=k.faith)&&void 0!==b?b:0,baseType:null==C?void 0:C.base_type,sex:null!==(_=null!==(N=null==w?void 0:w.sex)&&void 0!==N?N:t.sex)&&void 0!==_?_:null}}let w=(e,a)=>{var t,n;return{...e,maxHp:e.hp,hp:null!=a?a:e.hp,bondAffinity:null!==(t=e.bond)&&void 0!==t?t:0,bondCharge:Math.min(100,(null!==(n=e.bond)&&void 0!==n?n:0)*4),guardTurns:0,focusTurns:0}},C=e=>{if(e.hp<=.35*e.maxHp)return m.find(e=>"guard"===e.id);if(e.bondCharge>=40)return m.find(e=>"bond"===e.id);let a=Math.random();return a<.45?m.find(e=>"quick"===e.id):a<.75?m.find(e=>"heavy"===e.id):m.find(e=>"focus"===e.id)},y=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return Math.max(a,Math.min(t,e))};function k(){var e,a,t,h,v,x,f,j,k,T;let{battle:S,startBattle:E,reset:M,addLog:A,awardStageAndXp:D,recordBattle:P}=(0,d.A)(),z=(0,c.G)(),R=(0,u.O)(),{profile:H,bonds:B,battles:q,trainerStats:I}=z,F=q[0],Z="https://npdklestjuejrotjtqwt.supabase.co",G=Z?"".concat(Z,"/storage/v1/object/public/creatures/UnknownCreature.png"):void 0,[L,O]=(0,r.useState)(null===(e=z.regions[0])||void 0===e?void 0:e.id),[U,V]=(0,r.useState)("trainer"),[W,X]=(0,r.useState)("idle"),[J,K]=(0,r.useState)(""),[Q,Y]=(0,r.useState)(1),[$,ee]=(0,r.useState)(0),[ea,et]=(0,r.useState)({}),[en,er]=(0,r.useState)(null),[el,ei]=(0,r.useState)(null),[es,ed]=(0,r.useState)(void 0),[ec,eo]=(0,r.useState)(null),[eu,eh]=(0,r.useState)("idle"),[em,ep]=(0,r.useState)(!1),[ev,eg]=(0,r.useState)(!1),ex=(0,r.useRef)(null),ef=(0,r.useRef)(null),ej=z.playerCreatures.slice(0,6),eb=null===(a=ej[$])||void 0===a?void 0:a.creature_id,eN=(0,r.useMemo)(()=>{var e,a;let t=null!=L?L:null===(e=z.regions[0])||void 0===e?void 0:e.id;if(!t)return;let n=(z.regionCreatures||[]).filter(e=>e.region_id===t);if(!n.length)return;let r=n.reduce((e,a)=>{var t;return e+(null!==(t=a.spawn_rate)&&void 0!==t?t:1)},0);if(r<=0)return n[0].creature_id;let l=Math.random()*r;for(let e of n)if((l-=null!==(a=e.spawn_rate)&&void 0!==a?a:1)<=0)return e.creature_id;return n[n.length-1].creature_id},[L,z.regionCreatures,z.regions]),e_=N(eb,null==en?void 0:en.stageId,null==en?void 0:en.sex,z,Z),ew=N(es,null==el?void 0:el.stageId,null!==(t=null==el?void 0:el.sex)&&void 0!==t?t:ec,z,Z),eC=()=>_(eb,z,{name:"Sin criatura",hp:22,atk:6,def:3,spd:5,bond:0}),ey=(e,a,t)=>_(e,z,{name:"wild"===a?"Criatura salvaje":"Entrenador NPC",hp:20,atk:6,def:3,spd:4,bond:0,sex:null!=t?t:null,baseType:"wild"===a?"Salvaje":"Trainer"});(0,r.useEffect)(()=>{"idle"===S.mode&&(X("idle"),eh("idle"),K(""),er(null),ei(null),et({}),ed(void 0),eo(null))},[S.mode]),(0,r.useEffect)(()=>{en&&(null!==ex.current&&en.hp<ex.current&&(ep(!0),window.setTimeout(()=>ep(!1),280)),ex.current=en.hp)},[null==en?void 0:en.hp]),(0,r.useEffect)(()=>{el&&(null!==ef.current&&el.hp<ef.current&&(eg(!0),window.setTimeout(()=>eg(!1),280)),ef.current=el.hp)},[null==el?void 0:el.hp]);let ek=e=>{var a,t;let n=null!=e?e:U;if(V(n),!ej.length)return;let r="wild"===n?eN:null===(a=z.creatures.find(e=>e.id!==eb))||void 0===a?void 0:a.id;ed(r);let l=z.creatures.find(e=>e.id===r),i=(null==l?void 0:l.sexes)&&l.sexes.length?l.sexes:["male","female"],s=i[Math.floor(Math.random()*i.length)];eo(s);let d=eC(),c=ey(r,n,s),o={};ej.forEach(e=>{o[e.creature_id]=_(e.creature_id,z,{name:""}).hp}),et(o),er(w(d,null!==(t=o[null!=eb?eb:""])&&void 0!==t?t:d.hp)),ei(w(c)),X("action"),eh("idle"),Y(1),K("wild"===n?"\xa1Aparece ".concat(c.name,"!"):"Desafio contra ".concat(c.name)),E(n)},eT=e=>{A(e)},eS=(e,a,t)=>{var n,r;let l=[];if("guard"===t.kind){e.guardTurns=1;let a=Math.min(e.maxHp-e.hp,4);return e.hp+=a,e.bondCharge=y(e.bondCharge+10),l.push("".concat(e.name," se protege y recupera ").concat(a," HP.")),l}if("focus"===t.kind)return e.focusTurns=2,e.bondCharge=y(e.bondCharge+22),l.push("".concat(e.name," concentra su fe. Bond +22.")),l;if(t.bondCost&&e.bondCharge<t.bondCost)return l.push("".concat(e.name," intento ").concat(t.label," pero no tiene Bond.")),l;if(100*Math.random()>(null!==(n=t.accuracy)&&void 0!==n?n:100)+(e.focusTurns>0?6:0))return l.push("".concat(e.name," fallo ").concat(t.label,".")),l;let i=p(e.atk,a.def,null!==(r=t.power)&&void 0!==r?r:10),s=g(e.baseType,a.baseType),d=Math.max(1,Math.round((i+("bond"===t.id?Math.round(.6*e.bondAffinity):0))*(.9+.2*Math.random())*s));return a.guardTurns>0&&(d=Math.max(1,Math.round(.6*d)),a.guardTurns=0,l.push("".concat(a.name," bloqueo parte del impacto."))),a.hp=Math.max(0,a.hp-d),e.bondCharge=y(e.bondCharge+12),t.bondCost&&(e.bondCharge=y(e.bondCharge-t.bondCost)),l.push("".concat(e.name," uso ").concat(t.label," (").concat(d," dmg). ").concat(s>1.05?"\xa1Super eficaz!":s<.95?"No muy eficaz.":"").trim()),l},eE=(e,a)=>{e.focusTurns>0&&(e.focusTurns-=1),a.focusTurns>0&&(a.focusTurns-=1)},eM=e=>{if(!en||!el)return;let a={...en},t={...el},n=C(t),r=[{who:"player",move:e,actor:a,target:t},{who:"enemy",move:n,actor:t,target:a}].sort((e,a)=>{var t,n;let r=null!==(t=e.move.priority)&&void 0!==t?t:0,l=null!==(n=a.move.priority)&&void 0!==n?n:0;return r!==l?l-r:e.actor.spd!==a.actor.spd?a.actor.spd-e.actor.spd:"player"===e.who?-1:1}),l=[];for(let e of r){if(a.hp<=0||t.hp<=0)break;l.push(...eS(e.actor,e.target,e.move))}if(eE(a,t),l.forEach(eT),er(a),ei(t),eb&&et(e=>({...e,[eb]:a.hp})),t.hp<=0){var i;eT("Victoria: enemigo derrotado."),eh("victory"),X("outcome"),K("\xa1Victoria!"),eb&&D({creatureId:eb,xpGain:12}),P({winner_id:null!==(i=null==H?void 0:H.id)&&void 0!==i?i:"npc",battle_log:S.log.join(" | ")});return}if(a.hp<=0){eT("Derrota: tu criatura cayo."),eh("defeat"),X("outcome"),K("Derrota."),P({winner_id:"npc",battle_log:S.log.join(" | ")});return}let s=Q+1;Y(s),X("action"),K("Turno ".concat(s,": \xbfque hara ").concat(a.name,"?"))},eA=e=>{var a,t;if(e===$||!en||!el)return;let n=null===(a=ej[e])||void 0===a?void 0:a.creature_id;if(!n)return;let r=null!==(t=ea[n])&&void 0!==t?t:_(n,z,{name:""}).hp;if(r<=0)return;let l=w(_(n,z,{name:""}),r);ee(e),er(l);let i={...el},s=C(i);eS(i,l,s).forEach(eT),er(l),ei(i),et(e=>({...e,[n]:l.hp})),l.hp<=0?(eh("defeat"),X("outcome"),K("Derrota.")):(X("action"),K("Cambio listo. \xbfQue hara ".concat(l.name,"?")))},eD=async()=>{var e,a,t,n;if("wild"!==U||!R||!(null==H?void 0:H.id)||!(null==el?void 0:el.id)||!el)return;let r=el.hp,l=el.maxHp,i=z.regionCreatures.find(e=>{var a;return e.creature_id===el.id&&e.region_id===(null!=L?L:null===(a=z.regions[0])||void 0===a?void 0:a.id)}),s=25+50*Math.max(0,(l-r)/l)+Math.min(20,2*(null!==(e=null==i?void 0:i.spawn_rate)&&void 0!==e?e:1));if(s>90&&(s=90),!(100*Math.random()<=s)){eT("Domesticar fallo (".concat(Math.round(s),"% chance).")),K("El enemigo se resiste."),eM(m.find(e=>"guard"===e.id));return}let d=z.creatureStages.filter(e=>e.creature_id===el.id).sort((e,a)=>{var t,n;return(null!==(t=e.stage_order)&&void 0!==t?t:0)-(null!==(n=a.stage_order)&&void 0!==n?n:0)})[0];await R.from("player_creatures").insert({user_id:H.id,creature_id:el.id,current_stage_id:null!==(a=null==d?void 0:d.id)&&void 0!==a?a:null,current_xp:0,nickname:el.name,is_domesticated:!0,domesticated_at:new Date().toISOString(),level:null!==(t=null==d?void 0:d.stage_order)&&void 0!==t?t:1,sex:null!==(n=el.sex)&&void 0!==n?n:null}),eT("Domesticaste a ".concat(el.name,".")),eh("capture"),X("outcome"),K("Domesticar exitoso."),P({winner_id:H.id,battle_log:[...S.log,"Domesticar ".concat(el.name)].join(" | ")}),z.reload()},eP=m.filter(e=>"attack"===e.kind||"guard"===e.id),ez="action"===W||"move"===W||"switch"===W,eR="idle"===W?"Preparando combate":"action"===W?"Turno ".concat(Q,": tu decides"):"move"===W?"Elige tu movimiento":"switch"===W?"Cambia de criatura":"Resultado";return(0,n.jsxs)("div",{className:"du-grid two",children:[(0,n.jsx)(i.Z,{title:"Arena",badge:(0,n.jsx)(s.A,{children:"idle"===S.mode?"Idle":"Modo: ".concat(S.mode)}),children:(0,n.jsxs)("div",{className:"du-arena-shell",children:[(0,n.jsxs)("div",{className:"du-mode-tabs",children:[(0,n.jsx)("button",{className:"du-mode-chip".concat("wild"===U?" active":""),onClick:()=>{ek("wild")},children:"Encuentro"}),(0,n.jsx)("button",{className:"du-mode-chip".concat("trainer"===U?" active":""),onClick:()=>{ek("trainer")},children:"Entrenador"}),(0,n.jsx)("button",{className:"du-mode-chip".concat("pvp"===U?" active":""),onClick:()=>{ek("pvp")},children:"PvP"}),"wild"===U&&(0,n.jsx)("select",{className:"du-select",value:null!=L?L:"",onChange:e=>O(e.target.value),children:z.regions.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))})]}),ej.length?null:(0,n.jsx)("div",{className:"du-callout",children:"Necesitas domesticar al menos una criatura para iniciar combates."}),"idle"===W?(0,n.jsx)("div",{className:"du-callout",children:"Selecciona un modo para iniciar la batalla."}):null,en&&el?(0,n.jsxs)("div",{className:"du-battle-stage",children:[(0,n.jsxs)("div",{className:"du-battle-topbar",children:[(0,n.jsx)("div",{className:"du-turn-indicator",children:eR}),(0,n.jsxs)("div",{className:"du-chip-row",children:[(0,n.jsxs)(s.A,{children:["Turno ",Q]}),(0,n.jsx)(s.A,{children:S.mode})]})]}),(0,n.jsxs)("div",{className:"du-battle-hud enemy".concat("idle"===W||"outcome"===W||ez?"":" active").concat(ev?" hit":""),children:[(0,n.jsxs)("div",{className:"du-battle-name",children:[el.name,b(null!==(h=el.sex)&&void 0!==h?h:ec)?(0,n.jsx)("span",{className:"du-sex-chip",children:b(null!==(v=el.sex)&&void 0!==v?v:ec)}):null]}),(0,n.jsx)("div",{className:"du-battle-type",children:null!==(x=el.baseType)&&void 0!==x?x:"Tipo"}),(0,n.jsx)("div",{className:"du-hp-bar",children:(0,n.jsx)("span",{style:{width:"".concat(el.hp/el.maxHp*100,"%")}})}),(0,n.jsxs)("div",{className:"du-hp-meta",children:["HP ",el.hp,"/",el.maxHp]}),(0,n.jsxs)("div",{className:"du-battle-stats-row",children:[(0,n.jsxs)("span",{children:["ATK ",el.atk]}),(0,n.jsxs)("span",{children:["DEF ",el.def]}),(0,n.jsxs)("span",{children:["SPD ",el.spd]})]}),(0,n.jsx)("div",{className:"du-battle-portrait",children:(0,n.jsx)("img",{src:null!==(f=ew[0])&&void 0!==f?f:G,alt:el.name,className:"du-card-img",onError:e=>{let a=e.currentTarget;a.src!==G&&G&&(a.src=G)}})})]}),(0,n.jsxs)("div",{className:"du-battle-hud player".concat(ez?" active":"").concat(em?" hit":""),children:[(0,n.jsxs)("div",{className:"du-battle-name",children:[en.name,b(en.sex)?(0,n.jsx)("span",{className:"du-sex-chip",children:b(en.sex)}):null]}),(0,n.jsx)("div",{className:"du-battle-type",children:null!==(j=en.baseType)&&void 0!==j?j:"Tipo"}),(0,n.jsx)("div",{className:"du-hp-bar",children:(0,n.jsx)("span",{style:{width:"".concat(en.hp/en.maxHp*100,"%")}})}),(0,n.jsxs)("div",{className:"du-hp-meta",children:["HP ",en.hp,"/",en.maxHp]}),(0,n.jsxs)("div",{className:"du-battle-stats-row",children:[(0,n.jsxs)("span",{children:["ATK ",en.atk]}),(0,n.jsxs)("span",{children:["DEF ",en.def]}),(0,n.jsxs)("span",{children:["SPD ",en.spd]})]}),(0,n.jsxs)("div",{className:"du-bond-row",children:[(0,n.jsx)("span",{children:"Bond"}),(0,n.jsx)("div",{className:"du-bond-bar",children:(0,n.jsx)("span",{style:{width:"".concat(en.bondCharge,"%")}})}),(0,n.jsx)("span",{children:en.bondCharge})]}),(0,n.jsx)("div",{className:"du-battle-portrait",children:(0,n.jsx)("img",{src:null!==(k=e_[0])&&void 0!==k?k:G,alt:en.name,className:"du-card-img",onError:e=>{let a=e.currentTarget;a.src!==G&&G&&(a.src=G)}})})]})]}):null,(0,n.jsx)("div",{className:"du-battle-textbox",children:(0,n.jsx)("div",{className:"du-meta",children:J||"Preparando combate..."})}),"action"===W&&en&&el?(0,n.jsxs)("div",{className:"du-battle-menu du-action-grid",children:[(0,n.jsx)(l.z,{onClick:()=>X("move"),className:"du-action-btn primary",children:"⚔️ Atacar"}),(0,n.jsx)(l.z,{variant:"ghost",onClick:()=>X("switch"),className:"du-action-btn",children:"\uD83D\uDD01 Cambiar"}),(0,n.jsx)(l.z,{variant:"ghost",onClick:()=>eM(m.find(e=>"focus"===e.id)),className:"du-action-btn",children:"✨ Bond"}),"wild"===U?(0,n.jsx)(l.z,{variant:"ghost",onClick:()=>{if("wild"===U&&en&&el){if(100*Math.random()<=y(40+(en.spd-el.spd)*5,10,80)){eT("Escapaste del combate."),eh("run"),X("outcome"),K("Escapaste sin perder honor.");return}eT("No pudiste escapar."),eM(m.find(e=>"guard"===e.id))}},className:"du-action-btn",children:"\uD83C\uDFC3 Escapar"}):(0,n.jsx)(l.z,{variant:"ghost",onClick:()=>eM(m.find(e=>"guard"===e.id)),className:"du-action-btn",children:"\uD83D\uDEE1️ Defender"})]}):null,"move"===W&&en?(0,n.jsxs)("div",{className:"du-battle-menu du-move-menu",children:[eP.map(e=>(0,n.jsxs)("button",{className:"du-move-btn".concat(e.bondCost&&en.bondCharge<e.bondCost?" disabled":""),onClick:()=>{e.bondCost&&en.bondCharge<e.bondCost||eM(e)},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:e.label}),(0,n.jsx)("span",{className:"du-meta",children:e.description})]}),e.bondCost?(0,n.jsxs)("span",{className:"du-move-cost",children:["Bond ",e.bondCost]}):null]},e.id)),"wild"===U?(0,n.jsx)("button",{className:"du-move-btn",onClick:eD,children:(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Domesticar"}),(0,n.jsx)("span",{className:"du-meta",children:"Intenta capturar si esta debilitado."})]})}):null,(0,n.jsx)(l.z,{variant:"ghost",onClick:()=>X("action"),className:"du-action-btn",children:"Regresar"})]}):null,"switch"===W&&ej.length>1?(0,n.jsxs)("div",{className:"du-battle-menu du-switch-menu",children:[ej.map((e,a)=>{var t;let r=null!==(t=ea[e.creature_id])&&void 0!==t?t:_(e.creature_id,z,{name:""}).hp;return(0,n.jsx)("button",{className:"du-move-btn".concat(a===$?" active":"").concat(r<=0?" disabled":""),onClick:()=>eA(a),children:(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:e.nickname||e.creature_id.slice(0,6)}),(0,n.jsxs)("span",{className:"du-meta",children:["HP ",r]})]})},e.creature_id)}),(0,n.jsx)(l.z,{variant:"ghost",onClick:()=>X("action"),className:"du-action-btn",children:"Regresar"})]}):null,"outcome"===W?(0,n.jsxs)("div",{className:"du-callout",children:["victory"===eu&&"Victoria: ganas XP y reputacion.","defeat"===eu&&"Derrota: reagrupa tu equipo.","run"===eu&&"Escapaste del combate.","capture"===eu&&"Criatura domestica a\xf1adida.",(0,n.jsxs)("div",{className:"du-chip-row",style:{marginTop:10},children:[(0,n.jsx)(l.z,{onClick:()=>{M(),ek()},variant:"ghost",children:"Nueva batalla"}),(0,n.jsx)(l.z,{onClick:()=>window.location.assign("/map"),variant:"ghost",children:"Ir al mapa"})]})]}):null]})}),(0,n.jsxs)(i.Z,{title:"Rewards",badge:(0,n.jsxs)(s.A,{children:["Wallet: ",null!==(T=null==H?void 0:H.wallet_balances)&&void 0!==T?T:0," CC"]}),children:[(0,n.jsx)("p",{children:"Cross Coins de profiles.wallet_balances \xb7 Bonds de player_faction_bonds."}),(0,n.jsx)("div",{className:"du-chip-row",children:B.map(e=>(0,n.jsxs)(s.A,{children:[e.faction,": ",e.bond_amount," Bonds"]},e.faction))}),(0,n.jsx)("div",{className:"du-divider"}),F?(0,n.jsxs)("div",{className:"du-meta",children:["Ultima batalla: ",F.winner_id," gano \xb7 ",F.battle_log]}):(0,n.jsx)("div",{className:"du-meta",children:"No battles yet"}),(0,n.jsx)("div",{className:"du-divider"}),(0,n.jsxs)("div",{className:"du-meta",children:["Trainer stats tracked: ",I.length]})]}),(0,n.jsx)(o,{logs:q.slice(0,5)})]})}var T=t(4660);function S(){let e=(0,c.G)(),{tutorial:a,setStarterChoice:t,startTutorial:o,completeTutorial:u,skipTutorial:h,restartTutorial:m,addLog:p,battle:v,reset:g,awardXp:x,recordBattle:f}=(0,d.A)(),[j,b]=(0,r.useState)([]),[N,_]=(0,r.useState)("idle"),[w,C]=(0,r.useState)(0),y=0===e.playerCreatures.length,k=!!a.starterChoice,S="completed"!==a.status,E=(0,r.useMemo)(()=>{let a=e.creatures.filter(e=>e.is_starter);return[...a.length?a:e.creatures].sort(()=>.5-Math.random()).slice(0,3)},[e.creatures]);(0,r.useEffect)(()=>{"completed"===a.status?C(3):"in_progress"===a.status?C(y&&!k?1:2):C(0)},[a.status,y,k]);let M=e=>{t(e),o(),C(2)},A=()=>{var t,n,r,l,i;let s=a.starterChoice||(null===(t=e.playerCreatures[0])||void 0===t?void 0:t.creature_id);if(!s)return;let d=function(e,a){let t=[],n=e.hp,r=a.hp,l=e.spd>=a.spd,i=(e,a)=>Math.max(1,Math.round(e-.4*a));for(;n>0&&r>0&&t.length<12;){if(l){let n=i(e.atk,a.def);r-=n,t.push("".concat(e.name," ataca (").concat(n," dmg). Enemigo HP ").concat(Math.max(r,0),"/").concat(a.hp))}else{let r=i(a.atk,e.def);n-=r,t.push("".concat(a.name," ataca (").concat(r," dmg). Tu HP ").concat(Math.max(n,0),"/").concat(e.hp))}l=!l}return{log:t,winner:n>0?"player":"enemy"}}(function(e,a,t){var n,r,l,i,s,d,c,o;let u=t.playerCreatures.find(a=>a.creature_id===e),h=t.creatures.find(a=>a.id===e),m=u?t.creatureStages.find(e=>e.id===u.current_stage_id):void 0,p=(null==m?void 0:m.stage_stats)||(null==u?void 0:u.stats)||{};return{name:(null==u?void 0:u.nickname)||(null==h?void 0:h.name)||a,hp:null!==(r=null!==(n=p.hp)&&void 0!==n?n:p.health)&&void 0!==r?r:20,atk:null!==(i=null!==(l=p.atk)&&void 0!==l?l:p.attack)&&void 0!==i?i:5,def:null!==(d=null!==(s=p.def)&&void 0!==s?s:p.defense)&&void 0!==d?d:3,spd:null!==(o=null!==(c=p.speed)&&void 0!==c?c:p.spd)&&void 0!==o?o:5}}(s,"Starter",e),{name:"Entrenador de pr\xe1ctica",hp:18,atk:6,def:3,spd:4});b(d.log),d.log.forEach(p),_("player"===d.winner?"player":"enemy"),u(),"player"===d.winner&&(x(s,(null!==(l=null===(n=e.playerCreatures.find(e=>e.creature_id===s))||void 0===n?void 0:n.current_xp)&&void 0!==l?l:0)+10),f({winner_id:null!==(i=null===(r=e.profile)||void 0===r?void 0:r.id)&&void 0!==i?i:"npc",battle_log:d.log.join(" | ")}))},D=()=>{b([]),_("idle")};return S?(0,n.jsxs)(i.Z,{title:"Tutorial de batalla",badge:(0,n.jsx)(s.A,{children:"in_progress"===a.status?"En progreso":y?"Elige starter":"Recomendado"}),footer:(0,n.jsxs)("div",{className:"du-chip-row",children:[w>0&&(0,n.jsx)(l.z,{variant:"ghost",onClick:()=>C(e=>Math.max(0,e-1)),children:"Atras"}),"completed"!==a.status&&(0,n.jsx)(l.z,{variant:"ghost",onClick:()=>{h(),D()},children:"Omitir"}),"completed"!==a.status?(0,n.jsx)(l.z,{onClick:()=>{if(0===w){o(),C(y&&!k?1:2);return}2===w&&(A(),C(3))},children:2===w?"Jugar tutorial":"Continuar"}):null,(0,n.jsx)(l.z,{variant:"ghost",onClick:()=>{m(),D()},children:"Reiniciar tutorial"}),(0,n.jsx)(l.z,{variant:"ghost",onClick:g,children:"Reset batalla"})]}),children:[(0,n.jsxs)("div",{className:"du-chip-row",children:[(0,n.jsxs)(s.A,{children:["Paso ",Math.min(w+1,4)," de 4"]}),(0,n.jsx)(s.A,{children:"completed"===a.status?"Completado":"Activo"})]}),0===w?(0,n.jsxs)("div",{className:"du-list",children:[(0,n.jsx)("div",{className:"du-meta",children:"1) Elige un starter para comenzar tu viaje."}),(0,n.jsx)("div",{className:"du-meta",children:"2) Completa un combate rapido para ganar XP inicial."}),(0,n.jsx)("div",{className:"du-meta",children:"3) Puedes omitir o reiniciar en cualquier momento."})]}):null,1===w&&y&&!k?(0,n.jsx)("div",{className:"du-grid three",children:E.map(e=>(0,n.jsxs)(i.Z,{title:(0,T.l)(e.name,e.name_locales),badge:(0,n.jsx)(s.A,{children:e.base_type}),footer:(0,n.jsx)(l.z,{onClick:()=>M(e.id),className:"du-btn-full",children:"Elegir"}),children:[(0,n.jsx)("div",{className:"du-starter-preview",children:(0,n.jsx)("span",{children:"\uD83D\uDC3E"})}),(0,n.jsxs)("div",{className:"du-meta",children:["Region: ",e.region]})]},e.id))}):null,2===w&&(!y||k)?(0,n.jsxs)("div",{className:"du-list",children:[(0,n.jsx)("div",{className:"du-meta",children:"1) Ataca y vence al sparring para ganar XP."}),(0,n.jsx)("div",{className:"du-meta",children:"2) Puedes saltar este tutorial en cualquier momento."}),(0,n.jsx)("div",{className:"du-meta",children:"3) Recompensa: XP y desbloquear combates completos."})]}):null,3===w?(0,n.jsx)("div",{className:"du-list",children:(0,n.jsx)("div",{className:"du-meta",children:"Tutorial completado. Ya puedes combatir libremente."})}):null,j.length>0&&(0,n.jsxs)("div",{className:"du-list",style:{marginTop:10},children:[j.map((e,a)=>(0,n.jsx)("div",{className:"du-meta",children:e},a)),"idle"!==N&&(0,n.jsx)(s.A,{children:"player"===N?"Victoria":"Derrota"})]}),v.log.length>0&&(0,n.jsxs)("div",{className:"du-list",style:{marginTop:10},children:[(0,n.jsx)("div",{className:"du-meta",children:"Log de batalla"}),v.log.map((e,a)=>(0,n.jsx)("div",{className:"du-meta",children:e},a))]})]}):null}var E=t(857),M=t(357);function A(){let e=(0,c.G)(),{status:a}=(0,E.a)(),t=M.env.NEXT_PUBLIC_CRFM_URL,r=t?t.replace(/\/$/,""):"";return(0,n.jsxs)("div",{className:"du-stack",children:[(0,n.jsx)(i.Z,{title:"Battle",badge:(0,n.jsx)(s.A,{children:"Turn-based"}),children:(0,n.jsx)("p",{className:"du-meta",children:"Use your domesticated creatures and stage stats for HP/ATK/DEF/speed/faith. Rewards: wallet_balances + faction bonds."})}),"ready"!==a?(0,n.jsxs)(i.Z,{title:"Sesion requerida",badge:(0,n.jsx)(s.A,{children:"CRFM"}),children:[(0,n.jsx)("p",{className:"du-meta",children:"Inicia sesion en CRFM para activar batallas y progreso."}),(0,n.jsx)("a",{className:"du-button",href:"".concat(r,"/?auth=login"),rel:"noreferrer",children:"Ir a CRFM"})]}):null,(0,n.jsx)(k,{}),(0,n.jsx)(i.Z,{title:"Battles count",badge:(0,n.jsx)(s.A,{children:e.battles.length}),children:(0,n.jsx)("p",{className:"du-meta",children:"Latest battles are listed in the log below."})}),(0,n.jsx)(S,{})]})}},6013:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});var n=t(7437);function r(e){let{children:a,title:t,badge:r,footer:l,className:i}=e;return(0,n.jsxs)("div",{className:["du-card",i].filter(Boolean).join(" "),children:[(t||r)&&(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[t?(0,n.jsx)("h3",{style:{margin:0},children:t}):(0,n.jsx)("span",{}),r]}),a,l?(0,n.jsx)("div",{style:{marginTop:10},children:l}):null]})}},4660:function(e,a,t){"use strict";t.d(a,{l:function(){return r}});let n=()=>{let e=window.localStorage.getItem("crfm_language");return"en"===e||"es"===e?e:(window.navigator.language||"").toLowerCase().startsWith("en")?"en":"es"},r=(e,a)=>a&&(a[n()]||a.es||a.en)||e}},function(e){e.O(0,[234,366,971,23,744],function(){return e(e.s=8678)}),_N_E=e.O()}]);