(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[830],{4509:function(e,t,a){Promise.resolve().then(a.bind(a,7477))},7477:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return p}});var s=a(7437),r=a(7138),i=a(2265),n=a(371),l=a(857),d=a(6013),u=a(9135),o=a(495),c=a(357);function m(e){let{label:t,value:a}=e;return(0,s.jsxs)("div",{className:"du-hero-stat",children:[(0,s.jsx)("div",{className:"du-hero-stat-value",children:a}),(0,s.jsx)("div",{className:"du-hero-stat-label",children:t})]})}function _(e){let{href:t,icon:a,label:i}=e;return(0,s.jsxs)(r.default,{href:t,className:"du-pill-button",children:[(0,s.jsx)("span",{className:"du-pill-icon",children:a}),(0,s.jsx)("span",{className:"du-pill-label",children:i})]})}function h(e){let{name:t,creatures:a,municipalities:i,island:n}=e;return(0,s.jsxs)(d.Z,{children:[(0,s.jsxs)("div",{className:"du-region-card",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"du-region-name",children:t}),(0,s.jsxs)("div",{className:"du-meta",children:[a," criaturas \xb7 ",i.length," municipios"]}),(0,s.jsx)("div",{className:"du-meta",children:i.slice(0,3).join(" \xb7 ")})]}),(0,s.jsx)(u.A,{children:null!=n?n:"Puerto Rico"})]}),(0,s.jsx)(r.default,{href:"/map",className:"du-link",children:"Ver en mapa"})]})}function p(){var e,t,a;let p=(0,n.G)(),f=(0,l.a)(),g=p.profile,v=c.env.NEXT_PUBLIC_CRFM_URL,x=v?v.replace(/\/$/,""):"",j=(0,i.useMemo)(()=>0===p.creatures.length?0:Math.round(p.playerCreatures.length/p.creatures.length*100),[p.creatures.length,p.playerCreatures.length]),y=(0,i.useMemo)(()=>{let e=new Map;for(let a of p.regionCreatures){var t;e.set(a.region_id,(null!==(t=e.get(a.region_id))&&void 0!==t?t:0)+1)}return e},[p.regionCreatures]),b=p.regions.slice(0,2),N=p.missions.filter(e=>!p.missionProgress.some(t=>t.mission_id===e.id&&t.is_completed)).length,[S,C]=(0,i.useState)(!1);return((0,i.useEffect)(()=>{var e,t,a;"completed"!==((null===(t=p.playerStats.find(e=>"tutorial"===e.stat_key))||void 0===t?void 0:null===(e=t.stat_value)||void 0===e?void 0:e.status)||(null===(a=p.profile)||void 0===a?void 0:a.tutorial_status))&&C(!0)},[p.playerStats,null===(e=p.profile)||void 0===e?void 0:e.tutorial_status]),"ready"!==f.status)?(0,s.jsx)("div",{className:"du-stack",children:(0,s.jsxs)(d.Z,{children:[(0,s.jsx)("div",{className:"du-chip-row",style:{marginBottom:8},children:(0,s.jsx)(u.A,{children:"Sesi\xf3n no activa"})}),(0,s.jsx)("p",{className:"du-meta",children:"Inicia sesi\xf3n para cargar tus datos."}),(0,s.jsxs)("div",{className:"du-chip-row",style:{marginTop:8},children:[(0,s.jsx)("a",{className:"du-button",href:"".concat(x,"/?auth=login"),rel:"noreferrer",children:"Iniciar sesi\xf3n"}),(0,s.jsx)("a",{className:"du-button ghost",href:"".concat(x,"/?auth=signup"),rel:"noreferrer",children:"Crear cuenta"})]})]})}):(0,s.jsxs)("div",{className:"du-stack",children:[(0,s.jsxs)(d.Z,{className:"du-home-hero",children:[(0,s.jsxs)("div",{className:"du-home-header",children:[(0,s.jsx)("div",{className:"du-hero-avatar",children:(null==g?void 0:g.avatar_url)?(0,s.jsx)("img",{src:g.avatar_url,alt:"avatar"}):(0,s.jsx)("span",{children:"\uD83E\uDD9C"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"du-home-name",children:(null==g?void 0:g.display_name)||(null==g?void 0:g.username)||"Jugador"}),(0,s.jsxs)("div",{className:"du-home-sub",children:["Player \xb7 ",null!==(t=null==g?void 0:g.country)&&void 0!==t?t:"Puerto Rico"]})]}),(0,s.jsxs)(u.A,{children:[null!==(a=null==g?void 0:g.wallet_balances)&&void 0!==a?a:0," CC"]})]}),(0,s.jsxs)("div",{className:"du-pill-grid",children:[(0,s.jsx)(_,{href:"/battle",icon:"\uD83D\uDE80",label:"Ir a batalla"}),(0,s.jsx)(_,{href:"/map",icon:"\uD83D\uDDFA️",label:"Explorar mapa"}),(0,s.jsx)(_,{href:"/creatures",icon:"\uD83D\uDC3E",label:"Criaturas"}),(0,s.jsx)(_,{href:"/missions",icon:"⭐",label:"Misiones abiertas: ".concat(N)}),(0,s.jsx)(_,{href:"/achievements",icon:"\uD83D\uDCE6",label:"Logros"})]}),(0,s.jsxs)("div",{className:"du-hero-stats",children:[(0,s.jsx)(m,{label:"Colecci\xf3n",value:"".concat(j,"%")}),(0,s.jsx)(m,{label:"Domesticadas",value:p.playerCreatures.length}),(0,s.jsx)(m,{label:"Batallas",value:p.battles.length}),(0,s.jsx)(m,{label:"Bonds",value:p.bonds.length})]})]}),(0,s.jsx)(d.Z,{title:"Regiones destacadas",badge:(0,s.jsxs)(u.A,{children:[p.regions.length," regiones"]}),children:(0,s.jsxs)("div",{className:"du-grid two",children:[b.map(e=>{var t,a;return(0,s.jsx)(h,{name:e.name,creatures:null!==(t=y.get(e.id))&&void 0!==t?t:0,municipalities:null!==(a=e.municipalities)&&void 0!==a?a:[],island:e.island},e.id)}),0===b.length&&(0,s.jsx)("div",{className:"du-meta",children:"No hay regiones cargadas."})]})}),(0,s.jsx)(d.Z,{title:"Acciones r\xe1pidas",children:(0,s.jsxs)("div",{className:"du-pill-grid",children:[(0,s.jsx)(_,{href:"/profile",icon:"\uD83D\uDC64",label:"Perfil"}),(0,s.jsx)(_,{href:"/battle",icon:"⚔️",label:"Combatir"}),(0,s.jsx)(_,{href:"/map",icon:"\uD83C\uDF0D",label:"Mapa"})]})}),S&&(0,s.jsx)("div",{className:"du-modal",children:(0,s.jsxs)("div",{className:"du-modal-card du-popup",children:[(0,s.jsxs)("div",{className:"du-popup-header",children:[(0,s.jsx)("div",{className:"du-popup-title",children:"Bienvenido"}),(0,s.jsx)("button",{className:"du-back-btn",onClick:()=>C(!1),children:"\xd7"})]}),(0,s.jsx)("div",{className:"du-popup-body",children:(0,s.jsx)("p",{className:"du-meta",children:"\xbfQuieres iniciar el tutorial de navegaci\xf3n y combate?"})}),(0,s.jsxs)("div",{className:"du-popup-actions",children:[(0,s.jsx)(o.z,{variant:"ghost",onClick:()=>C(!1),children:"Omitir"}),(0,s.jsx)(r.default,{href:"/battle",className:"du-button du-btn-full",children:"Ir al tutorial"})]})]})})]})}},495:function(e,t,a){"use strict";a.d(t,{z:function(){return n}});var s=a(7437),r=a(2265);let i=e=>"ghost"===e?"du-button ghost":"quick"===e?"du-button du-quick":"du-button",n=(0,r.forwardRef)((e,t)=>{let{variant:a="solid",full:r,className:n,...l}=e;return(0,s.jsx)("button",{ref:t,className:"".concat(i(a)).concat(r?" du-btn-full":""," ").concat(null!=n?n:""),...l})});n.displayName="Button"},6013:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var s=a(7437);function r(e){let{children:t,title:a,badge:r,footer:i,className:n}=e;return(0,s.jsxs)("div",{className:["du-card",n].filter(Boolean).join(" "),children:[(a||r)&&(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[a?(0,s.jsx)("h3",{style:{margin:0},children:a}):(0,s.jsx)("span",{}),r]}),t,i?(0,s.jsx)("div",{style:{marginTop:10},children:i}):null]})}},9135:function(e,t,a){"use strict";a.d(t,{A:function(){return r}});var s=a(7437);function r(e){let{children:t,className:a,style:r,variant:i}=e;return(0,s.jsx)("span",{className:["du-tag","ghost"===i?"du-tag--ghost":null,a].filter(Boolean).join(" "),style:r,children:t})}},857:function(e,t,a){"use strict";a.d(t,{H:function(){return l},a:function(){return d}});var s=a(7437),r=a(2265),i=a(1180);let n=(0,r.createContext)({userId:null,status:"loading",signOut:async()=>{}});function l(e){let{children:t}=e,a=(0,i.O)(),[l,d]=(0,r.useState)(null),[u,o]=(0,r.useState)(a?"loading":"signed_out"),[c,m]=(0,r.useState)(void 0);(0,r.useEffect)(()=>{if(!a){o("signed_out");return}let e=!1;(async()=>{var t;let{data:s,error:r}=await a.auth.getSession();if(!e){if(r){try{await a.auth.signOut()}catch(e){}o("signed_out"),m(r.message),d(null)}else(null===(t=s.session)||void 0===t?void 0:t.user)?(d(s.session.user.id),o("ready")):o("signed_out")}})();let{data:t}=a.auth.onAuthStateChange((e,t)=>{(null==t?void 0:t.user)?(d(t.user.id),o("ready")):(d(null),o("signed_out"))});return()=>{e=!0,null==t||t.subscription.unsubscribe()}},[a]);let _=async()=>{a&&(await a.auth.signOut(),d(null),o("signed_out"))};return(0,s.jsx)(n.Provider,{value:{userId:l,status:u,error:c,signOut:_},children:t})}function d(){return(0,r.useContext)(n)}},371:function(e,t,a){"use strict";a.d(t,{G:function(){return u},U:function(){return d}});var s=a(7437),r=a(2265),i=a(1180),n=a(857);let l=(0,r.createContext)({regions:[],creatures:[],creatureStages:[],playerCreatures:[],regionCreatures:[],cityCreatures:[],missions:[],missionProgress:[],achievements:[],userAchievements:[],bonds:[],battles:[],profile:null,trainerStats:[],playerStats:[],xpThresholds:[],factions:[],cities:[],status:"idle",isLive:!1,reload:async()=>{}});function d(e){let{children:t}=e,a=(0,i.O)(),{userId:d,status:u}=(0,n.a)(),[o,c]=(0,r.useState)("idle"),[m,_]=(0,r.useState)(void 0),[h,p]=(0,r.useState)([]),[f,g]=(0,r.useState)([]),[v,x]=(0,r.useState)([]),[j,y]=(0,r.useState)([]),[b,N]=(0,r.useState)([]),[S,C]=(0,r.useState)([]),[D,w]=(0,r.useState)([]),[k,q]=(0,r.useState)([]),[E,P]=(0,r.useState)([]),[O,A]=(0,r.useState)([]),[B,I]=(0,r.useState)([]),[M,T]=(0,r.useState)([]),[R,Z]=(0,r.useState)([]),[F,L]=(0,r.useState)(null),[U,z]=(0,r.useState)(!1),[G,J]=(0,r.useState)([]),[X,H]=(0,r.useState)([]),[Q,V]=(0,r.useState)([]),[$,K]=(0,r.useState)([]),W=async()=>{if(!a||!d){c("idle"),z(!1);return}c("loading"),_(void 0);let e=[],[t,s,r,i,n,l,u,o,m,h,f,v,j,b,S,D,k,E]=await Promise.all([a.from("profiles").select("*").eq("id",d).maybeSingle(),a.from("creatures").select("id, name, name_locales, base_type, region, image_url, is_starter, rarity, sexes"),a.from("creature_stages").select("id, creature_id, stage_name, stage_order, stage_stats, image_url, image_url_male, image_url_female, variant_type, xp_required"),a.from("player_creatures").select("user_id, creature_id, current_stage_id, nickname, variant_type, date_caught, custom_stats, current_xp, level, in_party, party_slot, is_domesticated, stats, sex").eq("user_id",d),a.from("regions").select("id, name, color, island, municipalities, map_polygon"),a.from("region_creatures").select("region_id, creature_id, spawn_rate"),a.from("cities").select("id, name, region_id"),a.from("city_creatures").select("city_id, creature_id, spawn_rate"),a.from("story_missions").select("id, title, description, region_id, order_in_story, unlock_requirements, reward_cc, reward_item, mission_difficulty, is_battle, trainer_id"),a.from("player_mission_progress").select("user_id, mission_id, is_completed, completed_at, completion_date, rewards").eq("user_id",d),a.from("achievements").select("id, name, description, icon_url, criteria_json, reward_cc, reward_item"),a.from("user_achievements").select("id, user_id, achievement_id, achievement_name, description, date_earned, unlocked_at, notified_followers, track_id").eq("user_id",d),a.from("player_faction_bonds").select("user_id, faction, bond_amount").eq("user_id",d),a.from("battles").select("player1_id, player2_id, winner_id, battle_log, started_at, ended_at").or("player1_id.eq.".concat(d,",player2_id.eq.").concat(d)),a.from("player_trainer_stats").select("user_id, trainer_id, wins, losses, familiarity, last_battle_at").eq("user_id",d),a.from("player_stats").select("user_id, stat_key, stat_value").eq("user_id",d),a.from("creature_stage_xp_thresholds").select("id, creature_id, stage_id, xp_required, created_at, updated_at"),a.from("factions").select("id, name, description, color_hex, icon_url, slug, motto, alignment, lore_json")]),O=(t,a)=>{if(!a)return;let s="string"==typeof(null==a?void 0:a.message)?a.message:String(a);e.push("".concat(t,": ").concat(s))};O("profiles",t.error),O("creatures",s.error),O("creature_stages",r.error),O("player_creatures",i.error),O("regions",n.error),O("region_creatures",l.error),O("cities",u.error),O("city_creatures",o.error),O("story_missions",m.error),O("player_mission_progress",h.error),O("achievements",f.error),O("user_achievements",v.error),O("player_faction_bonds",j.error),O("battles",b.error),O("player_trainer_stats",S.error),O("player_stats",D.error),O("creature_stage_xp_thresholds",k.error),O("factions",E.error),t.data&&L(t.data),s.data&&x(s.data),r.data&&y(r.data.map(e=>{var t;return{...e,stage_stats:"string"==typeof e.stage_stats?JSON.parse(e.stage_stats):null!==(t=e.stage_stats)&&void 0!==t?t:{hp:0,atk:0,def:0,speed:0,faith:0}}})),i.data&&N(i.data),n.data&&p(n.data),l.data&&C(l.data),u.data&&g(u.data),o.data&&w(o.data),m.data&&q(m.data),h.data&&P(h.data),f.data&&A(f.data),v.data&&I(v.data),j.data&&T(j.data),b.data&&Z(b.data),S.data&&J(S.data),D.data&&H(D.data),k.data&&V(k.data),E.data&&K(E.data),z(!0),e.length?(c("error"),_(e.join(" | "))):c("ready")};(0,r.useEffect)(()=>{"ready"===u&&W()},[u,d]);let Y=(0,r.useMemo)(()=>({regions:h,creatures:v,creatureStages:j,playerCreatures:b,regionCreatures:S,cityCreatures:D,missions:k,missionProgress:E,achievements:O,userAchievements:B,bonds:M,battles:R,profile:F,trainerStats:G,playerStats:X,xpThresholds:Q,factions:$,cities:f,status:o,error:m,isLive:U,reload:W}),[h,v,j,b,S,k,E,O,B,M,R,F,G,X,Q,$,o,m,U]);return(0,s.jsx)(l.Provider,{value:Y,children:t})}function u(){return(0,r.useContext)(l)}},1180:function(e,t,a){"use strict";a.d(t,{O:function(){return i}});var s=a(3234);let r=null;function i(){if(r)return r;let e="https://npdklestjuejrotjtqwt.supabase.co",t="sb_publishable_9xEllkhUFl85xTTXtDDT5g_ei508t0r";return e&&t?r=(0,s.eI)(e,t,{auth:{persistSession:!0,autoRefreshToken:!0}}):null}}},function(e){e.O(0,[234,138,971,23,744],function(){return e(e.s=4509)}),_N_E=e.O()}]);