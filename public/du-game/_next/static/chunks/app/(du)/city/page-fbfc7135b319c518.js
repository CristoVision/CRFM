(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[84],{9617:function(e,t,r){Promise.resolve().then(r.bind(r,5654))},5654:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return _}});var a=r(7437),s=r(7138),i=r(2265),n=r(6463),d=r(371),l=r(6013),o=r(4693),u=r(9135);function c(){var e;let t=(0,d.G)(),r=decodeURIComponent((0,n.useSearchParams)().get("name")||""),c=(0,i.useMemo)(()=>t.regions.find(e=>{var t;return null===(t=e.municipalities)||void 0===t?void 0:t.some(e=>e.toLowerCase()===r.toLowerCase())}),[t.regions,r]);if(!c)return(0,a.jsx)("div",{className:"du-stack",children:(0,a.jsxs)(l.Z,{title:"Ciudad no encontrada",children:[(0,a.jsx)("p",{className:"du-meta",children:"Selecciona una ciudad desde el mapa para ver detalles."}),(0,a.jsx)("div",{className:"du-chip-row",style:{marginTop:8},children:(0,a.jsx)(s.default,{href:"/map",className:"du-link",children:"Volver al mapa"})})]})});let _=t.missions.filter(e=>e.region_id===c.id),m=t.regionCreatures.filter(e=>e.region_id===c.id);return(0,a.jsxs)("div",{className:"du-stack",children:[(0,a.jsx)(l.Z,{title:r,badge:(0,a.jsx)(o.C,{children:c.name}),footer:(0,a.jsxs)("div",{className:"du-chip-row",children:[(0,a.jsx)(s.default,{href:"/region?id=".concat(encodeURIComponent(c.id)),className:"du-link",children:"Ver region"}),(0,a.jsx)(s.default,{href:"/map",className:"du-link",children:"Mapa"})]}),children:(0,a.jsxs)("div",{className:"du-chip-row",children:[(0,a.jsxs)(u.A,{children:["Isla: ",null!==(e=c.island)&&void 0!==e?e:"PR"]}),(0,a.jsx)(u.A,{children:"Color region"}),(0,a.jsxs)(u.A,{children:[m.length," criaturas en la region"]}),(0,a.jsxs)(u.A,{children:[_.length," misiones"]})]})}),(0,a.jsx)(l.Z,{title:"Criaturas de la region",badge:(0,a.jsx)(o.C,{children:m.length}),children:(0,a.jsxs)("div",{className:"du-chip-row",children:[m.map(e=>{var r;let s=t.creatures.find(t=>t.id===e.creature_id);return(0,a.jsx)(u.A,{children:null!==(r=null==s?void 0:s.name)&&void 0!==r?r:e.creature_id},e.creature_id)}),0===m.length&&(0,a.jsx)("div",{className:"du-meta",children:"Sin criaturas asignadas."})]})}),(0,a.jsx)(l.Z,{title:"Misiones asociadas",badge:(0,a.jsx)(o.C,{children:_.length}),children:(0,a.jsxs)("div",{className:"du-list",children:[_.map(e=>{var t,r;return(0,a.jsxs)(l.Z,{title:e.title,badge:(0,a.jsxs)(o.C,{children:["Orden #",null!==(t=e.order_in_story)&&void 0!==t?t:"â€”"]}),children:[(0,a.jsx)("p",{className:"du-meta",children:e.description}),(0,a.jsxs)("div",{className:"du-chip-row",children:[(0,a.jsxs)(u.A,{children:["Reward: ",null!==(r=e.reward_cc)&&void 0!==r?r:0," CC"]}),e.is_battle?(0,a.jsx)(u.A,{children:"Batalla"}):(0,a.jsx)(u.A,{children:"Historia"})]})]},e.id)}),0===_.length&&(0,a.jsx)("div",{className:"du-meta",children:"No hay misiones listadas."})]})})]})}function _(){return(0,a.jsx)(i.Suspense,{fallback:(0,a.jsx)("div",{className:"du-stack",children:(0,a.jsx)(l.Z,{title:"Cargando ciudad...",children:(0,a.jsx)("p",{className:"du-meta",children:"Preparando informacion de la ciudad."})})}),children:(0,a.jsx)(c,{})})}},4693:function(e,t,r){"use strict";r.d(t,{C:function(){return s}});var a=r(7437);function s(e){let{children:t}=e;return(0,a.jsx)("span",{className:"du-badge",children:t})}},6013:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var a=r(7437);function s(e){let{children:t,title:r,badge:s,footer:i,className:n}=e;return(0,a.jsxs)("div",{className:["du-card",n].filter(Boolean).join(" "),children:[(r||s)&&(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[r?(0,a.jsx)("h3",{style:{margin:0},children:r}):(0,a.jsx)("span",{}),s]}),t,i?(0,a.jsx)("div",{style:{marginTop:10},children:i}):null]})}},9135:function(e,t,r){"use strict";r.d(t,{A:function(){return s}});var a=r(7437);function s(e){let{children:t,className:r,style:s,variant:i}=e;return(0,a.jsx)("span",{className:["du-tag","ghost"===i?"du-tag--ghost":null,r].filter(Boolean).join(" "),style:s,children:t})}},857:function(e,t,r){"use strict";r.d(t,{H:function(){return d},a:function(){return l}});var a=r(7437),s=r(2265),i=r(1180);let n=(0,s.createContext)({userId:null,status:"loading",signOut:async()=>{}});function d(e){let{children:t}=e,r=(0,i.O)(),[d,l]=(0,s.useState)(null),[o,u]=(0,s.useState)(r?"loading":"signed_out"),[c,_]=(0,s.useState)(void 0);(0,s.useEffect)(()=>{if(!r){u("signed_out");return}let e=!1;(async()=>{var t;let{data:a,error:s}=await r.auth.getSession();if(!e){if(s){try{await r.auth.signOut()}catch(e){}u("signed_out"),_(s.message),l(null)}else(null===(t=a.session)||void 0===t?void 0:t.user)?(l(a.session.user.id),u("ready")):u("signed_out")}})();let{data:t}=r.auth.onAuthStateChange((e,t)=>{(null==t?void 0:t.user)?(l(t.user.id),u("ready")):(l(null),u("signed_out"))});return()=>{e=!0,null==t||t.subscription.unsubscribe()}},[r]);let m=async()=>{r&&(await r.auth.signOut(),l(null),u("signed_out"))};return(0,a.jsx)(n.Provider,{value:{userId:d,status:o,error:c,signOut:m},children:t})}function l(){return(0,s.useContext)(n)}},371:function(e,t,r){"use strict";r.d(t,{G:function(){return o},U:function(){return l}});var a=r(7437),s=r(2265),i=r(1180),n=r(857);let d=(0,s.createContext)({regions:[],creatures:[],creatureStages:[],playerCreatures:[],regionCreatures:[],cityCreatures:[],missions:[],missionProgress:[],achievements:[],userAchievements:[],bonds:[],battles:[],profile:null,trainerStats:[],playerStats:[],xpThresholds:[],factions:[],cities:[],status:"idle",isLive:!1,reload:async()=>{}});function l(e){let{children:t}=e,r=(0,i.O)(),{userId:l,status:o}=(0,n.a)(),[u,c]=(0,s.useState)("idle"),[_,m]=(0,s.useState)(void 0),[h,f]=(0,s.useState)([]),[g,p]=(0,s.useState)([]),[v,x]=(0,s.useState)([]),[j,y]=(0,s.useState)([]),[S,b]=(0,s.useState)([]),[w,C]=(0,s.useState)([]),[N,k]=(0,s.useState)([]),[P,q]=(0,s.useState)([]),[A,O]=(0,s.useState)([]),[T,Z]=(0,s.useState)([]),[E,I]=(0,s.useState)([]),[R,B]=(0,s.useState)([]),[M,U]=(0,s.useState)([]),[L,D]=(0,s.useState)(null),[G,H]=(0,s.useState)(!1),[V,F]=(0,s.useState)([]),[J,X]=(0,s.useState)([]),[z,K]=(0,s.useState)([]),[Q,W]=(0,s.useState)([]),Y=async()=>{if(!r||!l){c("idle"),H(!1);return}c("loading"),m(void 0);let e=[],[t,a,s,i,n,d,o,u,_,h,g,v,j,S,w,N,P,A]=await Promise.all([r.from("profiles").select("*").eq("id",l).maybeSingle(),r.from("creatures").select("id, name, name_locales, base_type, region, image_url, is_starter, rarity, sexes"),r.from("creature_stages").select("id, creature_id, stage_name, stage_order, stage_stats, image_url, variant_type, xp_required"),r.from("player_creatures").select("user_id, creature_id, current_stage_id, nickname, variant_type, date_caught, custom_stats, current_xp, level, in_party, party_slot, is_domesticated, stats, sex").eq("user_id",l),r.from("regions").select("id, name, color, island, municipalities, map_polygon"),r.from("region_creatures").select("region_id, creature_id, spawn_rate"),r.from("cities").select("id, name, region_id"),r.from("city_creatures").select("city_id, creature_id, spawn_rate"),r.from("story_missions").select("id, title, description, region_id, order_in_story, unlock_requirements, reward_cc, reward_item, mission_difficulty, is_battle, trainer_id"),r.from("player_mission_progress").select("user_id, mission_id, is_completed, completed_at, completion_date, rewards").eq("user_id",l),r.from("achievements").select("id, name, description, icon_url, criteria_json, reward_cc, reward_item"),r.from("user_achievements").select("id, user_id, achievement_id, achievement_name, description, date_earned, unlocked_at, notified_followers, track_id").eq("user_id",l),r.from("player_faction_bonds").select("user_id, faction, bond_amount").eq("user_id",l),r.from("battles").select("player1_id, player2_id, winner_id, battle_log, started_at, ended_at").or("player1_id.eq.".concat(l,",player2_id.eq.").concat(l)),r.from("player_trainer_stats").select("user_id, trainer_id, wins, losses, familiarity, last_battle_at").eq("user_id",l),r.from("player_stats").select("user_id, stat_key, stat_value").eq("user_id",l),r.from("creature_stage_xp_thresholds").select("id, creature_id, stage_id, xp_required, created_at, updated_at"),r.from("factions").select("id, name, description, color_hex, icon_url, slug, motto, alignment, lore_json")]),T=(t,r)=>{if(!r)return;let a="string"==typeof(null==r?void 0:r.message)?r.message:String(r);e.push("".concat(t,": ").concat(a))};T("profiles",t.error),T("creatures",a.error),T("creature_stages",s.error),T("player_creatures",i.error),T("regions",n.error),T("region_creatures",d.error),T("cities",o.error),T("city_creatures",u.error),T("story_missions",_.error),T("player_mission_progress",h.error),T("achievements",g.error),T("user_achievements",v.error),T("player_faction_bonds",j.error),T("battles",S.error),T("player_trainer_stats",w.error),T("player_stats",N.error),T("creature_stage_xp_thresholds",P.error),T("factions",A.error),t.data&&D(t.data),a.data&&x(a.data),s.data&&y(s.data.map(e=>{var t;return{...e,stage_stats:"string"==typeof e.stage_stats?JSON.parse(e.stage_stats):null!==(t=e.stage_stats)&&void 0!==t?t:{hp:0,atk:0,def:0,speed:0,faith:0}}})),i.data&&b(i.data),n.data&&f(n.data),d.data&&C(d.data),o.data&&p(o.data),u.data&&k(u.data),_.data&&q(_.data),h.data&&O(h.data),g.data&&Z(g.data),v.data&&I(v.data),j.data&&B(j.data),S.data&&U(S.data),w.data&&F(w.data),N.data&&X(N.data),P.data&&K(P.data),A.data&&W(A.data),H(!0),e.length?(c("error"),m(e.join(" | "))):c("ready")};(0,s.useEffect)(()=>{"ready"===o&&Y()},[o,l]);let $=(0,s.useMemo)(()=>({regions:h,creatures:v,creatureStages:j,playerCreatures:S,regionCreatures:w,cityCreatures:N,missions:P,missionProgress:A,achievements:T,userAchievements:E,bonds:R,battles:M,profile:L,trainerStats:V,playerStats:J,xpThresholds:z,factions:Q,cities:g,status:u,error:_,isLive:G,reload:Y}),[h,v,j,S,w,P,A,T,E,R,M,L,V,J,z,Q,u,_,G]);return(0,a.jsx)(d.Provider,{value:$,children:t})}function o(){return(0,s.useContext)(d)}},1180:function(e,t,r){"use strict";r.d(t,{O:function(){return i}});var a=r(3234);let s=null;function i(){if(s)return s;let e="https://npdklestjuejrotjtqwt.supabase.co",t="sb_publishable_9xEllkhUFl85xTTXtDDT5g_ei508t0r";return e&&t?s=(0,a.eI)(e,t,{auth:{persistSession:!0,autoRefreshToken:!0}}):null}},6463:function(e,t,r){"use strict";var a=r(1169);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})}},function(e){e.O(0,[234,138,971,23,744],function(){return e(e.s=9617)}),_N_E=e.O()}]);