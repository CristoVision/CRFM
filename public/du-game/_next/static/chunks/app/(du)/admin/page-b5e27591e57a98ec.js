(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[18],{290:function(e,a,i){Promise.resolve().then(i.bind(i,1315))},1315:function(e,a,i){"use strict";i.r(a),i.d(a,{default:function(){return R}});var l=i(7437),s=i(2265),t=i(6013),r=i(9135),n=i(857),d=i(371),u=i(1180),c=i(495);let o={id:"",name:"",name_locales:null,base_type:"",region:"",image_url:"",is_starter:!1,rarity:"",sexes:["male","female"]};function m(){var e,a,i,r,n;let d=(0,u.O)(),[m,h]=(0,s.useState)([]),[v,p]=(0,s.useState)(!0),[g,_]=(0,s.useState)(""),[x,j]=(0,s.useState)(o),[N,f]=(0,s.useState)(!1),[y,C]=(0,s.useState)(null),b=(0,s.useMemo)(()=>{let e=g.trim().toLowerCase();return e?m.filter(a=>a.name.toLowerCase().includes(e)):m},[m,g]),w=async()=>{if(!d)return;p(!0);let{data:e,error:a}=await d.from("creatures").select("*").order("name");a||h(null!=e?e:[]),p(!1)};(0,s.useEffect)(()=>{w()},[]);let k=e=>{var a,i;j({...e,name_locales:null!==(a=e.name_locales)&&void 0!==a?a:null,sexes:null!==(i=e.sexes)&&void 0!==i?i:["male","female"]}),C(null),f(!0)},S=async()=>{var e,a,i;if(d){C(null);try{if(!x.name.trim())throw Error("Nombre requerido.");let i={name:x.name.trim(),name_locales:null!==(a=x.name_locales)&&void 0!==a?a:null,base_type:x.base_type||null,region:x.region||null,image_url:x.image_url||null,is_starter:!!x.is_starter,rarity:x.rarity||null,sexes:(null===(e=x.sexes)||void 0===e?void 0:e.length)?x.sexes:["male","female"]};if(x.id){let{error:e}=await d.from("creatures").update(i).eq("id",x.id);if(e)throw e}else{let{error:e}=await d.from("creatures").insert(i);if(e)throw e}f(!1),await w()}catch(e){C(null!==(i=null==e?void 0:e.message)&&void 0!==i?i:"Error guardando")}}},E=async e=>{d&&(await d.from("creatures").delete().eq("id",e),await w())};return(0,l.jsx)(t.Z,{title:"Criaturas",badge:(0,l.jsx)("span",{className:"du-badge",children:m.length}),children:(0,l.jsxs)("div",{className:"du-stack",children:[(0,l.jsxs)("div",{className:"du-top",children:[(0,l.jsx)("input",{className:"du-input",placeholder:"Buscar criatura...",value:g,onChange:e=>_(e.target.value)}),(0,l.jsx)(c.z,{onClick:()=>{j(o),C(null),f(!0)},children:"Nueva criatura"})]}),v?(0,l.jsx)("div",{className:"du-meta",children:"Cargando…"}):null,(0,l.jsx)("div",{className:"du-list",children:b.map(e=>(0,l.jsx)("div",{className:"du-card",children:(0,l.jsxs)("div",{className:"du-top",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"du-battle-name",children:e.name}),(0,l.jsxs)("div",{className:"du-meta",children:[e.base_type||"Sin tipo"," \xb7 ",e.region||"Sin regi\xf3n"," \xb7 ",e.rarity||"Sin rareza"]})]}),(0,l.jsxs)("div",{className:"du-chip-row",children:[e.is_starter?(0,l.jsx)("span",{className:"du-badge",children:"Starter"}):null,(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>k(e),children:"Editar"}),(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>E(e.id),children:"Eliminar"})]})]})},e.id))}),N?(0,l.jsx)("div",{className:"du-modal",children:(0,l.jsxs)("div",{className:"du-modal-card",children:[(0,l.jsxs)("div",{className:"du-popup-header",children:[(0,l.jsx)("div",{className:"du-popup-title",children:x.id?"Editar criatura":"Nueva criatura"}),(0,l.jsx)("button",{className:"du-back-btn",onClick:()=>f(!1),children:"Cerrar"})]}),(0,l.jsxs)("div",{className:"du-form",children:[(0,l.jsx)("input",{className:"du-input",placeholder:"Nombre",value:x.name,onChange:e=>j({...x,name:e.target.value})}),(0,l.jsx)("input",{className:"du-input",placeholder:"Tipo base (ej. Mammal)",value:null!==(e=x.base_type)&&void 0!==e?e:"",onChange:e=>j({...x,base_type:e.target.value})}),(0,l.jsx)("input",{className:"du-input",placeholder:"Regi\xf3n",value:null!==(a=x.region)&&void 0!==a?a:"",onChange:e=>j({...x,region:e.target.value})}),(0,l.jsx)("input",{className:"du-input",placeholder:"URL de imagen",value:null!==(i=x.image_url)&&void 0!==i?i:"",onChange:e=>j({...x,image_url:e.target.value})}),(0,l.jsx)("input",{className:"du-input",placeholder:"Rareza",value:null!==(r=x.rarity)&&void 0!==r?r:"",onChange:e=>j({...x,rarity:e.target.value})}),(0,l.jsx)("input",{className:"du-input",placeholder:"Sexos (comma: male,female)",value:(null!==(n=x.sexes)&&void 0!==n?n:[]).join(","),onChange:e=>j({...x,sexes:e.target.value.split(",").map(e=>e.trim()).filter(Boolean)})}),(0,l.jsx)("textarea",{className:"du-input",placeholder:'Locales JSON (ej: {"es":"Nombre","en":"Name"})',rows:3,value:x.name_locales?JSON.stringify(x.name_locales):"",onChange:e=>{try{let a=e.target.value.trim();j({...x,name_locales:a?JSON.parse(a):null})}catch(e){var a;j({...x,name_locales:null!==(a=x.name_locales)&&void 0!==a?a:null})}}}),(0,l.jsxs)("label",{className:"du-meta",children:[(0,l.jsx)("input",{type:"checkbox",checked:!!x.is_starter,onChange:e=>j({...x,is_starter:e.target.checked})})," ","Starter"]}),y?(0,l.jsx)("div",{className:"du-meta",children:y}):null,(0,l.jsxs)("div",{className:"du-popup-actions",children:[(0,l.jsx)(c.z,{onClick:S,children:"Guardar"}),(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>f(!1),children:"Cancelar"})]})]})]})}):null]})})}let h={id:"",creature_id:"",stage_name:"",stage_order:1,stage_stats:{hp:0,atk:0,def:0,speed:0,faith:0},image_url:"",image_url_male:"",image_url_female:"",variant_type:"base",stage_key:"",faction_slug:"",is_shiny:!1,xp_required:0};function v(){var e,a,i,r,n,d,o,m;let v=(0,u.O)(),[p,g]=(0,s.useState)([]),[_,x]=(0,s.useState)([]),[j,N]=(0,s.useState)(!0),[f,y]=(0,s.useState)(""),[C,b]=(0,s.useState)(h),[w,k]=(0,s.useState)(!1),[S,E]=(0,s.useState)(null),q=(0,s.useMemo)(()=>{let e=f.trim().toLowerCase();return e?p.filter(a=>{var i;return null===(i=a.stage_name)||void 0===i?void 0:i.toLowerCase().includes(e)}):p},[p,f]),z=async()=>{var e,a;if(!v)return;N(!0);let[i,l]=await Promise.all([v.from("creature_stages").select("*").order("stage_order"),v.from("creatures").select("id,name").order("name")]);i.error||g((null!==(e=i.data)&&void 0!==e?e:[]).map(e=>({...e,stage_stats:"string"==typeof e.stage_stats?JSON.parse(e.stage_stats):e.stage_stats}))),l.error||x(null!==(a=l.data)&&void 0!==a?a:[]),N(!1)};(0,s.useEffect)(()=>{z()},[]);let O=e=>{var a;b({...h,...e,stage_stats:null!==(a=e.stage_stats)&&void 0!==a?a:h.stage_stats}),E(null),k(!0)},L=async()=>{var e,a,i;if(v){E(null);try{if(!C.creature_id)throw Error("Selecciona la criatura.");if(!C.stage_name.trim())throw Error("Nombre requerido.");let i={creature_id:C.creature_id,stage_name:C.stage_name.trim(),stage_order:Number(C.stage_order)||1,stage_stats:null!==(e=C.stage_stats)&&void 0!==e?e:{},image_url:C.image_url||null,image_url_male:C.image_url_male||null,image_url_female:C.image_url_female||null,variant_type:C.variant_type||null,stage_key:C.stage_key||null,faction_slug:C.faction_slug||null,is_shiny:!!C.is_shiny,xp_required:null!==(a=C.xp_required)&&void 0!==a?a:null};if(C.id){let{error:e}=await v.from("creature_stages").update(i).eq("id",C.id);if(e)throw e}else{let{error:e}=await v.from("creature_stages").insert(i);if(e)throw e}k(!1),await z()}catch(e){E(null!==(i=null==e?void 0:e.message)&&void 0!==i?i:"Error guardando")}}},A=async e=>{v&&(await v.from("creature_stages").delete().eq("id",e),await z())};return(0,l.jsx)(t.Z,{title:"Etapas / Stages",badge:(0,l.jsx)("span",{className:"du-badge",children:p.length}),children:(0,l.jsxs)("div",{className:"du-stack",children:[(0,l.jsxs)("div",{className:"du-top",children:[(0,l.jsx)("input",{className:"du-input",placeholder:"Buscar etapa...",value:f,onChange:e=>y(e.target.value)}),(0,l.jsx)(c.z,{onClick:()=>{b(h),E(null),k(!0)},children:"Nueva etapa"})]}),j?(0,l.jsx)("div",{className:"du-meta",children:"Cargando…"}):null,(0,l.jsx)("div",{className:"du-list",children:q.map(e=>{let a=_.find(a=>a.id===e.creature_id);return(0,l.jsx)("div",{className:"du-card",children:(0,l.jsxs)("div",{className:"du-top",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"du-battle-name",children:e.stage_name}),(0,l.jsxs)("div",{className:"du-meta",children:[(null==a?void 0:a.name)||"Sin criatura"," \xb7 Orden ",e.stage_order]})]}),(0,l.jsxs)("div",{className:"du-chip-row",children:[e.is_shiny?(0,l.jsx)("span",{className:"du-badge",children:"Shiny"}):null,(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>O(e),children:"Editar"}),(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>A(e.id),children:"Eliminar"})]})]})},e.id)})}),w?(0,l.jsx)("div",{className:"du-modal",children:(0,l.jsxs)("div",{className:"du-modal-card",children:[(0,l.jsxs)("div",{className:"du-popup-header",children:[(0,l.jsx)("div",{className:"du-popup-title",children:C.id?"Editar etapa":"Nueva etapa"}),(0,l.jsx)("button",{className:"du-back-btn",onClick:()=>k(!1),children:"Cerrar"})]}),(0,l.jsxs)("div",{className:"du-form",children:[(0,l.jsxs)("select",{className:"du-select",value:C.creature_id,onChange:e=>b({...C,creature_id:e.target.value}),children:[(0,l.jsx)("option",{value:"",children:"Selecciona criatura"}),_.map(e=>(0,l.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,l.jsx)("input",{className:"du-input",placeholder:"Nombre de etapa",value:C.stage_name,onChange:e=>b({...C,stage_name:e.target.value})}),(0,l.jsx)("input",{className:"du-input",type:"number",placeholder:"Orden",value:C.stage_order,onChange:e=>b({...C,stage_order:Number(e.target.value)})}),(0,l.jsx)("textarea",{className:"du-input",rows:4,placeholder:'Stats JSON (ej: {"hp":40,"atk":10})',value:JSON.stringify(null!==(e=C.stage_stats)&&void 0!==e?e:{},null,2),onChange:e=>{try{b({...C,stage_stats:JSON.parse(e.target.value)})}catch(e){b({...C})}}}),(0,l.jsx)("input",{className:"du-input",placeholder:"Stage key (baby/teen/adult/ascended)",value:null!==(a=C.stage_key)&&void 0!==a?a:"",onChange:e=>b({...C,stage_key:e.target.value})}),(0,l.jsx)("input",{className:"du-input",placeholder:"Faction slug (opcional)",value:null!==(i=C.faction_slug)&&void 0!==i?i:"",onChange:e=>b({...C,faction_slug:e.target.value})}),(0,l.jsx)("input",{className:"du-input",placeholder:"Variant type",value:null!==(r=C.variant_type)&&void 0!==r?r:"",onChange:e=>b({...C,variant_type:e.target.value})}),(0,l.jsx)("input",{className:"du-input",type:"number",placeholder:"XP requerida",value:null!==(n=C.xp_required)&&void 0!==n?n:0,onChange:e=>b({...C,xp_required:Number(e.target.value)})}),(0,l.jsx)("input",{className:"du-input",placeholder:"Imagen URL",value:null!==(d=C.image_url)&&void 0!==d?d:"",onChange:e=>b({...C,image_url:e.target.value})}),(0,l.jsx)("input",{className:"du-input",placeholder:"Imagen (male)",value:null!==(o=C.image_url_male)&&void 0!==o?o:"",onChange:e=>b({...C,image_url_male:e.target.value})}),(0,l.jsx)("input",{className:"du-input",placeholder:"Imagen (female)",value:null!==(m=C.image_url_female)&&void 0!==m?m:"",onChange:e=>b({...C,image_url_female:e.target.value})}),(0,l.jsxs)("label",{className:"du-meta",children:[(0,l.jsx)("input",{type:"checkbox",checked:!!C.is_shiny,onChange:e=>b({...C,is_shiny:e.target.checked})})," ","Shiny"]}),S?(0,l.jsx)("div",{className:"du-meta",children:S}):null,(0,l.jsxs)("div",{className:"du-popup-actions",children:[(0,l.jsx)(c.z,{onClick:L,children:"Guardar"}),(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>k(!1),children:"Cancelar"})]})]})]})}):null]})})}let p={id:"",name:"",color:"",island:"PR",municipalities:[],map_polygon:null};function g(){var e,a,i;let r=(0,u.O)(),[n,d]=(0,s.useState)([]),[o,m]=(0,s.useState)(!0),[h,v]=(0,s.useState)(""),[g,_]=(0,s.useState)(p),[x,j]=(0,s.useState)(!1),[N,f]=(0,s.useState)(null),y=(0,s.useMemo)(()=>{let e=h.trim().toLowerCase();return e?n.filter(a=>a.name.toLowerCase().includes(e)):n},[n,h]),C=async()=>{if(!r)return;m(!0);let{data:e,error:a}=await r.from("regions").select("*").order("name");a||d(null!=e?e:[]),m(!1)};(0,s.useEffect)(()=>{C()},[]);let b=e=>{var a,i;_({...p,...e,municipalities:null!==(a=e.municipalities)&&void 0!==a?a:[],map_polygon:null!==(i=e.map_polygon)&&void 0!==i?i:null}),f(null),j(!0)},w=async()=>{var e,a,i;if(r){f(null);try{if(!g.name.trim())throw Error("Nombre requerido.");let i={name:g.name.trim(),color:g.color||null,island:g.island||null,municipalities:null!==(e=g.municipalities)&&void 0!==e?e:[],map_polygon:null!==(a=g.map_polygon)&&void 0!==a?a:null};if(g.id){let{error:e}=await r.from("regions").update(i).eq("id",g.id);if(e)throw e}else{let{error:e}=await r.from("regions").insert(i);if(e)throw e}j(!1),await C()}catch(e){f(null!==(i=null==e?void 0:e.message)&&void 0!==i?i:"Error guardando")}}},k=async e=>{r&&(await r.from("regions").delete().eq("id",e),await C())};return(0,l.jsx)(t.Z,{title:"Regiones",badge:(0,l.jsx)("span",{className:"du-badge",children:n.length}),children:(0,l.jsxs)("div",{className:"du-stack",children:[(0,l.jsxs)("div",{className:"du-top",children:[(0,l.jsx)("input",{className:"du-input",placeholder:"Buscar regi\xf3n...",value:h,onChange:e=>v(e.target.value)}),(0,l.jsx)(c.z,{onClick:()=>{_(p),f(null),j(!0)},children:"Nueva regi\xf3n"})]}),o?(0,l.jsx)("div",{className:"du-meta",children:"Cargando…"}):null,(0,l.jsx)("div",{className:"du-list",children:y.map(e=>{var a,i;return(0,l.jsx)("div",{className:"du-card",children:(0,l.jsxs)("div",{className:"du-top",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"du-battle-name",children:e.name}),(0,l.jsxs)("div",{className:"du-meta",children:[e.island||"—"," \xb7 ",null!==(i=null===(a=e.municipalities)||void 0===a?void 0:a.length)&&void 0!==i?i:0," municipios"]})]}),(0,l.jsxs)("div",{className:"du-chip-row",children:[(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>b(e),children:"Editar"}),(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>k(e.id),children:"Eliminar"})]})]})},e.id)})}),x?(0,l.jsx)("div",{className:"du-modal",children:(0,l.jsxs)("div",{className:"du-modal-card",children:[(0,l.jsxs)("div",{className:"du-popup-header",children:[(0,l.jsx)("div",{className:"du-popup-title",children:g.id?"Editar regi\xf3n":"Nueva regi\xf3n"}),(0,l.jsx)("button",{className:"du-back-btn",onClick:()=>j(!1),children:"Cerrar"})]}),(0,l.jsxs)("div",{className:"du-form",children:[(0,l.jsx)("input",{className:"du-input",placeholder:"Nombre",value:g.name,onChange:e=>_({...g,name:e.target.value})}),(0,l.jsx)("input",{className:"du-input",placeholder:"Color (hex)",value:null!==(e=g.color)&&void 0!==e?e:"",onChange:e=>_({...g,color:e.target.value})}),(0,l.jsx)("input",{className:"du-input",placeholder:"Isla",value:null!==(a=g.island)&&void 0!==a?a:"",onChange:e=>_({...g,island:e.target.value})}),(0,l.jsx)("input",{className:"du-input",placeholder:"Municipios (comma)",value:(null!==(i=g.municipalities)&&void 0!==i?i:[]).join(","),onChange:e=>_({...g,municipalities:e.target.value.split(",").map(e=>e.trim()).filter(Boolean)})}),(0,l.jsx)("textarea",{className:"du-input",rows:4,placeholder:"Map polygon JSON (opcional)",value:g.map_polygon?JSON.stringify(g.map_polygon):"",onChange:e=>{try{let a=e.target.value.trim();_({...g,map_polygon:a?JSON.parse(a):null})}catch(e){_({...g})}}}),N?(0,l.jsx)("div",{className:"du-meta",children:N}):null,(0,l.jsxs)("div",{className:"du-popup-actions",children:[(0,l.jsx)(c.z,{onClick:w,children:"Guardar"}),(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>j(!1),children:"Cancelar"})]})]})]})}):null]})})}let _={id:"",name:"",region_id:""};function x(){var e;let a=(0,u.O)(),[i,r]=(0,s.useState)([]),[n,d]=(0,s.useState)([]),[o,m]=(0,s.useState)(!0),[h,v]=(0,s.useState)(""),[p,g]=(0,s.useState)(_),[x,j]=(0,s.useState)(!1),[N,f]=(0,s.useState)(null),y=(0,s.useMemo)(()=>{let e=h.trim().toLowerCase();return e?i.filter(a=>a.name.toLowerCase().includes(e)):i},[i,h]),C=async()=>{var e,i;if(!a)return;m(!0);let[l,s]=await Promise.all([a.from("cities").select("*").order("name"),a.from("regions").select("id,name").order("name")]);l.error||r(null!==(e=l.data)&&void 0!==e?e:[]),s.error||d(null!==(i=s.data)&&void 0!==i?i:[]),m(!1)};(0,s.useEffect)(()=>{C()},[]);let b=e=>{g({..._,...e}),f(null),j(!0)},w=async()=>{if(a){f(null);try{if(!p.name.trim())throw Error("Nombre requerido.");let e={name:p.name.trim(),region_id:p.region_id||null};if(p.id){let{error:i}=await a.from("cities").update(e).eq("id",p.id);if(i)throw i}else{let{error:i}=await a.from("cities").insert(e);if(i)throw i}j(!1),await C()}catch(a){var e;f(null!==(e=null==a?void 0:a.message)&&void 0!==e?e:"Error guardando")}}},k=async e=>{a&&(await a.from("cities").delete().eq("id",e),await C())};return(0,l.jsx)(t.Z,{title:"Ciudades",badge:(0,l.jsx)("span",{className:"du-badge",children:i.length}),children:(0,l.jsxs)("div",{className:"du-stack",children:[(0,l.jsxs)("div",{className:"du-top",children:[(0,l.jsx)("input",{className:"du-input",placeholder:"Buscar ciudad...",value:h,onChange:e=>v(e.target.value)}),(0,l.jsx)(c.z,{onClick:()=>{g(_),f(null),j(!0)},children:"Nueva ciudad"})]}),o?(0,l.jsx)("div",{className:"du-meta",children:"Cargando…"}):null,(0,l.jsx)("div",{className:"du-list",children:y.map(e=>{var a;return(0,l.jsx)("div",{className:"du-card",children:(0,l.jsxs)("div",{className:"du-top",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"du-battle-name",children:e.name}),(0,l.jsx)("div",{className:"du-meta",children:(null===(a=n.find(a=>a.id===e.region_id))||void 0===a?void 0:a.name)||"Sin regi\xf3n"})]}),(0,l.jsxs)("div",{className:"du-chip-row",children:[(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>b(e),children:"Editar"}),(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>k(e.id),children:"Eliminar"})]})]})},e.id)})}),x?(0,l.jsx)("div",{className:"du-modal",children:(0,l.jsxs)("div",{className:"du-modal-card",children:[(0,l.jsxs)("div",{className:"du-popup-header",children:[(0,l.jsx)("div",{className:"du-popup-title",children:p.id?"Editar ciudad":"Nueva ciudad"}),(0,l.jsx)("button",{className:"du-back-btn",onClick:()=>j(!1),children:"Cerrar"})]}),(0,l.jsxs)("div",{className:"du-form",children:[(0,l.jsx)("input",{className:"du-input",placeholder:"Nombre",value:p.name,onChange:e=>g({...p,name:e.target.value})}),(0,l.jsxs)("select",{className:"du-select",value:null!==(e=p.region_id)&&void 0!==e?e:"",onChange:e=>g({...p,region_id:e.target.value}),children:[(0,l.jsx)("option",{value:"",children:"Sin regi\xf3n"}),n.map(e=>(0,l.jsx)("option",{value:e.id,children:e.name},e.id))]}),N?(0,l.jsx)("div",{className:"du-meta",children:N}):null,(0,l.jsxs)("div",{className:"du-popup-actions",children:[(0,l.jsx)(c.z,{onClick:w,children:"Guardar"}),(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>j(!1),children:"Cancelar"})]})]})]})}):null]})})}let j={id:"",title:"",description:"",region_id:"",order_in_story:1,unlock_requirements:"",reward_cc:0,reward_item:"",mission_difficulty:"Beginner",is_battle:!1,trainer_id:""};function N(){var e,a,i,r,n,d,o,m;let h=(0,u.O)(),[v,p]=(0,s.useState)([]),[g,_]=(0,s.useState)([]),[x,N]=(0,s.useState)([]),[f,y]=(0,s.useState)(!0),[C,b]=(0,s.useState)(""),[w,k]=(0,s.useState)(j),[S,E]=(0,s.useState)(!1),[q,z]=(0,s.useState)(null),O=(0,s.useMemo)(()=>{let e=C.trim().toLowerCase();return e?v.filter(a=>a.title.toLowerCase().includes(e)):v},[v,C]),L=async()=>{var e,a,i;if(!h)return;y(!0);let[l,s,t]=await Promise.all([h.from("story_missions").select("*").order("order_in_story"),h.from("regions").select("id,name").order("name"),h.from("trainers").select("id,name").order("name")]);l.error||p(null!==(e=l.data)&&void 0!==e?e:[]),s.error||_(null!==(a=s.data)&&void 0!==a?a:[]),t.error||N(null!==(i=t.data)&&void 0!==i?i:[]),y(!1)};(0,s.useEffect)(()=>{L()},[]);let A=e=>{k({...j,...e}),z(null),E(!0)},B=async()=>{var e,a,i;if(h){z(null);try{if(!w.title.trim())throw Error("Titulo requerido.");let i={title:w.title.trim(),description:w.description||null,region_id:w.region_id||null,order_in_story:null!==(e=w.order_in_story)&&void 0!==e?e:null,unlock_requirements:w.unlock_requirements||null,reward_cc:null!==(a=w.reward_cc)&&void 0!==a?a:null,reward_item:w.reward_item||null,mission_difficulty:w.mission_difficulty||null,is_battle:!!w.is_battle,trainer_id:w.trainer_id||null};if(w.id){let{error:e}=await h.from("story_missions").update(i).eq("id",w.id);if(e)throw e}else{let{error:e}=await h.from("story_missions").insert(i);if(e)throw e}E(!1),await L()}catch(e){z(null!==(i=null==e?void 0:e.message)&&void 0!==i?i:"Error guardando")}}},M=async e=>{h&&(await h.from("story_missions").delete().eq("id",e),await L())};return(0,l.jsx)(t.Z,{title:"Misiones",badge:(0,l.jsx)("span",{className:"du-badge",children:v.length}),children:(0,l.jsxs)("div",{className:"du-stack",children:[(0,l.jsxs)("div",{className:"du-top",children:[(0,l.jsx)("input",{className:"du-input",placeholder:"Buscar misi\xf3n...",value:C,onChange:e=>b(e.target.value)}),(0,l.jsx)(c.z,{onClick:()=>{k(j),z(null),E(!0)},children:"Nueva misi\xf3n"})]}),f?(0,l.jsx)("div",{className:"du-meta",children:"Cargando…"}):null,(0,l.jsx)("div",{className:"du-list",children:O.map(e=>{var a,i;return(0,l.jsx)("div",{className:"du-card",children:(0,l.jsxs)("div",{className:"du-top",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"du-battle-name",children:e.title}),(0,l.jsxs)("div",{className:"du-meta",children:[(null===(a=g.find(a=>a.id===e.region_id))||void 0===a?void 0:a.name)||"Sin regi\xf3n"," \xb7 Orden ",null!==(i=e.order_in_story)&&void 0!==i?i:"—"]})]}),(0,l.jsxs)("div",{className:"du-chip-row",children:[e.is_battle?(0,l.jsx)("span",{className:"du-badge",children:"Battle"}):null,(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>A(e),children:"Editar"}),(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>M(e.id),children:"Eliminar"})]})]})},e.id)})}),S?(0,l.jsx)("div",{className:"du-modal",children:(0,l.jsxs)("div",{className:"du-modal-card",children:[(0,l.jsxs)("div",{className:"du-popup-header",children:[(0,l.jsx)("div",{className:"du-popup-title",children:w.id?"Editar misi\xf3n":"Nueva misi\xf3n"}),(0,l.jsx)("button",{className:"du-back-btn",onClick:()=>E(!1),children:"Cerrar"})]}),(0,l.jsxs)("div",{className:"du-form",children:[(0,l.jsx)("input",{className:"du-input",placeholder:"Titulo",value:w.title,onChange:e=>k({...w,title:e.target.value})}),(0,l.jsx)("textarea",{className:"du-input",rows:3,placeholder:"Descripci\xf3n",value:null!==(e=w.description)&&void 0!==e?e:"",onChange:e=>k({...w,description:e.target.value})}),(0,l.jsxs)("select",{className:"du-select",value:null!==(a=w.region_id)&&void 0!==a?a:"",onChange:e=>k({...w,region_id:e.target.value}),children:[(0,l.jsx)("option",{value:"",children:"Sin regi\xf3n"}),g.map(e=>(0,l.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,l.jsxs)("select",{className:"du-select",value:null!==(i=w.trainer_id)&&void 0!==i?i:"",onChange:e=>k({...w,trainer_id:e.target.value}),children:[(0,l.jsx)("option",{value:"",children:"Sin entrenador"}),x.map(e=>(0,l.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,l.jsx)("input",{className:"du-input",type:"number",placeholder:"Orden en historia",value:null!==(r=w.order_in_story)&&void 0!==r?r:1,onChange:e=>k({...w,order_in_story:Number(e.target.value)})}),(0,l.jsx)("input",{className:"du-input",placeholder:"Requisitos (texto)",value:null!==(n=w.unlock_requirements)&&void 0!==n?n:"",onChange:e=>k({...w,unlock_requirements:e.target.value})}),(0,l.jsx)("input",{className:"du-input",placeholder:"Reward item",value:null!==(d=w.reward_item)&&void 0!==d?d:"",onChange:e=>k({...w,reward_item:e.target.value})}),(0,l.jsx)("input",{className:"du-input",type:"number",placeholder:"Reward CC",value:null!==(o=w.reward_cc)&&void 0!==o?o:0,onChange:e=>k({...w,reward_cc:Number(e.target.value)})}),(0,l.jsx)("input",{className:"du-input",placeholder:"Dificultad",value:null!==(m=w.mission_difficulty)&&void 0!==m?m:"",onChange:e=>k({...w,mission_difficulty:e.target.value})}),(0,l.jsxs)("label",{className:"du-meta",children:[(0,l.jsx)("input",{type:"checkbox",checked:!!w.is_battle,onChange:e=>k({...w,is_battle:e.target.checked})})," ","Misi\xf3n de batalla"]}),q?(0,l.jsx)("div",{className:"du-meta",children:q}):null,(0,l.jsxs)("div",{className:"du-popup-actions",children:[(0,l.jsx)(c.z,{onClick:B,children:"Guardar"}),(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>E(!1),children:"Cancelar"})]})]})]})}):null]})})}let f={id:"",name:"",description:"",icon_url:"",criteria_json:{},reward_cc:0,reward_item:""};function y(){var e,a,i,r,n;let d=(0,u.O)(),[o,m]=(0,s.useState)([]),[h,v]=(0,s.useState)(!0),[p,g]=(0,s.useState)(""),[_,x]=(0,s.useState)(f),[j,N]=(0,s.useState)(!1),[y,C]=(0,s.useState)(null),b=(0,s.useMemo)(()=>{let e=p.trim().toLowerCase();return e?o.filter(a=>a.name.toLowerCase().includes(e)):o},[o,p]),w=async()=>{if(!d)return;v(!0);let{data:e,error:a}=await d.from("achievements").select("*").order("name");a||m(null!=e?e:[]),v(!1)};(0,s.useEffect)(()=>{w()},[]);let k=e=>{var a;x({...f,...e,criteria_json:null!==(a=e.criteria_json)&&void 0!==a?a:{}}),C(null),N(!0)},S=async()=>{var e,a,i;if(d){C(null);try{if(!_.name.trim())throw Error("Nombre requerido.");let i={name:_.name.trim(),description:_.description||null,icon_url:_.icon_url||null,criteria_json:null!==(e=_.criteria_json)&&void 0!==e?e:{},reward_cc:null!==(a=_.reward_cc)&&void 0!==a?a:null,reward_item:_.reward_item||null};if(_.id){let{error:e}=await d.from("achievements").update(i).eq("id",_.id);if(e)throw e}else{let{error:e}=await d.from("achievements").insert(i);if(e)throw e}N(!1),await w()}catch(e){C(null!==(i=null==e?void 0:e.message)&&void 0!==i?i:"Error guardando")}}},E=async e=>{d&&(await d.from("achievements").delete().eq("id",e),await w())};return(0,l.jsx)(t.Z,{title:"Logros",badge:(0,l.jsx)("span",{className:"du-badge",children:o.length}),children:(0,l.jsxs)("div",{className:"du-stack",children:[(0,l.jsxs)("div",{className:"du-top",children:[(0,l.jsx)("input",{className:"du-input",placeholder:"Buscar logro...",value:p,onChange:e=>g(e.target.value)}),(0,l.jsx)(c.z,{onClick:()=>{x(f),C(null),N(!0)},children:"Nuevo logro"})]}),h?(0,l.jsx)("div",{className:"du-meta",children:"Cargando…"}):null,(0,l.jsx)("div",{className:"du-list",children:b.map(e=>(0,l.jsx)("div",{className:"du-card",children:(0,l.jsxs)("div",{className:"du-top",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"du-battle-name",children:e.name}),(0,l.jsx)("div",{className:"du-meta",children:e.description||"Sin descripci\xf3n"})]}),(0,l.jsxs)("div",{className:"du-chip-row",children:[(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>k(e),children:"Editar"}),(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>E(e.id),children:"Eliminar"})]})]})},e.id))}),j?(0,l.jsx)("div",{className:"du-modal",children:(0,l.jsxs)("div",{className:"du-modal-card",children:[(0,l.jsxs)("div",{className:"du-popup-header",children:[(0,l.jsx)("div",{className:"du-popup-title",children:_.id?"Editar logro":"Nuevo logro"}),(0,l.jsx)("button",{className:"du-back-btn",onClick:()=>N(!1),children:"Cerrar"})]}),(0,l.jsxs)("div",{className:"du-form",children:[(0,l.jsx)("input",{className:"du-input",placeholder:"Nombre",value:_.name,onChange:e=>x({..._,name:e.target.value})}),(0,l.jsx)("textarea",{className:"du-input",rows:3,placeholder:"Descripci\xf3n",value:null!==(e=_.description)&&void 0!==e?e:"",onChange:e=>x({..._,description:e.target.value})}),(0,l.jsx)("input",{className:"du-input",placeholder:"Icon URL",value:null!==(a=_.icon_url)&&void 0!==a?a:"",onChange:e=>x({..._,icon_url:e.target.value})}),(0,l.jsx)("input",{className:"du-input",placeholder:"Reward item",value:null!==(i=_.reward_item)&&void 0!==i?i:"",onChange:e=>x({..._,reward_item:e.target.value})}),(0,l.jsx)("input",{className:"du-input",type:"number",placeholder:"Reward CC",value:null!==(r=_.reward_cc)&&void 0!==r?r:0,onChange:e=>x({..._,reward_cc:Number(e.target.value)})}),(0,l.jsx)("textarea",{className:"du-input",rows:4,placeholder:"Criteria JSON",value:JSON.stringify(null!==(n=_.criteria_json)&&void 0!==n?n:{},null,2),onChange:e=>{try{x({..._,criteria_json:JSON.parse(e.target.value)})}catch(e){x({..._})}}}),y?(0,l.jsx)("div",{className:"du-meta",children:y}):null,(0,l.jsxs)("div",{className:"du-popup-actions",children:[(0,l.jsx)(c.z,{onClick:S,children:"Guardar"}),(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>N(!1),children:"Cancelar"})]})]})]})}):null]})})}let C={id:"",name:"",slug:"",bio:"",region_id:"",faction_id:"",difficulty:"Beginner",is_npc:!0,is_active:!0,avatar_url:"",battle_music_config:{play_order:"sequential",track_ids:[]}},b=()=>"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"".concat(Date.now(),"-").concat(Math.random());function w(){var e,a,i,r,n,d,o;let m=(0,u.O)(),[h,v]=(0,s.useState)([]),[p,g]=(0,s.useState)([]),[_,x]=(0,s.useState)([]),[j,N]=(0,s.useState)([]),[f,y]=(0,s.useState)([]),[w,k]=(0,s.useState)(!0),[S,E]=(0,s.useState)(""),[q,z]=(0,s.useState)(C),[O,L]=(0,s.useState)([]),[A,B]=(0,s.useState)(!1),[M,J]=(0,s.useState)(null),R=(0,s.useMemo)(()=>{let e=S.trim().toLowerCase();return e?h.filter(a=>a.name.toLowerCase().includes(e)):h},[h,S]),I=async()=>{var e,a,i,l,s;if(!m)return;k(!0);let[t,r,n,d,u]=await Promise.all([m.from("trainers").select("*").order("name"),m.from("regions").select("id,name").order("name"),m.from("factions").select("id,name").order("name"),m.from("creatures").select("id,name").order("name"),m.from("creature_stages").select("id,creature_id,stage_name").order("stage_order")]);t.error||v(null!==(e=t.data)&&void 0!==e?e:[]),r.error||g(null!==(a=r.data)&&void 0!==a?a:[]),n.error||x(null!==(i=n.data)&&void 0!==i?i:[]),d.error||N(null!==(l=d.data)&&void 0!==l?l:[]),u.error||y(null!==(s=u.data)&&void 0!==s?s:[]),k(!1)};(0,s.useEffect)(()=>{I()},[]);let P=async e=>{var a;if(!m)return;let{data:i}=await m.from("trainer_creatures").select("*").eq("trainer_id",e.id).order("slot_order");z({...C,...e,battle_music_config:null!==(a=e.battle_music_config)&&void 0!==a?a:{play_order:"sequential",track_ids:[]}}),L(null!=i?i:[]),J(null),B(!0)},T=async()=>{var e,a;if(m){J(null);try{if(!q.name.trim())throw Error("Nombre requerido.");let a={name:q.name.trim(),slug:q.slug||null,bio:q.bio||null,region_id:q.region_id||null,faction_id:q.faction_id||null,difficulty:q.difficulty||null,is_npc:!!q.is_npc,is_active:!!q.is_active,avatar_url:q.avatar_url||null,battle_music_config:null!==(e=q.battle_music_config)&&void 0!==e?e:{play_order:"sequential",track_ids:[]}},i=q.id;if(q.id){let{error:e}=await m.from("trainers").update(a).eq("id",q.id);if(e)throw e}else{let{data:e,error:l}=await m.from("trainers").insert(a).select("id").single();if(l)throw l;i=null==e?void 0:e.id}if(!i)throw Error("No trainer id");if(await m.from("trainer_creatures").delete().eq("trainer_id",i),O.length){let e=O.map((e,a)=>{var l;return{id:e.id||b(),trainer_id:i,creature_id:e.creature_id||null,stage_id:e.stage_id||null,level:null!==(l=e.level)&&void 0!==l?l:1,nickname:e.nickname||null,variant_type:e.variant_type||"normal",slot_order:a}}),{error:a}=await m.from("trainer_creatures").insert(e);if(a)throw a}B(!1),await I()}catch(e){J(null!==(a=null==e?void 0:e.message)&&void 0!==a?a:"Error guardando")}}},G=async e=>{m&&(await m.from("trainers").delete().eq("id",e),await I())},D=(e,a)=>{L(O.map(i=>i.id===e?{...i,...a}:i))},U=e=>{L(O.filter(a=>a.id!==e))},Z=(e,a)=>{let i=O.findIndex(a=>a.id===e);if(i<0)return;let l=i+a;if(l<0||l>=O.length)return;let s=[...O],[t]=s.splice(i,1);s.splice(l,0,t),L(s)};return(0,l.jsx)(t.Z,{title:"Entrenadores",badge:(0,l.jsx)("span",{className:"du-badge",children:h.length}),children:(0,l.jsxs)("div",{className:"du-stack",children:[(0,l.jsxs)("div",{className:"du-top",children:[(0,l.jsx)("input",{className:"du-input",placeholder:"Buscar entrenador...",value:S,onChange:e=>E(e.target.value)}),(0,l.jsx)(c.z,{onClick:()=>{z(C),L([]),J(null),B(!0)},children:"Nuevo entrenador"})]}),w?(0,l.jsx)("div",{className:"du-meta",children:"Cargando…"}):null,(0,l.jsx)("div",{className:"du-list",children:R.map(e=>(0,l.jsx)("div",{className:"du-card",children:(0,l.jsxs)("div",{className:"du-top",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"du-battle-name",children:e.name}),(0,l.jsxs)("div",{className:"du-meta",children:[e.difficulty||"—"," \xb7 ",e.is_active?"Activo":"Inactivo"]})]}),(0,l.jsxs)("div",{className:"du-chip-row",children:[(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>void P(e),children:"Editar"}),(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>G(e.id),children:"Eliminar"})]})]})},e.id))}),A?(0,l.jsx)("div",{className:"du-modal",children:(0,l.jsxs)("div",{className:"du-modal-card",style:{width:"min(880px, 100%)"},children:[(0,l.jsxs)("div",{className:"du-popup-header",children:[(0,l.jsx)("div",{className:"du-popup-title",children:q.id?"Editar entrenador":"Nuevo entrenador"}),(0,l.jsx)("button",{className:"du-back-btn",onClick:()=>B(!1),children:"Cerrar"})]}),(0,l.jsxs)("div",{className:"du-form",children:[(0,l.jsxs)("div",{className:"du-grid two",children:[(0,l.jsx)("input",{className:"du-input",placeholder:"Nombre",value:q.name,onChange:e=>z({...q,name:e.target.value})}),(0,l.jsx)("input",{className:"du-input",placeholder:"Slug (opcional)",value:null!==(e=q.slug)&&void 0!==e?e:"",onChange:e=>z({...q,slug:e.target.value})})]}),(0,l.jsx)("textarea",{className:"du-input",rows:3,placeholder:"Bio",value:null!==(a=q.bio)&&void 0!==a?a:"",onChange:e=>z({...q,bio:e.target.value})}),(0,l.jsx)("input",{className:"du-input",placeholder:"Avatar URL",value:null!==(i=q.avatar_url)&&void 0!==i?i:"",onChange:e=>z({...q,avatar_url:e.target.value})}),(0,l.jsxs)("div",{className:"du-grid two",children:[(0,l.jsxs)("select",{className:"du-select",value:null!==(r=q.region_id)&&void 0!==r?r:"",onChange:e=>z({...q,region_id:e.target.value}),children:[(0,l.jsx)("option",{value:"",children:"Sin regi\xf3n"}),p.map(e=>(0,l.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,l.jsxs)("select",{className:"du-select",value:null!==(n=q.faction_id)&&void 0!==n?n:"",onChange:e=>z({...q,faction_id:e.target.value}),children:[(0,l.jsx)("option",{value:"",children:"Sin facci\xf3n"}),_.map(e=>(0,l.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,l.jsxs)("div",{className:"du-grid two",children:[(0,l.jsx)("input",{className:"du-input",placeholder:"Dificultad",value:null!==(d=q.difficulty)&&void 0!==d?d:"",onChange:e=>z({...q,difficulty:e.target.value})}),(0,l.jsx)("input",{className:"du-input",placeholder:"Battle music JSON (track_ids)",value:JSON.stringify(null!==(o=q.battle_music_config)&&void 0!==o?o:{play_order:"sequential",track_ids:[]}),onChange:e=>{try{z({...q,battle_music_config:JSON.parse(e.target.value)})}catch(e){z({...q})}}})]}),(0,l.jsxs)("div",{className:"du-chip-row",children:[(0,l.jsxs)("label",{className:"du-meta",children:[(0,l.jsx)("input",{type:"checkbox",checked:!!q.is_npc,onChange:e=>z({...q,is_npc:e.target.checked})})," ","NPC"]}),(0,l.jsxs)("label",{className:"du-meta",children:[(0,l.jsx)("input",{type:"checkbox",checked:!!q.is_active,onChange:e=>z({...q,is_active:e.target.checked})})," ","Activo"]})]}),(0,l.jsx)("div",{className:"du-divider"}),(0,l.jsxs)("div",{className:"du-stack",children:[(0,l.jsxs)("div",{className:"du-top",children:[(0,l.jsx)("div",{className:"du-battle-name",children:"Equipo"}),(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>{O.length>=6||L([...O,{id:b(),level:1,slot_order:O.length}])},children:"Agregar criatura"})]}),O.map((e,a)=>{var i,s,t,r,n;let d=f.filter(a=>a.creature_id===e.creature_id);return(0,l.jsxs)("div",{className:"du-card",children:[(0,l.jsxs)("div",{className:"du-grid three",children:[(0,l.jsxs)("select",{className:"du-select",value:null!==(i=e.creature_id)&&void 0!==i?i:"",onChange:a=>D(e.id,{creature_id:a.target.value,stage_id:""}),children:[(0,l.jsx)("option",{value:"",children:"Criatura"}),j.map(e=>(0,l.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,l.jsxs)("select",{className:"du-select",value:null!==(s=e.stage_id)&&void 0!==s?s:"",onChange:a=>D(e.id,{stage_id:a.target.value}),children:[(0,l.jsx)("option",{value:"",children:"Etapa"}),d.map(e=>(0,l.jsx)("option",{value:e.id,children:e.stage_name},e.id))]}),(0,l.jsx)("input",{className:"du-input",type:"number",placeholder:"Nivel",value:null!==(t=e.level)&&void 0!==t?t:1,onChange:a=>D(e.id,{level:Number(a.target.value)})})]}),(0,l.jsxs)("div",{className:"du-grid two",children:[(0,l.jsx)("input",{className:"du-input",placeholder:"Nickname",value:null!==(r=e.nickname)&&void 0!==r?r:"",onChange:a=>D(e.id,{nickname:a.target.value})}),(0,l.jsx)("input",{className:"du-input",placeholder:"Variant",value:null!==(n=e.variant_type)&&void 0!==n?n:"normal",onChange:a=>D(e.id,{variant_type:a.target.value})})]}),(0,l.jsxs)("div",{className:"du-chip-row",children:[(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>Z(e.id,-1),disabled:0===a,children:"↑"}),(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>Z(e.id,1),disabled:a===O.length-1,children:"↓"}),(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>U(e.id),children:"Eliminar"})]})]},e.id)})]}),M?(0,l.jsx)("div",{className:"du-meta",children:M}):null,(0,l.jsxs)("div",{className:"du-popup-actions",children:[(0,l.jsx)(c.z,{onClick:T,children:"Guardar"}),(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>B(!1),children:"Cancelar"})]})]})]})}):null]})})}let k={id:"",title:"",season:"",starts_at:"",ends_at:"",is_active:!0},S={id:"",pass_id:"",tier_number:1,title:"",description:"",reward_cc:0,reward_item:"",reward_type:"",unlock_xp:0,is_premium:!1};function E(){var e,a,i,r,n,d;let o=(0,u.O)(),[m,h]=(0,s.useState)([]),[v,p]=(0,s.useState)([]),[g,_]=(0,s.useState)(""),[x,j]=(0,s.useState)(!0),[N,f]=(0,s.useState)(k),[y,C]=(0,s.useState)(S),[b,w]=(0,s.useState)(!1),[E,q]=(0,s.useState)(!1),[z,O]=(0,s.useState)(null),L=(0,s.useMemo)(()=>{var e;return null!==(e=m.find(e=>e.id===g))&&void 0!==e?e:null},[m,g]),A=async()=>{if(!o)return;let{data:e,error:a}=await o.from("battle_passes").select("*").order("starts_at",{ascending:!1});if(!a){let a=null!=e?e:[];h(a),!g&&a.length&&_(a[0].id)}},B=async e=>{if(!o||!e)return;let{data:a,error:i}=await o.from("battle_pass_tiers").select("*").eq("pass_id",e).order("tier_number");i||p(null!=a?a:[])},M=async()=>{j(!0),await A(),j(!1)};(0,s.useEffect)(()=>{M()},[]),(0,s.useEffect)(()=>{g&&B(g)},[g]);let J=e=>{f({...e}),O(null),w(!0)},R=async()=>{if(o){O(null);try{if(!N.title.trim()||!N.season.trim())throw Error("Titulo y temporada requeridos.");let e={title:N.title.trim(),season:N.season.trim(),starts_at:N.starts_at,ends_at:N.ends_at,is_active:!!N.is_active};if(N.id){let{error:a}=await o.from("battle_passes").update(e).eq("id",N.id);if(a)throw a}else{let{data:a,error:i}=await o.from("battle_passes").insert(e).select("id").single();if(i)throw i;(null==a?void 0:a.id)&&_(a.id)}w(!1),await A()}catch(a){var e;O(null!==(e=null==a?void 0:a.message)&&void 0!==e?e:"Error guardando")}}},I=async e=>{o&&(await o.from("battle_passes").delete().eq("id",e),await A())},P=e=>{C({...S,...e}),O(null),q(!0)},T=async()=>{var e,a,i;if(o){O(null);try{if(!y.pass_id)throw Error("Selecciona un battle pass.");let i={pass_id:y.pass_id,tier_number:Number(y.tier_number)||1,title:y.title||null,description:y.description||null,reward_cc:null!==(e=y.reward_cc)&&void 0!==e?e:null,reward_item:y.reward_item||null,reward_type:y.reward_type||null,unlock_xp:null!==(a=y.unlock_xp)&&void 0!==a?a:null,is_premium:!!y.is_premium};if(y.id){let{error:e}=await o.from("battle_pass_tiers").update(i).eq("id",y.id);if(e)throw e}else{let{error:e}=await o.from("battle_pass_tiers").insert(i);if(e)throw e}q(!1),await B(g)}catch(e){O(null!==(i=null==e?void 0:e.message)&&void 0!==i?i:"Error guardando")}}},G=async e=>{o&&(await o.from("battle_pass_tiers").delete().eq("id",e),await B(g))};return(0,l.jsx)(t.Z,{title:"Battle Pass",badge:(0,l.jsx)("span",{className:"du-badge",children:m.length}),children:(0,l.jsxs)("div",{className:"du-stack",children:[x?(0,l.jsx)("div",{className:"du-meta",children:"Cargando…"}):null,(0,l.jsxs)("div",{className:"du-top",children:[(0,l.jsx)("div",{className:"du-chip-row",children:m.map(e=>(0,l.jsx)("button",{className:"du-tab".concat(e.id===g?" active":""),onClick:()=>_(e.id),children:e.season},e.id))}),(0,l.jsx)(c.z,{onClick:()=>{f(k),O(null),w(!0)},children:"Nuevo pass"})]}),L?(0,l.jsx)("div",{className:"du-card",children:(0,l.jsxs)("div",{className:"du-top",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"du-battle-name",children:L.title}),(0,l.jsxs)("div",{className:"du-meta",children:[L.season," \xb7 ",L.is_active?"Activo":"Inactivo"]})]}),(0,l.jsxs)("div",{className:"du-chip-row",children:[(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>J(L),children:"Editar"}),(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>I(L.id),children:"Eliminar"})]})]})}):null,(0,l.jsxs)("div",{className:"du-top",children:[(0,l.jsx)("div",{className:"du-battle-name",children:"Tiers"}),(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>{C({...S,pass_id:g,tier_number:v.length+1}),O(null),q(!0)},disabled:!g,children:"Agregar tier"})]}),(0,l.jsx)("div",{className:"du-list",children:v.map(e=>{var a;return(0,l.jsx)("div",{className:"du-card",children:(0,l.jsxs)("div",{className:"du-top",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"du-battle-name",children:["Tier ",e.tier_number," \xb7 ",e.title||"Sin titulo"]}),(0,l.jsxs)("div",{className:"du-meta",children:[e.reward_item||"—"," \xb7 ",null!==(a=e.reward_cc)&&void 0!==a?a:0," CC"]})]}),(0,l.jsxs)("div",{className:"du-chip-row",children:[e.is_premium?(0,l.jsx)("span",{className:"du-badge",children:"Premium"}):null,(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>P(e),children:"Editar"}),(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>G(e.id),children:"Eliminar"})]})]})},e.id)})}),b?(0,l.jsx)("div",{className:"du-modal",children:(0,l.jsxs)("div",{className:"du-modal-card",children:[(0,l.jsxs)("div",{className:"du-popup-header",children:[(0,l.jsx)("div",{className:"du-popup-title",children:N.id?"Editar pass":"Nuevo pass"}),(0,l.jsx)("button",{className:"du-back-btn",onClick:()=>w(!1),children:"Cerrar"})]}),(0,l.jsxs)("div",{className:"du-form",children:[(0,l.jsx)("input",{className:"du-input",placeholder:"Titulo",value:N.title,onChange:e=>f({...N,title:e.target.value})}),(0,l.jsx)("input",{className:"du-input",placeholder:"Temporada",value:N.season,onChange:e=>f({...N,season:e.target.value})}),(0,l.jsx)("input",{className:"du-input",type:"datetime-local",value:N.starts_at,onChange:e=>f({...N,starts_at:e.target.value})}),(0,l.jsx)("input",{className:"du-input",type:"datetime-local",value:N.ends_at,onChange:e=>f({...N,ends_at:e.target.value})}),(0,l.jsxs)("label",{className:"du-meta",children:[(0,l.jsx)("input",{type:"checkbox",checked:!!N.is_active,onChange:e=>f({...N,is_active:e.target.checked})})," ","Activo"]}),z?(0,l.jsx)("div",{className:"du-meta",children:z}):null,(0,l.jsxs)("div",{className:"du-popup-actions",children:[(0,l.jsx)(c.z,{onClick:R,children:"Guardar"}),(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>w(!1),children:"Cancelar"})]})]})]})}):null,E?(0,l.jsx)("div",{className:"du-modal",children:(0,l.jsxs)("div",{className:"du-modal-card",children:[(0,l.jsxs)("div",{className:"du-popup-header",children:[(0,l.jsx)("div",{className:"du-popup-title",children:y.id?"Editar tier":"Nuevo tier"}),(0,l.jsx)("button",{className:"du-back-btn",onClick:()=>q(!1),children:"Cerrar"})]}),(0,l.jsxs)("div",{className:"du-form",children:[(0,l.jsx)("input",{className:"du-input",type:"number",placeholder:"Tier #",value:y.tier_number,onChange:e=>C({...y,tier_number:Number(e.target.value)})}),(0,l.jsx)("input",{className:"du-input",placeholder:"Titulo",value:null!==(e=y.title)&&void 0!==e?e:"",onChange:e=>C({...y,title:e.target.value})}),(0,l.jsx)("textarea",{className:"du-input",rows:3,placeholder:"Descripci\xf3n",value:null!==(a=y.description)&&void 0!==a?a:"",onChange:e=>C({...y,description:e.target.value})}),(0,l.jsx)("input",{className:"du-input",placeholder:"Reward item",value:null!==(i=y.reward_item)&&void 0!==i?i:"",onChange:e=>C({...y,reward_item:e.target.value})}),(0,l.jsx)("input",{className:"du-input",type:"number",placeholder:"Reward CC",value:null!==(r=y.reward_cc)&&void 0!==r?r:0,onChange:e=>C({...y,reward_cc:Number(e.target.value)})}),(0,l.jsx)("input",{className:"du-input",placeholder:"Reward type",value:null!==(n=y.reward_type)&&void 0!==n?n:"",onChange:e=>C({...y,reward_type:e.target.value})}),(0,l.jsx)("input",{className:"du-input",type:"number",placeholder:"Unlock XP",value:null!==(d=y.unlock_xp)&&void 0!==d?d:0,onChange:e=>C({...y,unlock_xp:Number(e.target.value)})}),(0,l.jsxs)("label",{className:"du-meta",children:[(0,l.jsx)("input",{type:"checkbox",checked:!!y.is_premium,onChange:e=>C({...y,is_premium:e.target.checked})})," ","Premium"]}),z?(0,l.jsx)("div",{className:"du-meta",children:z}):null,(0,l.jsxs)("div",{className:"du-popup-actions",children:[(0,l.jsx)(c.z,{onClick:T,children:"Guardar"}),(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>q(!1),children:"Cancelar"})]})]})]})}):null]})})}let q={id:"",name:"",description:"",rarity:"",icon_url:"",effect_json:{},is_active:!0};function z(){var e,a,i,r;let n=(0,u.O)(),[d,o]=(0,s.useState)([]),[m,h]=(0,s.useState)(!0),[v,p]=(0,s.useState)(""),[g,_]=(0,s.useState)(q),[x,j]=(0,s.useState)(!1),[N,f]=(0,s.useState)(null),y=(0,s.useMemo)(()=>{let e=v.trim().toLowerCase();return e?d.filter(a=>a.name.toLowerCase().includes(e)):d},[d,v]),C=async()=>{if(!n)return;h(!0);let{data:e,error:a}=await n.from("du_items").select("*").order("name");a||o(null!=e?e:[]),h(!1)};(0,s.useEffect)(()=>{C()},[]);let b=e=>{var a;_({...q,...e,effect_json:null!==(a=e.effect_json)&&void 0!==a?a:{}}),f(null),j(!0)},w=async()=>{var e,a;if(n){f(null);try{if(!g.name.trim())throw Error("Nombre requerido.");let a={name:g.name.trim(),description:g.description||null,rarity:g.rarity||null,icon_url:g.icon_url||null,effect_json:null!==(e=g.effect_json)&&void 0!==e?e:{},is_active:!!g.is_active};if(g.id){let{error:e}=await n.from("du_items").update(a).eq("id",g.id);if(e)throw e}else{let{error:e}=await n.from("du_items").insert(a);if(e)throw e}j(!1),await C()}catch(e){f(null!==(a=null==e?void 0:e.message)&&void 0!==a?a:"Error guardando")}}},k=async e=>{n&&(await n.from("du_items").delete().eq("id",e),await C())};return(0,l.jsx)(t.Z,{title:"Items",badge:(0,l.jsx)("span",{className:"du-badge",children:d.length}),children:(0,l.jsxs)("div",{className:"du-stack",children:[(0,l.jsxs)("div",{className:"du-top",children:[(0,l.jsx)("input",{className:"du-input",placeholder:"Buscar item...",value:v,onChange:e=>p(e.target.value)}),(0,l.jsx)(c.z,{onClick:()=>{_(q),f(null),j(!0)},children:"Nuevo item"})]}),m?(0,l.jsx)("div",{className:"du-meta",children:"Cargando…"}):null,(0,l.jsx)("div",{className:"du-list",children:y.map(e=>(0,l.jsx)("div",{className:"du-card",children:(0,l.jsxs)("div",{className:"du-top",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"du-battle-name",children:e.name}),(0,l.jsxs)("div",{className:"du-meta",children:[e.rarity||"—"," \xb7 ",e.is_active?"Activo":"Inactivo"]})]}),(0,l.jsxs)("div",{className:"du-chip-row",children:[(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>b(e),children:"Editar"}),(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>k(e.id),children:"Eliminar"})]})]})},e.id))}),x?(0,l.jsx)("div",{className:"du-modal",children:(0,l.jsxs)("div",{className:"du-modal-card",children:[(0,l.jsxs)("div",{className:"du-popup-header",children:[(0,l.jsx)("div",{className:"du-popup-title",children:g.id?"Editar item":"Nuevo item"}),(0,l.jsx)("button",{className:"du-back-btn",onClick:()=>j(!1),children:"Cerrar"})]}),(0,l.jsxs)("div",{className:"du-form",children:[(0,l.jsx)("input",{className:"du-input",placeholder:"Nombre",value:g.name,onChange:e=>_({...g,name:e.target.value})}),(0,l.jsx)("input",{className:"du-input",placeholder:"Rareza",value:null!==(e=g.rarity)&&void 0!==e?e:"",onChange:e=>_({...g,rarity:e.target.value})}),(0,l.jsx)("input",{className:"du-input",placeholder:"Icon URL",value:null!==(a=g.icon_url)&&void 0!==a?a:"",onChange:e=>_({...g,icon_url:e.target.value})}),(0,l.jsx)("textarea",{className:"du-input",rows:3,placeholder:"Descripci\xf3n",value:null!==(i=g.description)&&void 0!==i?i:"",onChange:e=>_({...g,description:e.target.value})}),(0,l.jsx)("textarea",{className:"du-input",rows:4,placeholder:"Effect JSON",value:JSON.stringify(null!==(r=g.effect_json)&&void 0!==r?r:{},null,2),onChange:e=>{try{_({...g,effect_json:JSON.parse(e.target.value)})}catch(e){_({...g})}}}),(0,l.jsxs)("label",{className:"du-meta",children:[(0,l.jsx)("input",{type:"checkbox",checked:!!g.is_active,onChange:e=>_({...g,is_active:e.target.checked})})," ","Activo"]}),N?(0,l.jsx)("div",{className:"du-meta",children:N}):null,(0,l.jsxs)("div",{className:"du-popup-actions",children:[(0,l.jsx)(c.z,{onClick:w,children:"Guardar"}),(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>j(!1),children:"Cancelar"})]})]})]})}):null]})})}let O={id:"",name:"",description:"",category:"",icon_url:"",effect_json:{},is_active:!0};function L(){var e,a,i,r;let n=(0,u.O)(),[d,o]=(0,s.useState)([]),[m,h]=(0,s.useState)(!0),[v,p]=(0,s.useState)(""),[g,_]=(0,s.useState)(O),[x,j]=(0,s.useState)(!1),[N,f]=(0,s.useState)(null),y=(0,s.useMemo)(()=>{let e=v.trim().toLowerCase();return e?d.filter(a=>a.name.toLowerCase().includes(e)):d},[d,v]),C=async()=>{if(!n)return;h(!0);let{data:e,error:a}=await n.from("du_skills").select("*").order("name");a||o(null!=e?e:[]),h(!1)};(0,s.useEffect)(()=>{C()},[]);let b=e=>{var a;_({...O,...e,effect_json:null!==(a=e.effect_json)&&void 0!==a?a:{}}),f(null),j(!0)},w=async()=>{var e,a;if(n){f(null);try{if(!g.name.trim())throw Error("Nombre requerido.");let a={name:g.name.trim(),description:g.description||null,category:g.category||null,icon_url:g.icon_url||null,effect_json:null!==(e=g.effect_json)&&void 0!==e?e:{},is_active:!!g.is_active};if(g.id){let{error:e}=await n.from("du_skills").update(a).eq("id",g.id);if(e)throw e}else{let{error:e}=await n.from("du_skills").insert(a);if(e)throw e}j(!1),await C()}catch(e){f(null!==(a=null==e?void 0:e.message)&&void 0!==a?a:"Error guardando")}}},k=async e=>{n&&(await n.from("du_skills").delete().eq("id",e),await C())};return(0,l.jsx)(t.Z,{title:"Skills",badge:(0,l.jsx)("span",{className:"du-badge",children:d.length}),children:(0,l.jsxs)("div",{className:"du-stack",children:[(0,l.jsxs)("div",{className:"du-top",children:[(0,l.jsx)("input",{className:"du-input",placeholder:"Buscar skill...",value:v,onChange:e=>p(e.target.value)}),(0,l.jsx)(c.z,{onClick:()=>{_(O),f(null),j(!0)},children:"Nueva skill"})]}),m?(0,l.jsx)("div",{className:"du-meta",children:"Cargando…"}):null,(0,l.jsx)("div",{className:"du-list",children:y.map(e=>(0,l.jsx)("div",{className:"du-card",children:(0,l.jsxs)("div",{className:"du-top",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"du-battle-name",children:e.name}),(0,l.jsxs)("div",{className:"du-meta",children:[e.category||"—"," \xb7 ",e.is_active?"Activa":"Inactiva"]})]}),(0,l.jsxs)("div",{className:"du-chip-row",children:[(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>b(e),children:"Editar"}),(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>k(e.id),children:"Eliminar"})]})]})},e.id))}),x?(0,l.jsx)("div",{className:"du-modal",children:(0,l.jsxs)("div",{className:"du-modal-card",children:[(0,l.jsxs)("div",{className:"du-popup-header",children:[(0,l.jsx)("div",{className:"du-popup-title",children:g.id?"Editar skill":"Nueva skill"}),(0,l.jsx)("button",{className:"du-back-btn",onClick:()=>j(!1),children:"Cerrar"})]}),(0,l.jsxs)("div",{className:"du-form",children:[(0,l.jsx)("input",{className:"du-input",placeholder:"Nombre",value:g.name,onChange:e=>_({...g,name:e.target.value})}),(0,l.jsx)("input",{className:"du-input",placeholder:"Categoria",value:null!==(e=g.category)&&void 0!==e?e:"",onChange:e=>_({...g,category:e.target.value})}),(0,l.jsx)("input",{className:"du-input",placeholder:"Icon URL",value:null!==(a=g.icon_url)&&void 0!==a?a:"",onChange:e=>_({...g,icon_url:e.target.value})}),(0,l.jsx)("textarea",{className:"du-input",rows:3,placeholder:"Descripci\xf3n",value:null!==(i=g.description)&&void 0!==i?i:"",onChange:e=>_({...g,description:e.target.value})}),(0,l.jsx)("textarea",{className:"du-input",rows:4,placeholder:"Effect JSON",value:JSON.stringify(null!==(r=g.effect_json)&&void 0!==r?r:{},null,2),onChange:e=>{try{_({...g,effect_json:JSON.parse(e.target.value)})}catch(e){_({...g})}}}),(0,l.jsxs)("label",{className:"du-meta",children:[(0,l.jsx)("input",{type:"checkbox",checked:!!g.is_active,onChange:e=>_({...g,is_active:e.target.checked})})," ","Activa"]}),N?(0,l.jsx)("div",{className:"du-meta",children:N}):null,(0,l.jsxs)("div",{className:"du-popup-actions",children:[(0,l.jsx)(c.z,{onClick:w,children:"Guardar"}),(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>j(!1),children:"Cancelar"})]})]})]})}):null]})})}let A={page_key:"",track_ids:[],play_order:"sequential"},B=["Home","Map","Creatures","Battle","Missions","Achievements","Profile","Admin"];function M(){var e,a;let i=(0,u.O)(),[r,n]=(0,s.useState)([]),[d,o]=(0,s.useState)(A),[m,h]=(0,s.useState)(!1),[v,p]=(0,s.useState)(null),g=async()=>{if(!i)return;let{data:e,error:a}=await i.from("du_page_music_config").select("*").order("page_key");a||n((null!=e?e:[]).map(e=>{var a;return{...e,track_ids:null!==(a=e.track_ids)&&void 0!==a?a:[]}}))};(0,s.useEffect)(()=>{g()},[]);let _=e=>{var a,i;o({...e,track_ids:null!==(a=e.track_ids)&&void 0!==a?a:[],play_order:null!==(i=e.play_order)&&void 0!==i?i:"sequential"}),p(null),h(!0)},x=async()=>{var e,a;if(i){p(null);try{if(!d.page_key.trim())throw Error("Page key requerido.");let a={page_key:d.page_key.trim(),track_ids:null!==(e=d.track_ids)&&void 0!==e?e:[],play_order:d.play_order||"sequential",updated_at:new Date().toISOString()},{error:l}=await i.from("du_page_music_config").upsert(a,{onConflict:"page_key"});if(l)throw l;h(!1),await g()}catch(e){p(null!==(a=null==e?void 0:e.message)&&void 0!==a?a:"Error guardando")}}},j=async e=>{i&&(await i.from("du_page_music_config").delete().eq("page_key",e),await g())};return(0,l.jsx)(t.Z,{title:"Musica por pagina",badge:(0,l.jsx)("span",{className:"du-badge",children:r.length}),children:(0,l.jsxs)("div",{className:"du-stack",children:[(0,l.jsxs)("div",{className:"du-top",children:[(0,l.jsx)("div",{className:"du-meta",children:"Asignar tracks (UUIDs) por p\xe1gina."}),(0,l.jsx)(c.z,{onClick:()=>{o(A),p(null),h(!0)},children:"Nueva asignaci\xf3n"})]}),(0,l.jsx)("div",{className:"du-list",children:r.map(e=>(0,l.jsx)("div",{className:"du-card",children:(0,l.jsxs)("div",{className:"du-top",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"du-battle-name",children:e.page_key}),(0,l.jsxs)("div",{className:"du-meta",children:[e.track_ids.length," track(s) \xb7 ",e.play_order]})]}),(0,l.jsxs)("div",{className:"du-chip-row",children:[(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>_(e),children:"Editar"}),(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>j(e.page_key),children:"Eliminar"})]})]})},e.page_key))}),m?(0,l.jsx)("div",{className:"du-modal",children:(0,l.jsxs)("div",{className:"du-modal-card",children:[(0,l.jsxs)("div",{className:"du-popup-header",children:[(0,l.jsx)("div",{className:"du-popup-title",children:d.page_key?"Editar musica":"Nueva musica"}),(0,l.jsx)("button",{className:"du-back-btn",onClick:()=>h(!1),children:"Cerrar"})]}),(0,l.jsxs)("div",{className:"du-form",children:[(0,l.jsxs)("select",{className:"du-select",value:d.page_key,onChange:e=>o({...d,page_key:e.target.value}),children:[(0,l.jsx)("option",{value:"",children:"Selecciona pagina"}),B.map(e=>(0,l.jsx)("option",{value:e,children:e},e))]}),(0,l.jsx)("input",{className:"du-input",placeholder:"Track IDs (comma)",value:(null!==(e=d.track_ids)&&void 0!==e?e:[]).join(","),onChange:e=>o({...d,track_ids:e.target.value.split(",").map(e=>e.trim()).filter(Boolean)})}),(0,l.jsx)("input",{className:"du-input",placeholder:"Play order (sequential/shuffle)",value:null!==(a=d.play_order)&&void 0!==a?a:"sequential",onChange:e=>o({...d,play_order:e.target.value})}),v?(0,l.jsx)("div",{className:"du-meta",children:v}):null,(0,l.jsxs)("div",{className:"du-popup-actions",children:[(0,l.jsx)(c.z,{onClick:x,children:"Guardar"}),(0,l.jsx)(c.z,{variant:"ghost",onClick:()=>h(!1),children:"Cancelar"})]})]})]})}):null]})})}function J(){var e,a,i,u;let{status:c,userId:o}=(0,n.a)(),h=(0,d.G)(),p=(null===(e=h.profile)||void 0===e?void 0:e.role)==="admin"||(null===(a=h.profile)||void 0===a?void 0:a.is_admin),_=(0,s.useMemo)(()=>[{id:"creatures",label:"Criaturas",component:(0,l.jsx)(m,{})},{id:"stages",label:"Etapas",component:(0,l.jsx)(v,{})},{id:"regions",label:"Regiones",component:(0,l.jsx)(g,{})},{id:"cities",label:"Ciudades",component:(0,l.jsx)(x,{})},{id:"missions",label:"Misiones",component:(0,l.jsx)(N,{})},{id:"achievements",label:"Logros",component:(0,l.jsx)(y,{})},{id:"trainers",label:"Entrenadores",component:(0,l.jsx)(w,{})},{id:"battlepass",label:"Battle Pass",component:(0,l.jsx)(E,{})},{id:"items",label:"Items",component:(0,l.jsx)(z,{})},{id:"skills",label:"Skills",component:(0,l.jsx)(L,{})},{id:"music",label:"Musica",component:(0,l.jsx)(M,{})}],[]),[j,f]=(0,s.useState)(null!==(u=null===(i=_[0])||void 0===i?void 0:i.id)&&void 0!==u?u:"creatures"),C=_.find(e=>e.id===j);return(0,l.jsxs)("div",{className:"du-stack",children:[(0,l.jsxs)(t.Z,{title:"Admin / Game Engine",badge:(0,l.jsx)(r.A,{children:p?"Authorized":"Sign in as admin"}),children:[(0,l.jsx)("p",{children:"Gestiona criaturas, etapas, regiones, misiones, entrenadores, battle pass, items y musica del juego."}),(0,l.jsxs)("div",{className:"du-chip-row",children:[(0,l.jsx)(r.A,{children:"creatures"}),(0,l.jsx)(r.A,{children:"trainers"}),(0,l.jsx)(r.A,{children:"missions"}),(0,l.jsx)(r.A,{children:"battle pass"})]}),"loading"===c?(0,l.jsx)("div",{className:"du-meta",children:"Checking session…"}):null,p?null:(0,l.jsx)("div",{className:"du-meta",style:{marginTop:10},children:"Requiere `profiles.role = admin` o `profiles.is_admin = true`."})]}),p?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"du-tabs",children:_.map(e=>(0,l.jsx)("button",{className:"du-tab".concat(e.id===j?" active":""),onClick:()=>f(e.id),children:e.label},e.id))}),null==C?void 0:C.component]}):null]})}function R(){var e,a;let i=(0,d.G)(),s=(null===(e=i.profile)||void 0===e?void 0:e.role)==="admin"||(null===(a=i.profile)||void 0===a?void 0:a.is_admin);return(0,l.jsxs)("div",{className:"du-stack",children:[(0,l.jsx)(t.Z,{title:"Admin",badge:(0,l.jsx)(r.A,{children:s?"Authorized":"Sign in as admin"}),children:(0,l.jsx)("p",{className:"du-meta",children:"Manage regions, creatures, stages, assignments, missions, achievements. Only visible if your profile is admin."})}),(0,l.jsx)(J,{})]})}},495:function(e,a,i){"use strict";i.d(a,{z:function(){return r}});var l=i(7437),s=i(2265);let t=e=>"ghost"===e?"du-button ghost":"quick"===e?"du-button du-quick":"du-button",r=(0,s.forwardRef)((e,a)=>{let{variant:i="solid",full:s,className:r,...n}=e;return(0,l.jsx)("button",{ref:a,className:"".concat(t(i)).concat(s?" du-btn-full":""," ").concat(null!=r?r:""),...n})});r.displayName="Button"},6013:function(e,a,i){"use strict";i.d(a,{Z:function(){return s}});var l=i(7437);function s(e){let{children:a,title:i,badge:s,footer:t,className:r}=e;return(0,l.jsxs)("div",{className:["du-card",r].filter(Boolean).join(" "),children:[(i||s)&&(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[i?(0,l.jsx)("h3",{style:{margin:0},children:i}):(0,l.jsx)("span",{}),s]}),a,t?(0,l.jsx)("div",{style:{marginTop:10},children:t}):null]})}},9135:function(e,a,i){"use strict";i.d(a,{A:function(){return s}});var l=i(7437);function s(e){let{children:a,className:i,style:s,variant:t}=e;return(0,l.jsx)("span",{className:["du-tag","ghost"===t?"du-tag--ghost":null,i].filter(Boolean).join(" "),style:s,children:a})}},857:function(e,a,i){"use strict";i.d(a,{H:function(){return n},a:function(){return d}});var l=i(7437),s=i(2265),t=i(1180);let r=(0,s.createContext)({userId:null,status:"loading",signOut:async()=>{}});function n(e){let{children:a}=e,i=(0,t.O)(),[n,d]=(0,s.useState)(null),[u,c]=(0,s.useState)(i?"loading":"signed_out"),[o,m]=(0,s.useState)(void 0);(0,s.useEffect)(()=>{if(!i){c("signed_out");return}let e=!1;(async()=>{var a;let{data:l,error:s}=await i.auth.getSession();if(!e){if(s){try{await i.auth.signOut()}catch(e){}c("signed_out"),m(s.message),d(null)}else(null===(a=l.session)||void 0===a?void 0:a.user)?(d(l.session.user.id),c("ready")):c("signed_out")}})();let{data:a}=i.auth.onAuthStateChange((e,a)=>{(null==a?void 0:a.user)?(d(a.user.id),c("ready")):(d(null),c("signed_out"))});return()=>{e=!0,null==a||a.subscription.unsubscribe()}},[i]);let h=async()=>{i&&(await i.auth.signOut(),d(null),c("signed_out"))};return(0,l.jsx)(r.Provider,{value:{userId:n,status:u,error:o,signOut:h},children:a})}function d(){return(0,s.useContext)(r)}},371:function(e,a,i){"use strict";i.d(a,{G:function(){return u},U:function(){return d}});var l=i(7437),s=i(2265),t=i(1180),r=i(857);let n=(0,s.createContext)({regions:[],creatures:[],creatureStages:[],playerCreatures:[],regionCreatures:[],cityCreatures:[],missions:[],missionProgress:[],achievements:[],userAchievements:[],bonds:[],battles:[],profile:null,trainerStats:[],playerStats:[],xpThresholds:[],factions:[],cities:[],status:"idle",isLive:!1,reload:async()=>{}});function d(e){let{children:a}=e,i=(0,t.O)(),{userId:d,status:u}=(0,r.a)(),[c,o]=(0,s.useState)("idle"),[m,h]=(0,s.useState)(void 0),[v,p]=(0,s.useState)([]),[g,_]=(0,s.useState)([]),[x,j]=(0,s.useState)([]),[N,f]=(0,s.useState)([]),[y,C]=(0,s.useState)([]),[b,w]=(0,s.useState)([]),[k,S]=(0,s.useState)([]),[E,q]=(0,s.useState)([]),[z,O]=(0,s.useState)([]),[L,A]=(0,s.useState)([]),[B,M]=(0,s.useState)([]),[J,R]=(0,s.useState)([]),[I,P]=(0,s.useState)([]),[T,G]=(0,s.useState)(null),[D,U]=(0,s.useState)(!1),[Z,F]=(0,s.useState)([]),[X,H]=(0,s.useState)([]),[V,K]=(0,s.useState)([]),[Q,W]=(0,s.useState)([]),Y=async()=>{if(!i||!d){o("idle"),U(!1);return}o("loading"),h(void 0);let e=[],[a,l,s,t,r,n,u,c,m,v,g,x,N,y,b,k,E,z]=await Promise.all([i.from("profiles").select("*").eq("id",d).maybeSingle(),i.from("creatures").select("id, name, name_locales, base_type, region, image_url, is_starter, rarity, sexes"),i.from("creature_stages").select("id, creature_id, stage_name, stage_order, stage_stats, image_url, image_url_male, image_url_female, variant_type, xp_required"),i.from("player_creatures").select("user_id, creature_id, current_stage_id, nickname, variant_type, date_caught, custom_stats, current_xp, level, in_party, party_slot, is_domesticated, stats, sex").eq("user_id",d),i.from("regions").select("id, name, color, island, municipalities, map_polygon"),i.from("region_creatures").select("region_id, creature_id, spawn_rate"),i.from("cities").select("id, name, region_id"),i.from("city_creatures").select("city_id, creature_id, spawn_rate"),i.from("story_missions").select("id, title, description, region_id, order_in_story, unlock_requirements, reward_cc, reward_item, mission_difficulty, is_battle, trainer_id"),i.from("player_mission_progress").select("user_id, mission_id, is_completed, completed_at, completion_date, rewards").eq("user_id",d),i.from("achievements").select("id, name, description, icon_url, criteria_json, reward_cc, reward_item"),i.from("user_achievements").select("id, user_id, achievement_id, achievement_name, description, date_earned, unlocked_at, notified_followers, track_id").eq("user_id",d),i.from("player_faction_bonds").select("user_id, faction, bond_amount").eq("user_id",d),i.from("battles").select("player1_id, player2_id, winner_id, battle_log, started_at, ended_at").or("player1_id.eq.".concat(d,",player2_id.eq.").concat(d)),i.from("player_trainer_stats").select("user_id, trainer_id, wins, losses, familiarity, last_battle_at").eq("user_id",d),i.from("player_stats").select("user_id, stat_key, stat_value").eq("user_id",d),i.from("creature_stage_xp_thresholds").select("id, creature_id, stage_id, xp_required, created_at, updated_at"),i.from("factions").select("id, name, description, color_hex, icon_url, slug, motto, alignment, lore_json")]),L=(a,i)=>{if(!i)return;let l="string"==typeof(null==i?void 0:i.message)?i.message:String(i);e.push("".concat(a,": ").concat(l))};L("profiles",a.error),L("creatures",l.error),L("creature_stages",s.error),L("player_creatures",t.error),L("regions",r.error),L("region_creatures",n.error),L("cities",u.error),L("city_creatures",c.error),L("story_missions",m.error),L("player_mission_progress",v.error),L("achievements",g.error),L("user_achievements",x.error),L("player_faction_bonds",N.error),L("battles",y.error),L("player_trainer_stats",b.error),L("player_stats",k.error),L("creature_stage_xp_thresholds",E.error),L("factions",z.error),a.data&&G(a.data),l.data&&j(l.data),s.data&&f(s.data.map(e=>{var a;return{...e,stage_stats:"string"==typeof e.stage_stats?JSON.parse(e.stage_stats):null!==(a=e.stage_stats)&&void 0!==a?a:{hp:0,atk:0,def:0,speed:0,faith:0}}})),t.data&&C(t.data),r.data&&p(r.data),n.data&&w(n.data),u.data&&_(u.data),c.data&&S(c.data),m.data&&q(m.data),v.data&&O(v.data),g.data&&A(g.data),x.data&&M(x.data),N.data&&R(N.data),y.data&&P(y.data),b.data&&F(b.data),k.data&&H(k.data),E.data&&K(E.data),z.data&&W(z.data),U(!0),e.length?(o("error"),h(e.join(" | "))):o("ready")};(0,s.useEffect)(()=>{"ready"===u&&Y()},[u,d]);let $=(0,s.useMemo)(()=>({regions:v,creatures:x,creatureStages:N,playerCreatures:y,regionCreatures:b,cityCreatures:k,missions:E,missionProgress:z,achievements:L,userAchievements:B,bonds:J,battles:I,profile:T,trainerStats:Z,playerStats:X,xpThresholds:V,factions:Q,cities:g,status:c,error:m,isLive:D,reload:Y}),[v,x,N,y,b,E,z,L,B,J,I,T,Z,X,V,Q,c,m,D]);return(0,l.jsx)(n.Provider,{value:$,children:a})}function u(){return(0,s.useContext)(n)}},1180:function(e,a,i){"use strict";i.d(a,{O:function(){return t}});var l=i(3234);let s=null;function t(){if(s)return s;let e="https://npdklestjuejrotjtqwt.supabase.co",a="sb_publishable_9xEllkhUFl85xTTXtDDT5g_ei508t0r";return e&&a?s=(0,l.eI)(e,a,{auth:{persistSession:!0,autoRefreshToken:!0}}):null}}},function(e){e.O(0,[234,971,23,744],function(){return e(e.s=290)}),_N_E=e.O()}]);