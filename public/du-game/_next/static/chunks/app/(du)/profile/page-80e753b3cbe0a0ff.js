(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[960],{7182:function(e,a,t){Promise.resolve().then(t.bind(t,537))},537:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return _}});var s=t(7437),r=t(2265),i=t(371),l=t(857),n=t(6013),d=t(9135);function u(e){let{playerStats:a,trainerStats:t}=e;return(0,s.jsxs)("div",{className:"du-grid two",children:[(0,s.jsx)(n.Z,{title:"Player stats",children:(0,s.jsxs)("div",{className:"du-list",children:[a.map(e=>(0,s.jsxs)("div",{className:"du-chip-row",children:[(0,s.jsx)(d.A,{children:e.stat_key}),(0,s.jsx)(d.A,{children:JSON.stringify(e.stat_value)})]},e.stat_key)),0===a.length&&(0,s.jsx)("p",{className:"du-meta",children:"No player_stats yet."})]})}),(0,s.jsx)(n.Z,{title:"Trainer stats",children:(0,s.jsxs)("div",{className:"du-list",children:[t.map(e=>(0,s.jsxs)("div",{className:"du-chip-row",children:[(0,s.jsxs)(d.A,{children:["Trainer ",e.trainer_id]}),(0,s.jsxs)(d.A,{children:["W ",e.wins]}),(0,s.jsxs)(d.A,{children:["L ",e.losses]}),(0,s.jsxs)(d.A,{children:["Familiarity ",e.familiarity]}),e.last_battle_at?(0,s.jsxs)(d.A,{children:["Last: ",e.last_battle_at]}):null]},e.trainer_id)),0===t.length&&(0,s.jsx)("p",{className:"du-meta",children:"No trainer battles yet."})]})})]})}var o=t(495),c=t(1180),m=t(7138);function _(){var e,a,t,_,p,h,v,f,g,x;let y=(0,i.G)(),j=(0,l.a)(),b=y.profile,N=(0,c.O)(),[S,w]=(0,r.useState)(!1),[C,k]=(0,r.useState)(!1),[A,q]=(0,r.useState)(void 0),[B,E]=(0,r.useState)({display_name:null!==(a=null!==(e=null==b?void 0:b.display_name)&&void 0!==e?e:null==b?void 0:b.username)&&void 0!==a?a:"",country:null!==(t=null==b?void 0:b.country)&&void 0!==t?t:"",bio:null!==(_=null==b?void 0:b.bio)&&void 0!==_?_:"",avatar_url:null!==(p=null==b?void 0:b.avatar_url)&&void 0!==p?p:""});(0,r.useEffect)(()=>{var e,a,t,s,r,i;E({display_name:null!==(a=null!==(e=null==b?void 0:b.display_name)&&void 0!==e?e:null==b?void 0:b.username)&&void 0!==a?a:"",country:null!==(t=null==b?void 0:b.country)&&void 0!==t?t:"",bio:null!==(s=null==b?void 0:b.bio)&&void 0!==s?s:"",avatar_url:null!==(r=null==b?void 0:b.avatar_url)&&void 0!==r?r:""}),q(null!==(i=null==b?void 0:b.avatar_url)&&void 0!==i?i:"")},[null==b?void 0:b.avatar_url,null==b?void 0:b.bio,null==b?void 0:b.country,null==b?void 0:b.display_name,null==b?void 0:b.username]);let P=null!==(h=null==b?void 0:b.total_xp)&&void 0!==h?h:0,O=null!==(v=null==b?void 0:b.total_battles)&&void 0!==v?v:0,T=null!==(f=null==b?void 0:b.total_creatures_domesticated)&&void 0!==f?f:0,I=null!==(g=null==b?void 0:b.country)&&void 0!==g?g:"—",Z=null!==(x=null==b?void 0:b.role)&&void 0!==x?x:(null==b?void 0:b.is_admin)?"admin":"player",z=(0,r.useMemo)(()=>y.bonds.reduce((e,a)=>{var t;return e+(null!==(t=a.bond_amount)&&void 0!==t?t:0)},0),[y.bonds]),D=async()=>{N&&j.userId&&(k(!0),await N.from("profiles").update({display_name:B.display_name,country:B.country,bio:B.bio,avatar_url:B.avatar_url}).eq("id",j.userId),k(!1),w(!1),y.reload())};return(0,s.jsxs)("div",{className:"du-stack",children:[(0,s.jsxs)(n.Z,{className:"du-profile-hero",children:[(0,s.jsxs)("div",{className:"du-profile-top",children:[(0,s.jsx)("div",{className:"du-profile-avatar",children:A?(0,s.jsx)("img",{src:A,alt:"avatar",className:"du-avatar-img"}):null}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"du-profile-name",children:(null==b?void 0:b.display_name)||(null==b?void 0:b.username)||"Jugador"}),(0,s.jsxs)("div",{className:"du-profile-sub",children:[(0,s.jsxs)("span",{children:["Role: ",Z]})," \xb7 ",(0,s.jsxs)("span",{children:["Country: ",I]})]})]}),(0,s.jsx)(o.z,{variant:"ghost",onClick:()=>w(!0),children:"Edit Profile"})]}),(0,s.jsxs)("div",{className:"du-chip-row",style:{marginTop:8},children:[(0,s.jsxs)(d.A,{children:["Total XP: ",P]}),(0,s.jsxs)(d.A,{children:["Battles: ",O]}),(0,s.jsxs)(d.A,{children:["Domesticated: ",T]}),(0,s.jsxs)(d.A,{children:["Bonds: ",z]})]})]}),(0,s.jsxs)(n.Z,{title:"Factions & Bonds",badge:(0,s.jsxs)(d.A,{children:[z," Bonds"]}),children:[(0,s.jsx)("p",{className:"du-meta",children:y.bonds.length?"Facci\xf3n activa":"Sin facci\xf3n seleccionada."}),(0,s.jsxs)("div",{className:"du-chip-row",children:[y.bonds.map(e=>(0,s.jsxs)(d.A,{children:[e.faction,": ",e.bond_amount]},e.faction)),0===y.bonds.length&&(0,s.jsx)("span",{className:"du-meta",children:"Suma Bonds jugando misiones y batallas."})]}),(0,s.jsxs)("div",{className:"du-chip-row",style:{marginTop:8},children:[(0,s.jsx)(m.default,{href:"/map",className:"du-button ghost",children:"Ir al mapa (facci\xf3n)"}),(0,s.jsx)(m.default,{href:"/battle",className:"du-button ghost",children:"Batallar para Bonds"})]})]}),(0,s.jsxs)(n.Z,{title:"Acciones r\xe1pidas",children:[(0,s.jsx)("p",{className:"du-meta",children:"Accede a tus rutas clave."}),(0,s.jsxs)("div",{className:"du-grid two",children:[(0,s.jsxs)(n.Z,{title:"Explorar mapa",badge:(0,s.jsx)(d.A,{children:"Encuentros"}),children:[(0,s.jsx)("p",{className:"du-meta",children:"Encuentra criaturas y misiones por regi\xf3n."}),(0,s.jsx)(m.default,{href:"/map",className:"du-button du-btn-full",children:"Ir al mapa"})]}),(0,s.jsxs)(n.Z,{title:"Entrenar en batalla",badge:(0,s.jsx)(d.A,{children:"XP + Bonds"}),children:[(0,s.jsx)("p",{className:"du-meta",children:"Combate contra NPCs o PvP."}),(0,s.jsx)(m.default,{href:"/battle",className:"du-button du-btn-full ghost",children:"Ir a batalla"})]})]})]}),(0,s.jsx)(u,{playerStats:y.playerStats,trainerStats:y.trainerStats}),S&&(0,s.jsx)("div",{className:"du-modal",children:(0,s.jsxs)("div",{className:"du-modal-card du-popup",children:[(0,s.jsxs)("div",{className:"du-popup-header",children:[(0,s.jsx)("div",{className:"du-popup-title",children:"Edit Profile"}),(0,s.jsx)("button",{className:"du-back-btn",onClick:()=>w(!1),children:"←"})]}),(0,s.jsxs)("div",{className:"du-popup-body du-form",children:[(0,s.jsx)("label",{className:"du-meta",children:"Display name"}),(0,s.jsx)("input",{className:"du-input",value:B.display_name,onChange:e=>E(a=>({...a,display_name:e.target.value}))}),(0,s.jsx)("label",{className:"du-meta",children:"Country"}),(0,s.jsx)("input",{className:"du-input",value:B.country,onChange:e=>E(a=>({...a,country:e.target.value}))}),(0,s.jsx)("label",{className:"du-meta",children:"Bio"}),(0,s.jsx)("textarea",{className:"du-input",value:B.bio,onChange:e=>E(a=>({...a,bio:e.target.value})),rows:3}),(0,s.jsx)("label",{className:"du-meta",children:"Avatar URL"}),(0,s.jsx)("input",{className:"du-input",value:B.avatar_url,onChange:e=>{E(a=>({...a,avatar_url:e.target.value})),q(e.target.value)}})]}),(0,s.jsxs)("div",{className:"du-popup-actions",children:[(0,s.jsx)(o.z,{variant:"ghost",onClick:()=>w(!1),children:"Cancelar"}),(0,s.jsx)(o.z,{onClick:D,disabled:C,children:C?"Guardando...":"Guardar"})]})]})})]})}},495:function(e,a,t){"use strict";t.d(a,{z:function(){return l}});var s=t(7437),r=t(2265);let i=e=>"ghost"===e?"du-button ghost":"quick"===e?"du-button du-quick":"du-button",l=(0,r.forwardRef)((e,a)=>{let{variant:t="solid",full:r,className:l,...n}=e;return(0,s.jsx)("button",{ref:a,className:"".concat(i(t)).concat(r?" du-btn-full":""," ").concat(null!=l?l:""),...n})});l.displayName="Button"},6013:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});var s=t(7437);function r(e){let{children:a,title:t,badge:r,footer:i,className:l}=e;return(0,s.jsxs)("div",{className:["du-card",l].filter(Boolean).join(" "),children:[(t||r)&&(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[t?(0,s.jsx)("h3",{style:{margin:0},children:t}):(0,s.jsx)("span",{}),r]}),a,i?(0,s.jsx)("div",{style:{marginTop:10},children:i}):null]})}},9135:function(e,a,t){"use strict";t.d(a,{A:function(){return r}});var s=t(7437);function r(e){let{children:a,className:t,style:r,variant:i}=e;return(0,s.jsx)("span",{className:["du-tag","ghost"===i?"du-tag--ghost":null,t].filter(Boolean).join(" "),style:r,children:a})}},857:function(e,a,t){"use strict";t.d(a,{H:function(){return n},a:function(){return d}});var s=t(7437),r=t(2265),i=t(1180);let l=(0,r.createContext)({userId:null,status:"loading",signOut:async()=>{}});function n(e){let{children:a}=e,t=(0,i.O)(),[n,d]=(0,r.useState)(null),[u,o]=(0,r.useState)(t?"loading":"signed_out"),[c,m]=(0,r.useState)(void 0);(0,r.useEffect)(()=>{if(!t){o("signed_out");return}let e=!1;(async()=>{var a;let{data:s,error:r}=await t.auth.getSession();if(!e){if(r){try{await t.auth.signOut()}catch(e){}o("signed_out"),m(r.message),d(null)}else(null===(a=s.session)||void 0===a?void 0:a.user)?(d(s.session.user.id),o("ready")):o("signed_out")}})();let{data:a}=t.auth.onAuthStateChange((e,a)=>{(null==a?void 0:a.user)?(d(a.user.id),o("ready")):(d(null),o("signed_out"))});return()=>{e=!0,null==a||a.subscription.unsubscribe()}},[t]);let _=async()=>{t&&(await t.auth.signOut(),d(null),o("signed_out"))};return(0,s.jsx)(l.Provider,{value:{userId:n,status:u,error:c,signOut:_},children:a})}function d(){return(0,r.useContext)(l)}},371:function(e,a,t){"use strict";t.d(a,{G:function(){return u},U:function(){return d}});var s=t(7437),r=t(2265),i=t(1180),l=t(857);let n=(0,r.createContext)({regions:[],creatures:[],creatureStages:[],playerCreatures:[],regionCreatures:[],cityCreatures:[],missions:[],missionProgress:[],achievements:[],userAchievements:[],bonds:[],battles:[],profile:null,trainerStats:[],playerStats:[],xpThresholds:[],factions:[],cities:[],status:"idle",isLive:!1,reload:async()=>{}});function d(e){let{children:a}=e,t=(0,i.O)(),{userId:d,status:u}=(0,l.a)(),[o,c]=(0,r.useState)("idle"),[m,_]=(0,r.useState)(void 0),[p,h]=(0,r.useState)([]),[v,f]=(0,r.useState)([]),[g,x]=(0,r.useState)([]),[y,j]=(0,r.useState)([]),[b,N]=(0,r.useState)([]),[S,w]=(0,r.useState)([]),[C,k]=(0,r.useState)([]),[A,q]=(0,r.useState)([]),[B,E]=(0,r.useState)([]),[P,O]=(0,r.useState)([]),[T,I]=(0,r.useState)([]),[Z,z]=(0,r.useState)([]),[D,F]=(0,r.useState)([]),[G,L]=(0,r.useState)(null),[R,J]=(0,r.useState)(!1),[U,X]=(0,r.useState)([]),[M,H]=(0,r.useState)([]),[W,K]=(0,r.useState)([]),[Q,V]=(0,r.useState)([]),Y=async()=>{if(!t||!d){c("idle"),J(!1);return}c("loading"),_(void 0);let e=[],[a,s,r,i,l,n,u,o,m,p,v,g,y,b,S,C,A,B]=await Promise.all([t.from("profiles").select("*").eq("id",d).maybeSingle(),t.from("creatures").select("id, name, name_locales, base_type, region, image_url, is_starter, rarity, sexes"),t.from("creature_stages").select("id, creature_id, stage_name, stage_order, stage_stats, image_url, image_url_male, image_url_female, variant_type, xp_required"),t.from("player_creatures").select("user_id, creature_id, current_stage_id, nickname, variant_type, date_caught, custom_stats, current_xp, level, in_party, party_slot, is_domesticated, stats, sex").eq("user_id",d),t.from("regions").select("id, name, color, island, municipalities, map_polygon"),t.from("region_creatures").select("region_id, creature_id, spawn_rate"),t.from("cities").select("id, name, region_id"),t.from("city_creatures").select("city_id, creature_id, spawn_rate"),t.from("story_missions").select("id, title, description, region_id, order_in_story, unlock_requirements, reward_cc, reward_item, mission_difficulty, is_battle, trainer_id"),t.from("player_mission_progress").select("user_id, mission_id, is_completed, completed_at, completion_date, rewards").eq("user_id",d),t.from("achievements").select("id, name, description, icon_url, criteria_json, reward_cc, reward_item"),t.from("user_achievements").select("id, user_id, achievement_id, achievement_name, description, date_earned, unlocked_at, notified_followers, track_id").eq("user_id",d),t.from("player_faction_bonds").select("user_id, faction, bond_amount").eq("user_id",d),t.from("battles").select("player1_id, player2_id, winner_id, battle_log, started_at, ended_at").or("player1_id.eq.".concat(d,",player2_id.eq.").concat(d)),t.from("player_trainer_stats").select("user_id, trainer_id, wins, losses, familiarity, last_battle_at").eq("user_id",d),t.from("player_stats").select("user_id, stat_key, stat_value").eq("user_id",d),t.from("creature_stage_xp_thresholds").select("id, creature_id, stage_id, xp_required, created_at, updated_at"),t.from("factions").select("id, name, description, color_hex, icon_url, slug, motto, alignment, lore_json")]),P=(a,t)=>{if(!t)return;let s="string"==typeof(null==t?void 0:t.message)?t.message:String(t);e.push("".concat(a,": ").concat(s))};P("profiles",a.error),P("creatures",s.error),P("creature_stages",r.error),P("player_creatures",i.error),P("regions",l.error),P("region_creatures",n.error),P("cities",u.error),P("city_creatures",o.error),P("story_missions",m.error),P("player_mission_progress",p.error),P("achievements",v.error),P("user_achievements",g.error),P("player_faction_bonds",y.error),P("battles",b.error),P("player_trainer_stats",S.error),P("player_stats",C.error),P("creature_stage_xp_thresholds",A.error),P("factions",B.error),a.data&&L(a.data),s.data&&x(s.data),r.data&&j(r.data.map(e=>{var a;return{...e,stage_stats:"string"==typeof e.stage_stats?JSON.parse(e.stage_stats):null!==(a=e.stage_stats)&&void 0!==a?a:{hp:0,atk:0,def:0,speed:0,faith:0}}})),i.data&&N(i.data),l.data&&h(l.data),n.data&&w(n.data),u.data&&f(u.data),o.data&&k(o.data),m.data&&q(m.data),p.data&&E(p.data),v.data&&O(v.data),g.data&&I(g.data),y.data&&z(y.data),b.data&&F(b.data),S.data&&X(S.data),C.data&&H(C.data),A.data&&K(A.data),B.data&&V(B.data),J(!0),e.length?(c("error"),_(e.join(" | "))):c("ready")};(0,r.useEffect)(()=>{"ready"===u&&Y()},[u,d]);let $=(0,r.useMemo)(()=>({regions:p,creatures:g,creatureStages:y,playerCreatures:b,regionCreatures:S,cityCreatures:C,missions:A,missionProgress:B,achievements:P,userAchievements:T,bonds:Z,battles:D,profile:G,trainerStats:U,playerStats:M,xpThresholds:W,factions:Q,cities:v,status:o,error:m,isLive:R,reload:Y}),[p,g,y,b,S,A,B,P,T,Z,D,G,U,M,W,Q,o,m,R]);return(0,s.jsx)(n.Provider,{value:$,children:a})}function u(){return(0,r.useContext)(n)}},1180:function(e,a,t){"use strict";t.d(a,{O:function(){return i}});var s=t(3234);let r=null;function i(){if(r)return r;let e="https://npdklestjuejrotjtqwt.supabase.co",a="sb_publishable_9xEllkhUFl85xTTXtDDT5g_ei508t0r";return e&&a?r=(0,s.eI)(e,a,{auth:{persistSession:!0,autoRefreshToken:!0}}):null}}},function(e){e.O(0,[234,138,971,23,744],function(){return e(e.s=7182)}),_N_E=e.O()}]);