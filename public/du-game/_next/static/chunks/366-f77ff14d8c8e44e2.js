"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[366],{495:function(e,t,r){r.d(t,{z:function(){return n}});var a=r(7437),s=r(2265);let i=e=>"ghost"===e?"du-button ghost":"quick"===e?"du-button du-quick":"du-button",n=(0,s.forwardRef)((e,t)=>{let{variant:r="solid",full:s,className:n,...o}=e;return(0,a.jsx)("button",{ref:t,className:"".concat(i(r)).concat(s?" du-btn-full":""," ").concat(null!=n?n:""),...o})});n.displayName="Button"},9135:function(e,t,r){r.d(t,{A:function(){return s}});var a=r(7437);function s(e){let{children:t,className:r,style:s,variant:i}=e;return(0,a.jsx)("span",{className:["du-tag","ghost"===i?"du-tag--ghost":null,r].filter(Boolean).join(" "),style:s,children:t})}},857:function(e,t,r){r.d(t,{H:function(){return o},a:function(){return u}});var a=r(7437),s=r(2265),i=r(1180);let n=(0,s.createContext)({userId:null,status:"loading",signOut:async()=>{}});function o(e){let{children:t}=e,r=(0,i.O)(),[o,u]=(0,s.useState)(null),[d,l]=(0,s.useState)(r?"loading":"signed_out"),[c,_]=(0,s.useState)(void 0);(0,s.useEffect)(()=>{if(!r){l("signed_out");return}let e=!1;(async()=>{var t;let{data:a,error:s}=await r.auth.getSession();if(!e){if(s){try{await r.auth.signOut()}catch(e){}l("signed_out"),_(s.message),u(null)}else(null===(t=a.session)||void 0===t?void 0:t.user)?(u(a.session.user.id),l("ready")):l("signed_out")}})();let{data:t}=r.auth.onAuthStateChange((e,t)=>{(null==t?void 0:t.user)?(u(t.user.id),l("ready")):(u(null),l("signed_out"))});return()=>{e=!0,null==t||t.subscription.unsubscribe()}},[r]);let g=async()=>{r&&(await r.auth.signOut(),u(null),l("signed_out"))};return(0,a.jsx)(n.Provider,{value:{userId:o,status:d,error:c,signOut:g},children:t})}function u(){return(0,s.useContext)(n)}},931:function(e,t,r){r.d(t,{A:function(){return d},O:function(){return u}});var a=r(7437),s=r(2265),i=r(371),n=r(1180);let o=(0,s.createContext)({battle:{mode:"idle",log:[]},startBattle:()=>{},addLog:()=>{},reset:()=>{},tutorial:{status:"not_started"},setStarterChoice:()=>{},startTutorial:()=>{},completeTutorial:()=>{},skipTutorial:()=>{},restartTutorial:()=>{},awardXp:async()=>{},recordBattle:async()=>{},awardStageAndXp:async()=>{}});function u(e){let{children:t}=e,{playerCreatures:r,profile:u,reload:d}=(0,i.G)(),l=(0,n.O)(),[c,_]=(0,s.useState)({mode:"idle",log:[]}),[g,f]=(0,s.useState)({status:"not_started"}),m=(0,s.useMemo)(()=>(null==u?void 0:u.id)?"du:tutorial:".concat(u.id):null,[null==u?void 0:u.id]);(0,s.useEffect)(()=>{if(!m)return;let e=localStorage.getItem(m);if(e)try{let t=JSON.parse(e);f(t)}catch(e){f({status:"not_started"})}else f({status:"not_started"})},[m]),(0,s.useEffect)(()=>{m&&localStorage.setItem(m,JSON.stringify(g))},[g,m]);let p=async(e,t)=>{l&&(null==u?void 0:u.id)&&e&&(await l.from("player_creatures").update({current_xp:t}).eq("user_id",u.id).eq("creature_id",e),await d())},y=async e=>{let{winner_id:t,battle_log:r}=e;l&&(null==u?void 0:u.id)&&(await l.from("battles").insert({player1_id:u.id,player2_id:"npc",winner_id:t,battle_log:r}),await d())},v=async e=>{var t,r,a;let{creatureId:s,xpGain:i}=e;if(!l||!(null==u?void 0:u.id)||!s)return;let{data:n,error:o}=await l.from("player_creatures").select("current_stage_id, current_xp, creature_id, level").eq("user_id",u.id).eq("creature_id",s).maybeSingle();if(o||!n)return;let{data:c}=await l.from("creature_stages").select("id, creature_id, stage_order, xp_required").eq("creature_id",n.creature_id),_=(c||[]).sort((e,t)=>{var r,a;return(null!==(r=e.stage_order)&&void 0!==r?r:0)-(null!==(a=t.stage_order)&&void 0!==a?a:0)}),g=_.find(e=>e.id===n.current_stage_id),f=g?_.find(e=>{var t,r;return(null!==(t=e.stage_order)&&void 0!==t?t:0)===(null!==(r=g.stage_order)&&void 0!==r?r:0)+1}):void 0,m=(null!==(t=n.current_xp)&&void 0!==t?t:0)+i,p=n.current_stage_id,y=null!==(r=n.level)&&void 0!==r?r:1;f&&null!==f.xp_required&&void 0!==f.xp_required&&m>=f.xp_required&&(m-=f.xp_required,p=f.id,y=(null!==(a=null==g?void 0:g.stage_order)&&void 0!==a?a:1)+1),await l.from("player_creatures").update({current_xp:m,current_stage_id:p,level:y}).eq("user_id",u.id).eq("creature_id",s),await d()};return(0,a.jsx)(o.Provider,{value:{battle:c,startBattle:e=>{_({mode:e,log:["Starting ".concat(e," battle with ").concat(r.length," domesticated creatures")]})},addLog:e=>_(t=>({...t,log:[...t.log,e]})),reset:()=>_({mode:"idle",log:[]}),tutorial:g,setStarterChoice:e=>f(t=>({...t,starterChoice:e})),startTutorial:()=>{f(e=>({...e,status:"in_progress"})),_({mode:"trainer",log:["Tutorial iniciado"]})},completeTutorial:()=>f({status:"completed",starterChoice:g.starterChoice}),skipTutorial:()=>f(e=>({...e,status:"completed"})),restartTutorial:()=>{f({status:"not_started"}),_({mode:"idle",log:[]})},awardXp:p,recordBattle:y,awardStageAndXp:v},children:t})}function d(){return(0,s.useContext)(o)}},371:function(e,t,r){r.d(t,{G:function(){return d},U:function(){return u}});var a=r(7437),s=r(2265),i=r(1180),n=r(857);let o=(0,s.createContext)({regions:[],creatures:[],creatureStages:[],playerCreatures:[],regionCreatures:[],cityCreatures:[],missions:[],missionProgress:[],achievements:[],userAchievements:[],bonds:[],battles:[],profile:null,trainerStats:[],playerStats:[],xpThresholds:[],factions:[],cities:[],status:"idle",isLive:!1,reload:async()=>{}});function u(e){let{children:t}=e,r=(0,i.O)(),{userId:u,status:d}=(0,n.a)(),[l,c]=(0,s.useState)("idle"),[_,g]=(0,s.useState)(void 0),[f,m]=(0,s.useState)([]),[p,y]=(0,s.useState)([]),[v,h]=(0,s.useState)([]),[S,x]=(0,s.useState)([]),[b,w]=(0,s.useState)([]),[q,k]=(0,s.useState)([]),[C,T]=(0,s.useState)([]),[j,O]=(0,s.useState)([]),[N,E]=(0,s.useState)([]),[A,B]=(0,s.useState)([]),[P,I]=(0,s.useState)([]),[J,L]=(0,s.useState)([]),[X,D]=(0,s.useState)([]),[G,M]=(0,s.useState)(null),[R,U]=(0,s.useState)(!1),[z,F]=(0,s.useState)([]),[H,K]=(0,s.useState)([]),[Q,V]=(0,s.useState)([]),[W,Y]=(0,s.useState)([]),Z=async()=>{if(!r||!u){c("idle"),U(!1);return}c("loading"),g(void 0);let e=[],[t,a,s,i,n,o,d,l,_,f,p,v,S,b,q,C,j,N]=await Promise.all([r.from("profiles").select("*").eq("id",u).maybeSingle(),r.from("creatures").select("id, name, name_locales, base_type, region, image_url, is_starter, rarity, sexes"),r.from("creature_stages").select("id, creature_id, stage_name, stage_order, stage_stats, image_url, image_url_male, image_url_female, variant_type, xp_required"),r.from("player_creatures").select("user_id, creature_id, current_stage_id, nickname, variant_type, date_caught, custom_stats, current_xp, level, in_party, party_slot, is_domesticated, stats, sex").eq("user_id",u),r.from("regions").select("id, name, color, island, municipalities, map_polygon"),r.from("region_creatures").select("region_id, creature_id, spawn_rate"),r.from("cities").select("id, name, region_id"),r.from("city_creatures").select("city_id, creature_id, spawn_rate"),r.from("story_missions").select("id, title, description, region_id, order_in_story, unlock_requirements, reward_cc, reward_item, mission_difficulty, is_battle, trainer_id"),r.from("player_mission_progress").select("user_id, mission_id, is_completed, completed_at, completion_date, rewards").eq("user_id",u),r.from("achievements").select("id, name, description, icon_url, criteria_json, reward_cc, reward_item"),r.from("user_achievements").select("id, user_id, achievement_id, achievement_name, description, date_earned, unlocked_at, notified_followers, track_id").eq("user_id",u),r.from("player_faction_bonds").select("user_id, faction, bond_amount").eq("user_id",u),r.from("battles").select("player1_id, player2_id, winner_id, battle_log, started_at, ended_at").or("player1_id.eq.".concat(u,",player2_id.eq.").concat(u)),r.from("player_trainer_stats").select("user_id, trainer_id, wins, losses, familiarity, last_battle_at").eq("user_id",u),r.from("player_stats").select("user_id, stat_key, stat_value").eq("user_id",u),r.from("creature_stage_xp_thresholds").select("id, creature_id, stage_id, xp_required, created_at, updated_at"),r.from("factions").select("id, name, description, color_hex, icon_url, slug, motto, alignment, lore_json")]),A=(t,r)=>{if(!r)return;let a="string"==typeof(null==r?void 0:r.message)?r.message:String(r);e.push("".concat(t,": ").concat(a))};A("profiles",t.error),A("creatures",a.error),A("creature_stages",s.error),A("player_creatures",i.error),A("regions",n.error),A("region_creatures",o.error),A("cities",d.error),A("city_creatures",l.error),A("story_missions",_.error),A("player_mission_progress",f.error),A("achievements",p.error),A("user_achievements",v.error),A("player_faction_bonds",S.error),A("battles",b.error),A("player_trainer_stats",q.error),A("player_stats",C.error),A("creature_stage_xp_thresholds",j.error),A("factions",N.error),t.data&&M(t.data),a.data&&h(a.data),s.data&&x(s.data.map(e=>{var t;return{...e,stage_stats:"string"==typeof e.stage_stats?JSON.parse(e.stage_stats):null!==(t=e.stage_stats)&&void 0!==t?t:{hp:0,atk:0,def:0,speed:0,faith:0}}})),i.data&&w(i.data),n.data&&m(n.data),o.data&&k(o.data),d.data&&y(d.data),l.data&&T(l.data),_.data&&O(_.data),f.data&&E(f.data),p.data&&B(p.data),v.data&&I(v.data),S.data&&L(S.data),b.data&&D(b.data),q.data&&F(q.data),C.data&&K(C.data),j.data&&V(j.data),N.data&&Y(N.data),U(!0),e.length?(c("error"),g(e.join(" | "))):c("ready")};(0,s.useEffect)(()=>{"ready"===d&&Z()},[d,u]);let $=(0,s.useMemo)(()=>({regions:f,creatures:v,creatureStages:S,playerCreatures:b,regionCreatures:q,cityCreatures:C,missions:j,missionProgress:N,achievements:A,userAchievements:P,bonds:J,battles:X,profile:G,trainerStats:z,playerStats:H,xpThresholds:Q,factions:W,cities:p,status:l,error:_,isLive:R,reload:Z}),[f,v,S,b,q,j,N,A,P,J,X,G,z,H,Q,W,l,_,R]);return(0,a.jsx)(o.Provider,{value:$,children:t})}function d(){return(0,s.useContext)(o)}},1180:function(e,t,r){r.d(t,{O:function(){return i}});var a=r(3234);let s=null;function i(){if(s)return s;let e="https://npdklestjuejrotjtqwt.supabase.co",t="sb_publishable_9xEllkhUFl85xTTXtDDT5g_ei508t0r";return e&&t?s=(0,a.eI)(e,t,{auth:{persistSession:!0,autoRefreshToken:!0}}):null}}}]);