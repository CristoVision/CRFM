# MASTER Log (organizado por proyecto/tema)

## CRFM — Webapp, Admin, Analytics
| Fecha | Agente | Resumen | Alcance/Archivos | Notas | Estado | Siguientes |
| --- | --- | --- | --- | --- | --- | --- |
| 2025-12-13T18:10:00Z | Codex | CRFM — Monetization: upload policies persistentes + tienda descargas (privada) | workspace/CRFM/upload_policies.sql, workspace/CRFM/digital_downloads_store.sql, workspace/CRFM/src/components/creator/{CreatorMonetizationTab,CreatorUploadPreferences,CreatorDownloadsManager}.jsx, workspace/CRFM/src/components/formUtils.js, workspace/CRFM/MASTER.md | Se clarificó policy activa (badge “Active”), fee contextual (10% solo para Free), y asignación por-item (tracks/albums/videos). Se agregó scaffolding “Digital Downloads Store” para creadores: productos (track/album/video), formatos con pricing CC, expiración opcional, y códigos de descuento creados por el creador. Backend: tablas + RLS + RPC `purchase_download_format` y policies Storage para bucket privado `downloads`; billing_events extiende `event_type` con `download_purchased` para analytics. Se reemplazó el panel “Membership tiers” del hub por la nueva tienda. | IN PROGRESS | 1) En Supabase: ejecutar `upload_policies.sql` + `digital_downloads_store.sql` y crear bucket privado `downloads`; 2) UI comprador: botón “Buy download” en Track/Album/Video details + flujo de descarga (signed URL); 3) Reconciliar `billing_events` CHECK si hay constraint distinto en tu proyecto; 4) Definir fee CRFM para descargas + payout/royalty split. |
| 2025-12-13T16:45:00Z | Codex | CRFM — UI: tiers + historial membresías/códigos + upload policy | workspace/CRFM/src/pages/Hub/HubPage.jsx, src/components/creator/{CreatorMonetizationTab,CreatorTiersManager,CreatorUploadPreferences}.jsx, src/pages/ProfilePage.jsx, src/components/profile/MembershipsAndCodesTab.jsx, MASTER.md | Se agregó tab “Monetization” en Creator Hub para crear/editar/desactivar tiers y escoger política de uploads (con nota 10% fee). En Profile: vista “Memberships & Codes” con filtros (billing_events). | OK | 1) Aplicar `workspace/CRFM/upload_policies.sql` en Supabase; 2) Definir precio “pay per upload” y reglas por tipo (tracks/albums/videos); 3) (Opcional) en Hub, marcar contenido que requiera selección por-item al cambiar policy. |
| 2025-12-11T00:00:00Z | Codex | CRFM — Wallet admin UX + auditoría + soporte | workspace/CRFM/src/pages/AdminPage.jsx, src/components/admin/AdminUserManagementTab.jsx, src/components/admin/WalletAdminTab.jsx, src/components/admin/ManageFundsModal.jsx, wallet_actions.sql, admin_audit_logs.sql, support_cases.sql, SUPABASE_WALLET.md, MASTER.md | UI Users tab mobile-friendly, remove funds button (solo Wallet Admin), balances CC/USD toggle; auditoría admin_audit_logs; scripts Supabase para wallet_actions, audit logs, support cases/messages, RPCs admin_* y support; doc SUPABASE_WALLET. | OK | 1) Aplicar support_cases.sql + wallet_actions.sql + admin_audit_logs.sql en Supabase; 2) Conectar UI a RPCs de bloqueo/MFA/reset/soporte; 3) Crear tab Audit Logs y soporte en frontend. |
| 2025-12-14T00:00:00Z | Codex | CRFM — Hardening admin/HUB + env seguro | workspace/CRFM/src/**/*, docs/SUPABASE_RPCS.md | Protegí /admin y tabs con profile.is_admin; admin UI usa RPCs `rpc_admin_update_user_password`, `rpc_admin_adjust_wallet`, `rpc_admin_upsert_ad`, `rpc_admin_upsert_station`; quité hardcodes Supabase (.env local) y documenté RPCs nuevos/policy stream_cost. | TODO | 1) Ajustar deletes ads/estaciones a RPC/RLS; 2) Crear RPCs de analytics (`get_top_albums_by_creator`, `get_top_playlists_by_creator`) o reusar leaderboards; 3) Planificar automatización flags/licensing/AI copilotos; 4) Flujos monetización CrossCoins. |
| 2025-12-08T00:00:00Z | Codex | CRFM webapp: video cover art + UX fixes (About/Admin) | workspace/CRFM/src/**/*, public/site.webmanifest | Video cover art en player/portadas; focus/toasts; manifest/favicons; About/Admin con tabs responsivas. Deshabilité RPCs inexistentes (achievements) y dejé mensajes informativos en analytics cuando faltan vistas/RPC. | WARN | Backend pendientes: crear RPC `get_top_albums_by_creator`, `get_top_playlists_by_creator`, vista `daily_page_views`; añadir `track_id` a `stream_events` si se loguean streams; crear RPCs de achievements (feed/notifs) o reactivar controlador; asegurar perfil admin via role/is_admin. |
| 2025-11-16T23:30:00Z | Codex | CRFM webapp: reorganización + playback/billing fixes | workspace/CRFM/src/**/*, workspace/CRFM/vite.config.js, Desktop/CRFM Nov 2025 import script | Reorganizé app (alias @, slider UI, lrc editor), reparé QueueContext/PlayerContext, tabs/detalles de tracks, persistencia de cola, gasto de CrossCoins para videos (`spendCrossCoinsForVideo`). `npm run build` ok local. | WARNING | En host validar `npm run dev` con Album/Playlist/Track detail + ExpandedPlayer; confirmar RPC `handle_video_credit_transfer` o ajustar wallet service (cargo de videos con 1900+ CC). |
| 2025-11-16T15:30:00Z | Codex | CRFM AI integration blueprint | workspace/reports/crfm_ai_integration.md | Definí copilotos (chat cargas, mentor analytics, generador arte) con OpenAI vía Edge Functions y autoevaluación `docs/agent_rubric.yaml`. | OK | Prototipar endpoints `ai_creator_copilot`, `<AiChatDock>` con métricas/registros Supabase. |
| 2025-12-13T00:00:00Z | Codex | CRFM — Registro central de RPCs Supabase | docs/SUPABASE_RPCS.md, MASTER.md | Registro compartido de RPCs (usados/faltantes/propuestos) para reemplazar edge functions/admin writes. | TODO | Crear/ajustar RPCs propuestos y actualizar frontend con checks admin. |
| 2025-11-09T21:30:00Z | Codex | Refine Génesis 2 translation & evaluation | translations/es/genesis_2.md, evaluations/gn-2-summary.md | Correcciones sugeridas (puntuación 2:12, matiz “ayuda” 2:18, verbo “tendría” 2:19) y actualización en resumen de evaluación. | OK | Revisar Génesis 3 con mismo flujo de cotejo. |

### CRFM — Monetización (borrador de producto)
- CRFM retiene 10% de todas las regalías antes de withdrawal.
- Upload policies para creadores (selección en Hub):
  - `free`: se puede cambiar en cualquier momento; si hay contenido ya subido, el Hub debe guiar a asignar una opción para su contenido (singles/tracks, albums, videos) cuando aplique.
  - `pay_per_upload`: subir singles/tracks uno a la vez pagando una sola vez (precio TBD). Regalías 100% al creador permanentemente (o hasta remover el contenido de la plataforma).
  - `subscription`: cargas ilimitadas via membresía (mensual / anual / cada 6 meses con descuentos). Regalías 100% al creador hasta la fecha de vencimiento de la membresía antes del withdrawal; si expira, el contenido no se borra de inmediato pero se pierde toda regalía generada mientras permanezca en plataforma con membresía expirada.

### CRFM — Progreso de esta sesión (2025-12-13)
- Hecho: policy default por creador + policy por-item persistibles en DB (`profiles.creator_upload_policy`, `tracks/albums/videos.upload_policy`) y UI para asignación masiva por contenido.
- Hecho: tienda base de descargas digitales con control privado (entitlements), descuento por creador, RPC compra (`purchase_download_format`) y registro en `billing_events` (`download_purchased`) para analytics.
- Pendiente: UI comprador (compra + descarga), UI de analytics para creadores (ventas/formatos/códigos), y decisión final de fee CRFM/royalty split para descargas.

## DU TCG PR
| Fecha | Agente | Resumen | Alcance/Archivos | Notas | Estado | Siguientes |
| --- | --- | --- | --- | --- | --- | --- |
| 2025-12-02T00:00:00Z | Codex | DU TCG PR – regresiones severas en batalla/home | /Users/cristovision/du-tcg-pr/app/(du)/*, contexts/BattleContext.tsx, components/battle/BattleHub.tsx, app/(du)/home/page.tsx | Build roto (syntax BattleContext/home), home muestra 0s logueado, batalla sin imágenes correctas, Encounter/Trainer invertidos, sin modal victoria ni persistencia estable; captura/domesticación y cambio de criatura frágiles. | WARNING | Arreglar build TSX, restaurar login+datos en home, fijar imágenes por creature_id, corregir modos/enemigos/persistencia batallas/XP, añadir modal post-batalla y equipo de 6 + captura sin placeholders. |
| 2025-12-01T00:00:00Z | Codex | DU TCG PR – sesión incompleta (home/batalla/mapa) | /Users/cristovision/du-tcg-pr/app/(du)/*, contexts/GameContext.tsx, schema_v1.sql | Añadidas ciudades/city_creatures a GameContext, popups mapa, home reestilizado; regresiones: imágenes placeholder, combate sin modal, captura/party parcial, selección Encounter/Trainer frágil, login/home con datos en cero. | WARNING | Corregir BattleHub (modo limpio, equipo de 6, captura, modal post-batalla, imágenes por creature_id), reparar home, usar cities/city_creatures en Encounter. |
| 2025-11-17T00:00:00Z | Codex | DU TCG PR movido a carpeta propia | /Users/cristovision/du-tcg-pr/*, dream-ui/MASTER note | App Next standalone `du-tcg-pr`; regla: **un proyecto por directorio**. | OK | Mantener TCG en `/Users/cristovision/du-tcg-pr`; correr `npm run dev` ahí (symlink node_modules o `npm install`). |

## Dream UI / DreamUniverse
| Fecha | Agente | Resumen | Alcance/Archivos | Notas | Estado | Siguientes |
| --- | --- | --- | --- | --- | --- | --- |
| 2025-11-10T12:10:52Z | Codex | Reestilizar workspace + herramientas de edición | dream-ui/app/workspace/page.tsx, dream-ui/components/{MarkdownViewer,Sidebar}.tsx, dream-ui/app/layout.tsx | Workspace con lenguaje visual del home: nav/card/header unificado, sidebar filtrable, meta-panels en tarjetas, editor con toolbar (negrita/itálica/listas/citas/checklist), contador words/chars, footer consistente. | TODO | En host abrir `node server-local.mjs`, visitar `/workspace`, validar flujo de edición; correr `npm run test` smoke offline. |
| 2025-11-10T11:41:16Z | Codex | Fix Next build (static export) + workspace Suspense + TS config | dream-ui/app/workspace/page.tsx, dream-ui/scripts/build-static.mjs, dream-ui/tsconfig.json | `npm run build` stashea `app/api` para `output: export`, corre `next build` + `tsc`; `<Suspense>` para `useSearchParams`; tsconfig permite importar `.ts`. | OK | Ejecutar `npm run build` (genera `out/`) y `npm run test` en host tras cada cambio grande. |
| 2025-11-10T11:26:57Z | Codex | Offline Dream UI server + watcher/reindex upgrades | dream-ui/server-local.mjs, dream-ui/tests/smoke.mjs, dream-ui/README_RUN.md, dream-ui/package.json | Servidor local sirve `out/`, replica endpoints Next (file/read/save/diff/history/codex), reindex al iniciar/guardar, watcher chokidar + doc. Smoke test corre reindex previo. | WARNING | En host ejecutar `npm run build` y `npm run test` desde `dream-ui/` (sandbox bloquea). |
| 2025-11-23T00:00:00Z | Codex | DreamTwist (standalone) — power-ups, imágenes Wake/Dream, Supabase | /Users/cristovision/dreamtwist-standalone/app/page.tsx, lib/dreamtwist.ts, lib/dreamtwistSupabase.ts, app/perfil/page.tsx | Integra Supabase (auth/wallet/score), mapea gemas/power-ups a buckets wake/dream, efectos (void 3x3, wave fila+col, core 5x5), animaciones. Usa tabla `tracks` con flags `dreamtwist_*`, `dt_scores`, `wallet_transactions`. | TODO | Compactar HUD/menú, ajustar caída más lenta si se desea, validar clears 3+ con flood-fill. |

## Supabase / RPC / Infra (CRFM)
| Fecha | Agente | Resumen | Alcance/Archivos | Notas | Estado | Siguientes |
| --- | --- | --- | --- | --- | --- | --- |
| 2025-12-13T00:00:00Z | Codex | CRFM — Registro central de RPCs Supabase | docs/SUPABASE_RPCS.md, MASTER.md | Registro RPCs usados/faltantes/propuestos. | TODO | Crear RPCs faltantes y ajustar frontend. |

## Creación Chronicles / Veritas / Traducciones
| Fecha | Agente | Resumen | Alcance/Archivos | Notas | Estado | Siguientes |
| --- | --- | --- | --- | --- | --- | --- |
| 2025-11-29T15:34:04Z | Codex | Creation Chronicles rebase + Supabase-ready scaffold | workspace/projects/creation_chronicles/**/*, docs/supabase_structure_schema.md | Dump de Horizons a proyecto dedicado, capa de datos (Supabase env + fallback), timeline/detalle con evidencia, README/env example con modelo sugerido. | OK | Conectar .env.local con Supabase, crear tablas creation_events/creation_evidence, probar alta real. |

## MCP / Agent Pool / Infraestructura (Supervisor)
| Fecha | Agente | Resumen | Alcance/Archivos | Notas | Estado | Siguientes |
| --- | --- | --- | --- | --- | --- | --- |
| 2025-11-01 series | CODEx-SUPERVISOR | Scripts MCP, colas, workers, seeds, notificaciones | scripts/*.sh, agents/*, orchestrator/*, config/*.yaml, reports/* | Se creó pool, worker, preflight, seeds OHB, modos MCP/FS, scripts notify/mcp, docs README/POOL. | OK/VARIOS | Ver notas en cada entrada (aplicar queue, health check, MCP mode, etc.). |
| 2025-11-01T11:10:55Z .. 2025-11-01T16:55:27Z | CODEx-SUPERVISOR | (Detalle) ver tabla original en historico | | | | |

## Otros (Referencias, documentación)
| Fecha | Agente | Resumen | Alcance/Archivos | Notas | Estado | Siguientes |
| --- | --- | --- | --- | --- | --- | --- |
| 2025-11-16T15:45:00Z | Codex | Blueprint IA CRFM (ver reporte) | workspace/reports/crfm_ai_integration.md | Cierre de sesión IA; reanudar con copilotos. | OK | Prototipos Edge Functions IA. |
| 2025-11-10T11:26:57Z | Codex | Dream UI server-local | dream-ui/server-local.mjs, tests/smoke.mjs | Servidor offline + watcher. | WARNING | Ejecutar build/test en host. |

> Nota: Para historial detallado de infra MCP/agents (múltiples entradas del 2025-11-01), revisar la tabla original; se mantuvo intacta en esta reorganización.
